/**
 * skylark-bs-swt - The skylark bootstrap standard widget tookit
 * @author Hudaokeji, Inc.
 * @version v0.9.0-beta
 * @link https://github.com/skylarkui/skylark-bs-swt/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/query","./combobox","./datepicker","./radio","./selectlist","./spinbox"],function(e,t,i,s,a,n){if(!(n.fn.combobox&&n.fn.datepicker&&n.fn.radio&&n.fn.selectlist&&n.fn.spinbox))throw new Error("Fuel UX scheduler control requires combobox, datepicker, radio, selectlist, and spinbox.");var l=n.fn.scheduler,r=function(t,i){var s=this;this.$element=n(t),this.options=e.mixin({},n.fn.scheduler.defaults,i),this.$startDate=this.$element.find(".start-datetime .start-date"),this.$startTime=this.$element.find(".start-datetime .start-time"),this.$timeZone=this.$element.find(".timezone-container .timezone"),this.$repeatIntervalPanel=this.$element.find(".repeat-every-panel"),this.$repeatIntervalSelect=this.$element.find(".repeat-options"),this.$repeatIntervalSpinbox=this.$element.find(".repeat-every"),this.$repeatIntervalTxt=this.$element.find(".repeat-every-text"),this.$end=this.$element.find(".repeat-end"),this.$endSelect=this.$end.find(".end-options"),this.$endAfter=this.$end.find(".end-after"),this.$endDate=this.$end.find(".end-on-date"),this.$recurrencePanels=this.$element.find(".repeat-panel"),this.$repeatIntervalSelect.selectlist(),this.$element.find(".selectlist").selectlist(),this.$startDate.datepicker(this.options.startDateOptions);var a="function"==typeof this.options.startDateChanged?this.options.startDateChanged:this._guessEndDate;this.$startDate.on("change changed.fu.datepicker dateClicked.fu.datepicker",n.proxy(a,this)),this.$startTime.combobox(),""===this.$startTime.find("input").val()&&this.$startTime.combobox("selectByIndex",0),"0"===this.$repeatIntervalSpinbox.find("input").val()?this.$repeatIntervalSpinbox.spinbox({value:1,min:1,limitToStep:!0}):this.$repeatIntervalSpinbox.spinbox({min:1,limitToStep:!0}),this.$endAfter.spinbox({value:1,min:1,limitToStep:!0}),this.$endDate.datepicker(this.options.endDateOptions),this.$element.find(".radio-custom").radio(),this.$repeatIntervalSelect.on("changed.fu.selectlist",n.proxy(this.repeatIntervalSelectChanged,this)),this.$endSelect.on("changed.fu.selectlist",n.proxy(this.endSelectChanged,this)),this.$element.find(".repeat-days-of-the-week .btn-group .btn").on("change.fu.scheduler",function(e,t){s.changed(e,t,!0)}),this.$element.find(".combobox").on("changed.fu.combobox",n.proxy(this.changed,this)),this.$element.find(".datepicker").on("changed.fu.datepicker",n.proxy(this.changed,this)),this.$element.find(".datepicker").on("dateClicked.fu.datepicker",n.proxy(this.changed,this)),this.$element.find(".selectlist").on("changed.fu.selectlist",n.proxy(this.changed,this)),this.$element.find(".spinbox").on("changed.fu.spinbox",n.proxy(this.changed,this)),this.$element.find(".repeat-monthly .radio-custom, .repeat-yearly .radio-custom").on("change.fu.scheduler",n.proxy(this.changed,this))},d=function(e,t){var i,s="";return s+=e.getFullYear(),s+=t,i=e.getMonth()+1,s+=i<10?"0"+i:i,s+=t,i=e.getDate(),s+=i<10?"0"+i:i},o=1e3,h=60*o,c=60*h,m=24*c,p=7*m,u=5*p,f=52*p,y={secondly:o,minutely:h,hourly:c,daily:m,weekly:p,monthly:u,yearly:f},$=function(e,t,i,s){return new Date(e.getTime()+y[i]*s)};r.prototype={constructor:r,destroy:function(){var e;return this.$element.find("input").each(function(){n(this).attr("value",n(this).val())}),this.$element.find(".datepicker .calendar").empty(),e=this.$element[0].outerHTML,this.$element.find(".combobox").combobox("destroy"),this.$element.find(".datepicker").datepicker("destroy"),this.$element.find(".selectlist").selectlist("destroy"),this.$element.find(".spinbox").spinbox("destroy"),this.$element.find(".radio-custom").radio("destroy"),this.$element.remove(),e},changed:function(e,t,i){i||e.stopPropagation(),this.$element.trigger("changed.fu.scheduler",{data:void 0!==t?t:n(e.currentTarget).data(),originalEvent:e,value:this.getValue()})},disable:function(){this.toggleState("disable")},enable:function(){this.toggleState("enable")},setUtcTime:function(e,t,i){var s=e.split("-"),a=t.split(":"),n=new Date(Date.UTC(s[0],s[1]-1,s[2],a[0],a[1],a[2]?a[2]:0));if("Z"===i)n.setUTCHours(n.getUTCHours()+0);else{var l=[];l[0]="(.)",l[1]=".*?",l[2]="\\d",l[3]=".*?",l[4]="(\\d)";var r=new RegExp(l.join(""),["i"]),d=r.exec(i);if(null!==d){var o=d[1],h=d[2],c="+"===o?1:-1;n.setUTCHours(n.getUTCHours()+c*parseInt(h,10))}}var m=n.getTimezoneOffset();return n.setMinutes(m),n},endSelectChanged:function(e,t){var i,s;t?s=t.value:(i=this.$endSelect.selectlist("selectedItem"),s=i.value),this.$endAfter.parent().addClass("hidden"),this.$endAfter.parent().attr("aria-hidden","true"),this.$endDate.parent().addClass("hidden"),this.$endDate.parent().attr("aria-hidden","true"),"after"===s?(this.$endAfter.parent().removeClass("hide hidden"),this.$endAfter.parent().attr("aria-hidden","false")):"date"===s&&(this.$endDate.parent().removeClass("hide hidden"),this.$endDate.parent().attr("aria-hidden","false"))},_guessEndDate:function(){var e=this.$repeatIntervalSelect.selectlist("selectedItem").value,t=new Date(this.$endDate.datepicker("getDate")),i=new Date(this.$startDate.datepicker("getDate")),s=this.$repeatIntervalSpinbox.find("input").val();"none"!==e&&t<=i&&(this.$repeatIntervalSpinbox.is(":visible")||(s=1),"weekdays"===e&&(s=1,e="weekly"),t=$(i,t,e,s),this.$endDate.datepicker("setDate",t))},getValue:function(){var e,t=this.$repeatIntervalSpinbox.spinbox("value"),i="",s=this.$repeatIntervalSelect.selectlist("selectedItem").value;this.$startTime.combobox("selectedItem").value?(e=this.$startTime.combobox("selectedItem").value,e=e.toLowerCase()):e=this.$startTime.combobox("selectedItem").text.toLowerCase();var a,l,r,o,h,c,m,p,u=this.$timeZone.selectlist("selectedItem");m=""+d(this.$startDate.datepicker("getDate"),"-"),m+="T",r=e.search("am")>=0,o=e.search("pm")>=0,e=n.trim(e.replace(/am/g,"").replace(/pm/g,"")).split(":"),e[0]=parseInt(e[0],10),e[1]=parseInt(e[1],10),r&&e[0]>11?e[0]=0:o&&e[0]<12&&(e[0]+=12),m+=e[0]<10?"0"+e[0]:e[0],m+=":",m+=e[1]<10?"0"+e[1]:e[1],m+="+00:00"===u.offset?"Z":u.offset,"none"===s?i="FREQ=DAILY;INTERVAL=1;COUNT=1;":"secondly"===s?(i="FREQ=SECONDLY;",i+="INTERVAL="+t+";"):"minutely"===s?(i="FREQ=MINUTELY;",i+="INTERVAL="+t+";"):"hourly"===s?(i="FREQ=HOURLY;",i+="INTERVAL="+t+";"):"daily"===s?(i+="FREQ=DAILY;",i+="INTERVAL="+t+";"):"weekdays"===s?(i+="FREQ=WEEKLY;",i+="BYDAY=MO,TU,WE,TH,FR;",i+="INTERVAL=1;"):"weekly"===s?(l=[],this.$element.find(".repeat-days-of-the-week .btn-group input:checked").each(function(){l.push(n(this).data().value)}),i+="FREQ=WEEKLY;",i+="BYDAY="+l.join(",")+";",i+="INTERVAL="+t+";"):"monthly"===s?(i+="FREQ=MONTHLY;",i+="INTERVAL="+t+";",p=this.$element.find("input[name=repeat-monthly]:checked").val(),"bymonthday"===p?(a=parseInt(this.$element.find(".repeat-monthly-date .selectlist").selectlist("selectedItem").text,10),i+="BYMONTHDAY="+a+";"):"bysetpos"===p&&(l=this.$element.find(".repeat-monthly-day .month-days").selectlist("selectedItem").value,c=this.$element.find(".repeat-monthly-day .month-day-pos").selectlist("selectedItem").value,i+="BYDAY="+l+";",i+="BYSETPOS="+c+";")):"yearly"===s&&(i+="FREQ=YEARLY;",p=this.$element.find("input[name=repeat-yearly]:checked").val(),"bymonthday"===p?(h=this.$element.find(".repeat-yearly-date .year-month").selectlist("selectedItem").value,a=this.$element.find(".repeat-yearly-date .year-month-day").selectlist("selectedItem").text,i+="BYMONTH="+h+";",i+="BYMONTHDAY="+a+";"):"bysetpos"===p&&(l=this.$element.find(".repeat-yearly-day .year-month-days").selectlist("selectedItem").value,c=this.$element.find(".repeat-yearly-day .year-month-day-pos").selectlist("selectedItem").value,h=this.$element.find(".repeat-yearly-day .year-month").selectlist("selectedItem").value,i+="BYDAY="+l+";",i+="BYSETPOS="+c+";",i+="BYMONTH="+h+";"));var f=this.$endSelect.selectlist("selectedItem").value,y="";"none"!==s&&("after"===f?y="COUNT="+this.$endAfter.spinbox("value")+";":"date"===f&&(y="UNTIL="+d(this.$endDate.datepicker("getDate"),"")+";")),i+=y,i=";"===i.substring(i.length-1)?i.substring(0,i.length-1):i;var $={startDateTime:m,timeZone:u,recurrencePattern:i};return $},repeatIntervalSelectChanged:function(e,t){var i,s,a;switch(t?(s=t.value,a=t.text):(i=this.$repeatIntervalSelect.selectlist("selectedItem"),s=i.value||"",a=i.text||""),this.$repeatIntervalTxt.text(a),s.toLowerCase()){case"hourly":case"daily":case"weekly":case"monthly":this.$repeatIntervalPanel.removeClass("hide hidden"),this.$repeatIntervalPanel.attr("aria-hidden","false");break;default:this.$repeatIntervalPanel.addClass("hidden"),this.$repeatIntervalPanel.attr("aria-hidden","true")}this.$recurrencePanels.addClass("hidden"),this.$recurrencePanels.attr("aria-hidden","true"),this.$element.find(".repeat-"+s).removeClass("hide hidden"),this.$element.find(".repeat-"+s).attr("aria-hidden","false"),"none"===s?(this.$end.addClass("hidden"),this.$end.attr("aria-hidden","true")):(this.$end.removeClass("hide hidden"),this.$end.attr("aria-hidden","false")),this._guessEndDate()},_parseAndSetRecurrencePattern:function(e,t){var i,s,a,n,l={},r=0,d="",o=e.toUpperCase().split(";");for(r=0;r<o.length;r++)""!==o[r]&&(d=o[r].split("="),l[d[0]]=d[1]);if("DAILY"===l.FREQ)d="MO,TU,WE,TH,FR"===l.BYDAY?"weekdays":"1"===l.INTERVAL&&"1"===l.COUNT?"none":"daily";else if("SECONDLY"===l.FREQ)d="secondly";else if("MINUTELY"===l.FREQ)d="minutely";else if("HOURLY"===l.FREQ)d="hourly";else if("WEEKLY"===l.FREQ){if(d="weekly",l.BYDAY)if("MO,TU,WE,TH,FR"===l.BYDAY)d="weekdays";else{var h=this.$element.find(".repeat-days-of-the-week .btn-group");for(h.find("label").removeClass("active"),i=l.BYDAY.split(","),r=0;r<i.length;r++)h.find('input[data-value="'+i[r]+'"]').prop("checked",!0).parent().addClass("active")}}else if("MONTHLY"===l.FREQ){if(this.$element.find(".repeat-monthly input").removeAttr("checked").removeClass("checked"),this.$element.find(".repeat-monthly label.radio-custom").removeClass("checked"),l.BYMONTHDAY)s=this.$element.find(".repeat-monthly-date"),s.find("input").addClass("checked").prop("checked",!0),s.find("label.radio-custom").addClass("checked"),s.find(".selectlist").selectlist("selectByValue",l.BYMONTHDAY);else if(l.BYDAY){var c=this.$element.find(".repeat-monthly-day");c.find("input").addClass("checked").prop("checked",!0),c.find("label.radio-custom").addClass("checked"),l.BYSETPOS&&c.find(".month-day-pos").selectlist("selectByValue",l.BYSETPOS),c.find(".month-days").selectlist("selectByValue",l.BYDAY)}d="monthly"}else"YEARLY"===l.FREQ?(this.$element.find(".repeat-yearly input").removeAttr("checked").removeClass("checked"),this.$element.find(".repeat-yearly label.radio-custom").removeClass("checked"),l.BYMONTHDAY?(a=this.$element.find(".repeat-yearly-date"),a.find("input").addClass("checked").prop("checked",!0),a.find("label.radio-custom").addClass("checked"),l.BYMONTH&&a.find(".year-month").selectlist("selectByValue",l.BYMONTH),a.find(".year-month-day").selectlist("selectByValue",l.BYMONTHDAY)):l.BYSETPOS&&(n=this.$element.find(".repeat-yearly-day"),n.find("input").addClass("checked").prop("checked",!0),n.find("label.radio-custom").addClass("checked"),n.find(".year-month-day-pos").selectlist("selectByValue",l.BYSETPOS),l.BYDAY&&n.find(".year-month-days").selectlist("selectByValue",l.BYDAY),l.BYMONTH&&n.find(".year-month").selectlist("selectByValue",l.BYMONTH)),d="yearly"):d="none";if(l.COUNT)this.$endAfter.spinbox("value",parseInt(l.COUNT,10)),this.$endSelect.selectlist("selectByValue","after");else if(l.UNTIL){var m,p;8===l.UNTIL.length&&(m=l.UNTIL.split(""),m.splice(4,0,"-"),m.splice(7,0,"-"),p=m.join(""));var u=this.$timeZone.selectlist("selectedItem"),f="+00:00"===u.offset?"Z":u.offset,y=this.setUtcTime(p,t.time24HourFormat,f);this.$endDate.datepicker("setDate",y),this.$endSelect.selectlist("selectByValue","date")}else this.$endSelect.selectlist("selectByValue","never");this.endSelectChanged(),l.INTERVAL&&this.$repeatIntervalSpinbox.spinbox("value",parseInt(l.INTERVAL,10)),this.$repeatIntervalSelect.selectlist("selectByValue",d),this.repeatIntervalSelectChanged()},_parseStartDateTime:function(e){var t,i,s,a={};return a.time24HourFormat=e.split("+")[0].split("-")[0],e.search(/\+/)>-1?a.timeZoneOffset="+"+n.trim(e.split("+")[1]):e.search(/\-/)>-1?a.timeZoneOffset="-"+n.trim(e.split("-")[1]):a.timeZoneOffset="+00:00",a.time24HourFormatSplit=a.time24HourFormat.split(":"),t=parseInt(a.time24HourFormatSplit[0],10),i=a.time24HourFormatSplit[1]?parseInt(a.time24HourFormatSplit[1].split("+")[0].split("-")[0].split("Z")[0],10):0,s=t<12?"AM":"PM",0===t?t=12:t>12&&(t-=12),i=i<10?"0"+i:i,a.time12HourFormat=t+":"+i,a.time12HourFormatWithPeriod=t+":"+i+" "+s,a},_parseTimeZone:function(e,t){return t.timeZoneQuerySelector="",e.timeZone?("string"==typeof e.timeZone?t.timeZoneQuerySelector+='li[data-name="'+e.timeZone+'"]':n.each(e.timeZone,function(e,i){t.timeZoneQuerySelector+="li[data-"+e+'="'+i+'"]'}),t.timeZoneOffset=e.timeZone.offset):e.startDateTime?(t.timeZoneOffset="+00:00"===t.timeZoneOffset?"Z":t.timeZoneOffset,t.timeZoneQuerySelector+='li[data-offset="'+t.timeZoneOffset+'"]'):t.timeZoneOffset="Z",t.timeZoneOffset},_setTimeUI:function(e){this.$startTime.find("input").val(e),this.$startTime.combobox("selectByText",e)},_setTimeZoneUI:function(e){this.$timeZone.selectlist("selectBySelector",e)},setValue:function(e){var t,i,s,a,n={};if(e.startDateTime)t=e.startDateTime.split("T"),i=t[0],s=t[1],s?(n=this._parseStartDateTime(s),this._setTimeUI(n.time12HourFormatWithPeriod)):(n.time12HourFormat="00:00",n.time24HourFormat="00:00");else{n.time12HourFormat="00:00",n.time24HourFormat="00:00";var l=this.$startDate.datepicker("getDate");i=l.getFullYear()+"-"+l.getMonth()+"-"+l.getDate()}this._parseTimeZone(e,n),n.timeZoneQuerySelector&&this._setTimeZoneUI(n.timeZoneQuerySelector),e.recurrencePattern&&this._parseAndSetRecurrencePattern(e.recurrencePattern,n),a=this.setUtcTime(i,n.time24HourFormat,n.timeZoneOffset),this.$startDate.datepicker("setDate",a)},toggleState:function(e){this.$element.find(".combobox").combobox(e),this.$element.find(".datepicker").datepicker(e),this.$element.find(".selectlist").selectlist(e),this.$element.find(".spinbox").spinbox(e),this.$element.find(".radio-custom").radio(e),e="disable"===e?"addClass":"removeClass",this.$element.find(".repeat-days-of-the-week .btn-group")[e]("disabled")},value:function(e){return e?this.setValue(e):this.getValue()}},n.fn.scheduler=function(e){var t,i=Array.prototype.slice.call(arguments,1),s=this.each(function(){var s=n(this),a=s.data("fu.scheduler"),l="object"==typeof e&&e;a||s.data("fu.scheduler",a=new r(this,l)),"string"==typeof e&&(t=a[e].apply(a,i))});return void 0===t?s:t},n.fn.scheduler.defaults={},n.fn.scheduler.Constructor=r,n.fn.scheduler.noConflict=function(){return n.fn.scheduler=l,this},n(document).on("mousedown.fu.scheduler.data-api","[data-initialize=scheduler]",function(e){var t=n(e.target).closest(".scheduler");t.data("fu.scheduler")||t.scheduler(t.data())}),n(function(){n("[data-initialize=scheduler]").each(function(){var e=n(this);e.data("scheduler")||e.scheduler(e.data())})})});
//# sourceMappingURL=sourcemaps/scheduler.js.map
