/**
 * skylark-bs-swt - The skylark bootstrap standard widget tookit
 * @author Hudaokeji, Inc.
 * @version v0.9.0-beta
 * @link https://github.com/skylarkui/skylark-bs-swt/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/velm","skylark-utils/query","../../menu","../../tree","../../sbswt"],function(e,t,n,r,o,a,s,i,c,l){"use strict";if(!s.jstree.plugins.contextmenu)return s.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(e,t){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var t=s.jstree.reference(e.reference),n=t.get_node(e.reference);t.create_node(n,{},"last",function(e){try{t.edit(e)}catch(n){setTimeout(function(){t.edit(e)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var t=s.jstree.reference(e.reference),n=t.get_node(e.reference);t.edit(n)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var t=s.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.delete_node(t.get_selected()):t.delete_node(n)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var t=s.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.cut(t.get_top_selected()):t.cut(n)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var t=s.jstree.reference(e.reference),n=t.get_node(e.reference);t.is_selected(n)?t.copy(t.get_top_selected()):t.copy(n)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!s.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var t=s.jstree.reference(e.reference),n=t.get_node(e.reference);t.paste(n)}}}}}}},s.jstree.plugins.contextmenu=function(e,t){this.bind=function(){t.bind.call(this);var e,n,r=0,o=null;this.element.on("init.jstree loading.jstree ready.jstree",s.proxy(function(){this.get_container_ul().addClass("jstree-contextmenu")},this)).on("contextmenu.jstree",".jstree-anchor",s.proxy(function(e,t){"input"!==e.target.tagName.toLowerCase()&&(e.preventDefault(),r=e.ctrlKey?+new Date:0,(t||o)&&(r=+new Date+1e4),o&&clearTimeout(o),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e))},this)).on("click.jstree",".jstree-anchor",s.proxy(function(e){this._data.contextmenu.visible&&(!r||+new Date-r>250)&&s.vakata.context.hide(),r=0},this)).on("touchstart.jstree",".jstree-anchor",function(t){t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(e=t.originalEvent.changedTouches[0].clientX,n=t.originalEvent.changedTouches[0].clientY,o=setTimeout(function(){s(t.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(t){o&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(Math.abs(e-t.originalEvent.changedTouches[0].clientX)>10||Math.abs(n-t.originalEvent.changedTouches[0].clientY)>10)&&(clearTimeout(o),s.vakata.context.hide())}).on("touchend.vakata.jstree",function(e){o&&clearTimeout(o)}),s(document).on("context_hide.vakata.jstree",s.proxy(function(e,t){this._data.contextmenu.visible=!1,s(t.reference).removeClass("jstree-context")},this))},this.teardown=function(){this._data.contextmenu.visible&&s.vakata.context.hide(),t.teardown.call(this)},this.show_contextmenu=function(e,t,n,r){if(e=this.get_node(e),!e||e.id===s.jstree.root)return!1;var o=this.settings.contextmenu,a=this.get_node(e,!0),i=a.children(".jstree-anchor"),c=!1,l=!1;(o.show_at_node||void 0===t||void 0===n)&&(c=i.offset(),t=c.left,n=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(e)&&this.activate_node(e,r),l=o.items,s.isFunction(l)&&(l=l.call(this,e,s.proxy(function(r){this._show_contextmenu(e,t,n,r)},this))),s.isPlainObject(l)&&this._show_contextmenu(e,t,n,l)},this._show_contextmenu=function(e,t,n,r){var o=this.get_node(e,!0),a=o.children(".jstree-anchor");s(document).one("context_show.vakata.jstree",s.proxy(function(e,t){var n="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";s(t.element).addClass(n),a.addClass("jstree-context")},this)),this._data.contextmenu.visible=!0,s.vakata.context.show(a,{x:t,y:n},r),this.trigger("show_contextmenu",{node:e,x:t,y:n})}},s.vakata.context=i,s});
//# sourceMappingURL=../../sourcemaps/plugin/tree/contextmenu.js.map
