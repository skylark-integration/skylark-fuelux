/**
 * skylark-bs-swt - The skylark bootstrap standard widget tookit
 * @author Hudaokeji, Inc.
 * @version v0.9.0-beta
 * @link https://github.com/skylarkui/skylark-bs-swt/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/query"],function(t,e,i,l,a,s){var n=s.fn.placard,c={accepted:"onAccept",cancelled:"onCancel"},r=function(e,i){var l=this;this.$element=s(e),this.options=t.mixin({},s.fn.placard.defaults,i),"true"===this.$element.attr("data-ellipsis")&&(this.options.applyEllipsis=!0),this.$accept=this.$element.find(".placard-accept"),this.$cancel=this.$element.find(".placard-cancel"),this.$field=this.$element.find(".placard-field"),this.$footer=this.$element.find(".placard-footer"),this.$header=this.$element.find(".placard-header"),this.$popup=this.$element.find(".placard-popup"),this.actualValue=null,this.clickStamp="_",this.previousValue="",this.options.revertOnCancel===-1&&(this.options.revertOnCancel=this.$accept.length>0),this.isContentEditableDiv=this.$field.is("div"),this.isInput=this.$field.is("input"),this.divInTextareaMode=this.isContentEditableDiv&&"true"===this.$field.attr("data-textarea"),this.$field.on("focus.fu.placard",s.proxy(this.show,this)),this.$field.on("keydown.fu.placard",s.proxy(this.keyComplete,this)),this.$element.on("close.fu.placard",s.proxy(this.hide,this)),this.$accept.on("click.fu.placard",s.proxy(this.complete,this,"accepted")),this.$cancel.on("click.fu.placard",function(t){t.preventDefault(),l.complete("cancelled")}),this.applyEllipsis()},h=function(t){return t.$element.hasClass("showing")},o=function(){var t;if(t=s(document).find(".placard.showing"),t.length>0){if(t.data("fu.placard")&&t.data("fu.placard").options.explicit)return!1;t.placard("externalClickListener",{},!0)}return!0};r.prototype={constructor:r,complete:function(t){var e=this.options[c[t]],i={previousValue:this.previousValue,value:this.getValue()};e?(e(i),this.$element.trigger(t+".fu.placard",i)):("cancelled"===t&&this.options.revertOnCancel&&this.setValue(this.previousValue,!0),this.$element.trigger(t+".fu.placard",i),this.hide())},keyComplete:function(t){(this.isContentEditableDiv&&!this.divInTextareaMode||this.isInput)&&13===t.keyCode?(this.complete("accepted"),this.$field.blur()):27===t.keyCode&&(this.complete("cancelled"),this.$field.blur())},destroy:function(){return this.$element.remove(),s(document).off("click.fu.placard.externalClick."+this.clickStamp),this.$element.find("input").each(function(){s(this).attr("value",s(this).val())}),this.$element[0].outerHTML},disable:function(){this.$element.addClass("disabled"),this.$field.attr("disabled","disabled"),this.isContentEditableDiv&&this.$field.removeAttr("contenteditable"),this.hide()},applyEllipsis:function(){var t,e,i;if(this.options.applyEllipsis)if(t=this.$field.get(0),this.isContentEditableDiv&&!this.divInTextareaMode||this.isInput)t.scrollLeft=0;else if(t.scrollTop=0,t.clientHeight<t.scrollHeight){for(this.actualValue=this.getValue(),this.setValue("",!0),i="",e=0;t.clientHeight>=t.scrollHeight;)i+=this.actualValue[e],this.setValue(i+"...",!0),e++;i=i.length>0?i.substring(0,i.length-1):"",this.setValue(i+"...",!0)}},enable:function(){this.$element.removeClass("disabled"),this.$field.removeAttr("disabled"),this.isContentEditableDiv&&this.$field.attr("contenteditable","true")},externalClickListener:function(t,e){(e===!0||this.isExternalClick(t))&&this.complete(this.options.externalClickAction)},getValue:function(){return null!==this.actualValue?this.actualValue:this.isContentEditableDiv?this.$field.html():this.$field.val()},hide:function(){this.$element.hasClass("showing")&&(this.$element.removeClass("showing"),this.applyEllipsis(),s(document).off("click.fu.placard.externalClick."+this.clickStamp),this.$element.trigger("hidden.fu.placard"))},isExternalClick:function(t){var e,i,l=this.$element.get(0),a=this.options.externalClickExceptions||[],n=s(t.target);if(t.target===l||n.parents(".placard:first").get(0)===l)return!1;for(e=0,i=a.length;e<i;e++)if(n.is(a[e])||n.parents(a[e]).length>0)return!1;return!0},setValue:function(t,e){return"undefined"==typeof e&&(e=!this.options.applyEllipsis),this.isContentEditableDiv?this.$field.empty().append(t):this.$field.val(t),e||h(this)||this.applyEllipsis(),this.$field},show:function(){h(this)||o()&&(this.previousValue=this.isContentEditableDiv?this.$field.html():this.$field.val(),null!==this.actualValue&&(this.setValue(this.actualValue,!0),this.actualValue=null),this.showPlacard())},showPlacard:function(){this.$element.addClass("showing"),this.$header.length>0&&this.$popup.css("top","-"+this.$header.outerHeight(!0)+"px"),this.$footer.length>0&&this.$popup.css("bottom","-"+this.$footer.outerHeight(!0)+"px"),this.$element.trigger("shown.fu.placard"),this.clickStamp=(new Date).getTime()+(Math.floor(100*Math.random())+1),this.options.explicit||s(document).on("click.fu.placard.externalClick."+this.clickStamp,s.proxy(this.externalClickListener,this))}},s.fn.placard=function(t){var e,i=Array.prototype.slice.call(arguments,1),l=this.each(function(){var l=s(this),a=l.data("fu.placard"),n="object"==typeof t&&t;a||l.data("fu.placard",a=new r(this,n)),"string"==typeof t&&(e=a[t].apply(a,i))});return void 0===e?l:e},s.fn.placard.defaults={onAccept:void 0,onCancel:void 0,externalClickAction:"cancelled",externalClickExceptions:[],explicit:!1,revertOnCancel:-1,applyEllipsis:!1},s.fn.placard.Constructor=r,s.fn.placard.noConflict=function(){return s.fn.placard=n,this},s(document).on("focus.fu.placard.data-api","[data-initialize=placard]",function(t){var e=s(t.target).closest(".placard");e.data("fu.placard")||e.placard(e.data())}),s(function(){s("[data-initialize=placard]").each(function(){var t=s(this);t.data("fu.placard")||t.placard(t.data())})})});
//# sourceMappingURL=sourcemaps/placard.js.map
