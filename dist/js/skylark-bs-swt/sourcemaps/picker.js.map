{"version":3,"sources":["picker.js"],"names":["define","langx","browser","eventer","noder","geom","$","old","fn","picker","Picker","element","options","self","this","$element","mixin","defaults","$accept","find","$cancel","$trigger","$footer","$header","$popup","$body","clickStamp","isInput","is","on","proxy","keyComplete","e","target","show","toggle","complete","preventDefault","_isOffscreen","windowHeight","Math","max","document","documentElement","clientHeight","window","innerHeight","scrollTop","popupTop","offset","popupBottom","top","outerHeight","_display","css","_showBelow","_showAbove","prototype","constructor","action","EVENT_CALLBACK_MAP","accepted","cancelled","exited","func","obj","contents","trigger","hide","keyCode","blur","destroy","remove","off","outerHTML","disable","addClass","attr","enable","removeClass","removeAttr","hasClass","externalClickListener","force","isExternalClick","i","l","el","get","exceptions","externalClickExceptions","$originEl","parents","length","other","data","explicit","Date","getTime","floor","random","option","methodReturn","args","Array","slice","call","arguments","$set","each","$this","apply","undefined","onAccept","onCancel","onExit","Constructor","noConflict","$control","closest"],"mappings":";;;;;;;AAAAA,QACE,sBACA,wBACA,wBACA,sBACA,qBACA,uBACA,SAASC,EAAMC,EAAQC,EAAQC,EAAMC,EAAKC,GAS3C,GAAIC,GAAMD,EAAEE,GAAGC,OAIXC,EAAS,SAAgBC,EAASC,GACrC,GAAIC,GAAOC,IACXA,MAAKC,SAAWT,EAAEK,GAClBG,KAAKF,QAAUX,EAAMe,SAAUV,EAAEE,GAAGC,OAAOQ,SAAUL,GAErDE,KAAKI,QAAUJ,KAAKC,SAASI,KAAK,kBAClCL,KAAKM,QAAUN,KAAKC,SAASI,KAAK,kBAClCL,KAAKO,SAAWP,KAAKC,SAASI,KAAK,mBACnCL,KAAKQ,QAAUR,KAAKC,SAASI,KAAK,kBAClCL,KAAKS,QAAUT,KAAKC,SAASI,KAAK,kBAClCL,KAAKU,OAASV,KAAKC,SAASI,KAAK,iBACjCL,KAAKW,MAAQX,KAAKC,SAASI,KAAK,gBAEhCL,KAAKY,WAAa,IAElBZ,KAAKa,QAAUb,KAAKO,SAASO,GAAG,SAEhCd,KAAKO,SAASQ,GAAG,oBAAqBvB,EAAEwB,MAAMhB,KAAKiB,YAAajB,OAChEA,KAAKO,SAASQ,GAAG,kBAAmBvB,EAAEwB,MAAM,SAAoBE,IAC/C,mBAANA,IAAqB1B,EAAE0B,EAAEC,QAAQL,GAAG,sBAC7CtB,EAAEwB,MAAMhB,KAAKoB,OAAQpB,OAEpBA,OACHA,KAAKO,SAASQ,GAAG,kBAAmBvB,EAAEwB,MAAM,SAAsBE,GAC7D1B,EAAE0B,EAAEC,QAAQL,GAAG,oBAGlBtB,EAAEwB,MAAMhB,KAAKoB,OAAQpB,MAFrBR,EAAEwB,MAAMhB,KAAKqB,SAAUrB,OAItBA,OACHA,KAAKI,QAAQW,GAAG,kBAAmBvB,EAAEwB,MAAMhB,KAAKsB,SAAUtB,KAAM,aAChEA,KAAKM,QAAQS,GAAG,kBAAmB,SAAUG,GAC5CA,EAAEK,iBAAkBxB,EAAKuB,SAAS,gBAMhCE,EAAe,SAAsB7B,GACxC,GAAI8B,GAAeC,KAAKC,IAAIC,SAASC,gBAAgBC,aAAcC,OAAOC,aAAe,GACrFC,EAAYzC,EAAEoC,UAAUK,YACxBC,EAAWvC,EAAOe,OAAOyB,SACzBC,EAAcF,EAASG,IAAM1C,EAAOe,OAAO4B,aAAY,EAG3D,OAAIF,GAAcX,EAAeQ,GAAaC,EAASG,IAAMJ,GAO1DM,EAAW,SAAkB5C,GAChCA,EAAOe,OAAO8B,IAAI,aAAc,UAEhCC,EAAW9C,GAGR6B,EAAa7B,KACf+C,EAAW/C,GAGR6B,EAAa7B,IACf8C,EAAW9C,IAIbA,EAAOe,OAAO8B,IAAI,aAAc,YAG7BE,EAAa,SAAoB/C,GACpCA,EAAOe,OAAO8B,IAAI,OAAS7C,EAAOe,OAAO4B,aAAY,GAAQ,OAG1DG,EAAa,SAAoB9C,GACpCA,EAAOe,OAAO8B,IAAI,MAAO7C,EAAOY,SAAS+B,aAAY,GAAQ,MAG9D1C,GAAO+C,WACNC,YAAahD,EAEb0B,SAAU,SAAkBuB,GAC3B,GAAIC,IACHC,SAAY,WACZC,UAAa,WACbC,OAAU,UAEPC,EAAOlD,KAAKF,QAASgD,EAAmBD,IAExCM,GACHC,SAAUpD,KAAKW,MAGZuC,IACHA,EAAKC,GACLnD,KAAKC,SAASoD,QAAQR,EAAS,aAAcM,KAE7CnD,KAAKC,SAASoD,QAAQR,EAAS,aAAcM,GAC7CnD,KAAKsD,SAIPrC,YAAa,SAAqBC,GAC7BlB,KAAKa,SAAyB,KAAdK,EAAEqC,SACrBvD,KAAKsB,SAAS,YACdtB,KAAKO,SAASiD,QACU,KAAdtC,EAAEqC,UACZvD,KAAKsB,SAAS,UACdtB,KAAKO,SAASiD,SAIhBC,QAAS,WAOR,MANAzD,MAAKC,SAASyD,SAEdlE,EAAEoC,UAAU+B,IAAI,iCAAmC3D,KAAKY,YAIjDZ,KAAKC,SAAS,GAAG2D,WAGzBC,QAAS,WACR7D,KAAKC,SAAS6D,SAAS,YACvB9D,KAAKO,SAASwD,KAAK,WAAY,aAGhCC,OAAQ,WACPhE,KAAKC,SAASgE,YAAY,YAC1BjE,KAAKO,SAAS2D,WAAW,aAG1B7C,OAAQ,WACHrB,KAAKC,SAASkE,SAAS,WAC1BnE,KAAKsD,OAELtD,KAAKoB,QAIPkC,KAAM,WACAtD,KAAKC,SAASkE,SAAS,aAI5BnE,KAAKC,SAASgE,YAAY,WAC1BzE,EAAEoC,UAAU+B,IAAI,iCAAmC3D,KAAKY,YACxDZ,KAAKC,SAASoD,QAAQ,sBAGvBe,sBAAuB,SAA+BlD,EAAGmD,IACpDA,KAAU,GAAQrE,KAAKsE,gBAAgBpD,KAC1ClB,KAAKsB,SAAS,WAIhBgD,gBAAiB,SAAyBpD,GACzC,GAGIqD,GAAGC,EAHHC,EAAKzE,KAAKC,SAASyE,IAAI,GACvBC,EAAa3E,KAAKF,QAAQ8E,4BAC1BC,EAAYrF,EAAE0B,EAAEC,OAGpB,IAAID,EAAEC,SAAWsD,GAAMI,EAAUC,QAAQ,iBAAiBJ,IAAI,KAAOD,EACpE,OAAO,CAEP,KAAKF,EAAI,EAAGC,EAAIG,EAAWI,OAAQR,EAAIC,EAAGD,IACzC,GAAIM,EAAU/D,GAAG6D,EAAWJ,KAAOM,EAAUC,QAAQH,EAAWJ,IAAIQ,OAAS,EAC5E,OAAO,CAMV,QAAO,GAGR3D,KAAM,WACL,GAAI4D,EAGJ,IADAA,EAAQxF,EAAEoC,UAAUvB,KAAK,mBACrB2E,EAAMD,OAAS,EAAG,CACrB,GAAIC,EAAMC,KAAK,cAAgBD,EAAMC,KAAK,aAAanF,QAAQoF,SAC9D,MAGDF,GAAMrF,OAAO,4BAA6B,GAG3CK,KAAKC,SAAS6D,SAAS,WAEvBvB,EAASvC,MAETA,KAAKC,SAASoD,QAAQ,mBAEtBrD,KAAKY,YAAa,GAAIuE,OAAOC,WAAa1D,KAAK2D,MAAsB,IAAhB3D,KAAK4D,UAAkB,GACvEtF,KAAKF,QAAQoF,UACjB1F,EAAEoC,UAAUb,GAAG,iCAAmCf,KAAKY,WAAYpB,EAAEwB,MAAMhB,KAAKoE,sBAAuBpE,SAO1GR,EAAEE,GAAGC,OAAS,SAAgB4F,GAC7B,GACIC,GADAC,EAAOC,MAAM/C,UAAUgD,MAAMC,KAAKC,UAAW,GAG7CC,EAAO9F,KAAK+F,KAAK,WACpB,GAAIC,GAAQxG,EAAEQ,MACViF,EAAOe,EAAMf,KAAK,aAClBnF,EAA4B,gBAAXyF,IAAuBA,CAEvCN,IACJe,EAAMf,KAAK,YAAcA,EAAO,GAAIrF,GAAOI,KAAMF,IAG5B,gBAAXyF,KACVC,EAAeP,EAAKM,GAAQU,MAAMhB,EAAMQ,KAI1C,OAAyBS,UAAjBV,EAA8BM,EAAON,GAG9ChG,EAAEE,GAAGC,OAAOQ,UACXgG,SAAUD,OACVE,SAAUF,OACVG,OAAQH,OACRtB,2BACAM,UAAU,GAGX1F,EAAEE,GAAGC,OAAO2G,YAAc1G,EAE1BJ,EAAEE,GAAGC,OAAO4G,WAAa,WAExB,MADA/G,GAAEE,GAAGC,OAASF,EACPO,MAKRR,EAAEoC,UAAUb,GAAG,2BAA4B,2BAA4B,SAAUG,GAChF,GAAIsF,GAAWhH,EAAE0B,EAAEC,QAAQsF,QAAQ,UAC9BD,GAASvB,KAAK,cAClBuB,EAAS7G,OAAO6G,EAASvB,UAK3BzF,EAAE,WACDA,EAAE,4BAA4BuG,KAAK,WAClC,GAAIC,GAAQxG,EAAEQ,KACVgG,GAAMf,KAAK,cACfe,EAAMrG,OAAOqG,EAAMf","file":"../picker.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/query\"\n],function(langx,browser,eventer,noder,geom,$){\n\n\t/*\n\t * Fuel UX Checkbox\n\t * https://github.com/ExactTarget/fuelux\n\t *\n\t * Copyright (c) 2014 ExactTarget\n\t * Licensed under the BSD New license.\n\t */\n\tvar old = $.fn.picker;\n\n\t// PLACARD CONSTRUCTOR AND PROTOTYPE\n\n\tvar Picker = function Picker(element, options) {\n\t\tvar self = this;\n\t\tthis.$element = $(element);\n\t\tthis.options = langx.mixin({}, $.fn.picker.defaults, options);\n\n\t\tthis.$accept = this.$element.find('.picker-accept');\n\t\tthis.$cancel = this.$element.find('.picker-cancel');\n\t\tthis.$trigger = this.$element.find('.picker-trigger');\n\t\tthis.$footer = this.$element.find('.picker-footer');\n\t\tthis.$header = this.$element.find('.picker-header');\n\t\tthis.$popup = this.$element.find('.picker-popup');\n\t\tthis.$body = this.$element.find('.picker-body');\n\n\t\tthis.clickStamp = '_';\n\n\t\tthis.isInput = this.$trigger.is('input');\n\n\t\tthis.$trigger.on('keydown.fu.picker', $.proxy(this.keyComplete, this));\n\t\tthis.$trigger.on('focus.fu.picker', $.proxy(function inputFocus(e){\n\t\t\tif(typeof e === \"undefined\" || $(e.target).is('input[type=text]')){\n\t\t\t\t$.proxy(this.show(), this);\n\t\t\t}\n\t\t}, this));\n\t\tthis.$trigger.on('click.fu.picker', $.proxy(function triggerClick(e){\n\t\t\tif(!$(e.target).is('input[type=text]')){\n\t\t\t\t$.proxy(this.toggle(), this);\n\t\t\t}else{\n\t\t\t\t$.proxy(this.show(), this);\n\t\t\t}\n\t\t}, this));\n\t\tthis.$accept.on('click.fu.picker', $.proxy(this.complete, this, 'accepted'));\n\t\tthis.$cancel.on('click.fu.picker', function (e) {\n\t\t\te.preventDefault(); self.complete('cancelled');\n\t\t});\n\n\n\t};\n\n\tvar _isOffscreen = function _isOffscreen(picker) {\n\t\tvar windowHeight = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);\n\t\tvar scrollTop = $(document).scrollTop();\n\t\tvar popupTop = picker.$popup.offset();\n\t\tvar popupBottom = popupTop.top + picker.$popup.outerHeight(true);\n\n\t\t//if the bottom of the popup goes off the page, but the top does not, dropup.\n\t\tif (popupBottom > windowHeight + scrollTop || popupTop.top < scrollTop){\n\t\t\treturn true;\n\t\t}else{//otherwise, prefer showing the top of the popup only vs the bottom\n\t\t\treturn false;\n\t\t}\n\t};\n\n\tvar _display = function _display(picker) {\n\t\tpicker.$popup.css('visibility', 'hidden');\n\n\t\t_showBelow(picker);\n\n\t\t//if part of the popup is offscreen try to show it above\n\t\tif(_isOffscreen(picker)){\n\t\t\t_showAbove(picker);\n\n\t\t\t//if part of the popup is still offscreen, prefer cutting off the bottom\n\t\t\tif(_isOffscreen(picker)){\n\t\t\t\t_showBelow(picker);\n\t\t\t}\n\t\t}\n\n\t\tpicker.$popup.css('visibility', 'visible');\n\t};\n\n\tvar _showAbove = function _showAbove(picker) {\n\t\tpicker.$popup.css('top', - picker.$popup.outerHeight(true) + 'px');\n\t};\n\n\tvar _showBelow = function _showBelow(picker) {\n\t\tpicker.$popup.css('top', picker.$trigger.outerHeight(true) + 'px');\n\t};\n\n\tPicker.prototype = {\n\t\tconstructor: Picker,\n\n\t\tcomplete: function complete(action) {\n\t\t\tvar EVENT_CALLBACK_MAP = {\n\t\t\t\t'accepted': 'onAccept',\n\t\t\t\t'cancelled': 'onCancel',\n\t\t\t\t'exited': 'onExit'\n\t\t\t};\n\t\t\tvar func = this.options[ EVENT_CALLBACK_MAP[action] ];\n\n\t\t\tvar obj = {\n\t\t\t\tcontents: this.$body\n\t\t\t};\n\n\t\t\tif (func) {\n\t\t\t\tfunc(obj);\n\t\t\t\tthis.$element.trigger(action + '.fu.picker', obj);\n\t\t\t} else {\n\t\t\t\tthis.$element.trigger(action + '.fu.picker', obj);\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t},\n\n\t\tkeyComplete: function keyComplete(e) {\n\t\t\tif (this.isInput && e.keyCode === 13) {\n\t\t\t\tthis.complete('accepted');\n\t\t\t\tthis.$trigger.blur();\n\t\t\t} else if (e.keyCode === 27) {\n\t\t\t\tthis.complete('exited');\n\t\t\t\tthis.$trigger.blur();\n\t\t\t}\n\t\t},\n\n\t\tdestroy: function destroy() {\n\t\t\tthis.$element.remove();\n\t\t\t// remove any external bindings\n\t\t\t$(document).off('click.fu.picker.externalClick.' + this.clickStamp);\n\t\t\t// empty elements to return to original markup\n\t\t\t// [none]\n\t\t\t// return string of markup\n\t\t\treturn this.$element[0].outerHTML;\n\t\t},\n\n\t\tdisable: function disable() {\n\t\t\tthis.$element.addClass('disabled');\n\t\t\tthis.$trigger.attr('disabled', 'disabled');\n\t\t},\n\n\t\tenable: function enable() {\n\t\t\tthis.$element.removeClass('disabled');\n\t\t\tthis.$trigger.removeAttr('disabled');\n\t\t},\n\n\t\ttoggle: function toggle() {\n\t\t\tif (this.$element.hasClass('showing')) {\n\t\t\t\tthis.hide();\n\t\t\t}else{\n\t\t\t\tthis.show();\n\t\t\t}\n\t\t},\n\n\t\thide: function hide() {\n\t\t\tif (!this.$element.hasClass('showing')) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$element.removeClass('showing');\n\t\t\t$(document).off('click.fu.picker.externalClick.' + this.clickStamp);\n\t\t\tthis.$element.trigger('hidden.fu.picker');\n\t\t},\n\n\t\texternalClickListener: function externalClickListener(e, force) {\n\t\t\tif (force === true || this.isExternalClick(e)) {\n\t\t\t\tthis.complete('exited');\n\t\t\t}\n\t\t},\n\n\t\tisExternalClick: function isExternalClick(e) {\n\t\t\tvar el = this.$element.get(0);\n\t\t\tvar exceptions = this.options.externalClickExceptions || [];\n\t\t\tvar $originEl = $(e.target);\n\t\t\tvar i, l;\n\n\t\t\tif (e.target === el || $originEl.parents('.picker:first').get(0) === el) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tfor (i = 0, l = exceptions.length; i < l; i++) {\n\t\t\t\t\tif ($originEl.is(exceptions[i]) || $originEl.parents(exceptions[i]).length > 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tshow: function show() {\n\t\t\tvar other;\n\n\t\t\tother = $(document).find('.picker.showing');\n\t\t\tif (other.length > 0) {\n\t\t\t\tif (other.data('fu.picker') && other.data('fu.picker').options.explicit) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tother.picker('externalClickListener', {}, true);\n\t\t\t}\n\n\t\t\tthis.$element.addClass('showing');\n\n\t\t\t_display(this);\n\n\t\t\tthis.$element.trigger('shown.fu.picker');\n\n\t\t\tthis.clickStamp = new Date().getTime() + (Math.floor(Math.random() * 100) + 1);\n\t\t\tif (!this.options.explicit) {\n\t\t\t\t$(document).on('click.fu.picker.externalClick.' + this.clickStamp, $.proxy(this.externalClickListener, this));\n\t\t\t}\n\t\t}\n\t};\n\n\t// PLACARD PLUGIN DEFINITION\n\n\t$.fn.picker = function picker(option) {\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tvar methodReturn;\n\n\t\tvar $set = this.each(function () {\n\t\t\tvar $this = $(this);\n\t\t\tvar data = $this.data('fu.picker');\n\t\t\tvar options = typeof option === 'object' && option;\n\n\t\t\tif (!data) {\n\t\t\t\t$this.data('fu.picker', (data = new Picker(this, options)));\n\t\t\t}\n\n\t\t\tif (typeof option === 'string') {\n\t\t\t\tmethodReturn = data[option].apply(data, args);\n\t\t\t}\n\t\t});\n\n\t\treturn (methodReturn === undefined) ? $set : methodReturn;\n\t};\n\n\t$.fn.picker.defaults = {\n\t\tonAccept: undefined,\n\t\tonCancel: undefined,\n\t\tonExit: undefined,\n\t\texternalClickExceptions: [],\n\t\texplicit: false\n\t};\n\n\t$.fn.picker.Constructor = Picker;\n\n\t$.fn.picker.noConflict = function noConflict() {\n\t\t$.fn.picker = old;\n\t\treturn this;\n\t};\n\n\t// DATA-API\n\n\t$(document).on('focus.fu.picker.data-api', '[data-initialize=picker]', function (e) {\n\t\tvar $control = $(e.target).closest('.picker');\n\t\tif (!$control.data('fu.picker')) {\n\t\t\t$control.picker($control.data());\n\t\t}\n\t});\n\n\t// Must be domReady for AMD compatibility\n\t$(function () {\n\t\t$('[data-initialize=picker]').each(function () {\n\t\t\tvar $this = $(this);\n\t\t\tif ($this.data('fu.picker')) return;\n\t\t\t$this.picker($this.data());\n\t\t});\n\t});\n\n});\n"]}