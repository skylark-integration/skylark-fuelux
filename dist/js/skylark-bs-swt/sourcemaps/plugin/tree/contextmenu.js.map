{"version":3,"sources":["plugin/tree/contextmenu.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","jstree","sbswt","plugins","contextmenu","defaults","select_node","show_at_node","items","o","cb","create","separator_before","separator_after","_disabled","label","action","data","inst","reference","obj","get_node","create_node","new_node","edit","ex","setTimeout","rename","remove","icon","is_selected","delete_node","get_selected","ccp","submenu","cut","get_top_selected","copy","paste","can_paste","options","parent","this","bind","call","ey","last_ts","cto","element","on","proxy","get_container_ul","addClass","e","target","tagName","toLowerCase","preventDefault","ctrlKey","Date","clearTimeout","is_loading","currentTarget","show_contextmenu","pageX","pageY","_data","visible","vakata","context","hide","originalEvent","changedTouches","clientX","clientY","trigger","Math","abs","document","removeClass","teardown","x","y","id","root","s","settings","d","a","children","i","undefined","offset","left","top","core","li_height","activate_node","isFunction","_show_contextmenu","isPlainObject","one","cls","get_theme","show","node","right_to_left","vakata_context","position_x","position_y","html","is_visible","hide_onmouseleave","icons","_trigger","event_name","position","_execute","item","_parse","is_callback","tmp","str","sep","each","val","push","_class","shortcut","length","title","indexOf","shortcut_label","replace","_show_submenu","xl","outerWidth","w","width","h","height","dw","window","scrollLeft","dh","scrollTop","css","hasClass","cond","outerHeight","appendTo","body","find","first","focus","end","blur","detach","to","stopImmediatePropagation","contains","relatedTarget","siblings","parentsUntil","addBack","t","attr","which","type","last","closest","prevAll","nextAll","not","click"],"mappings":"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","file":"../../../plugin/tree/contextmenu.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"../../tree\",\n  \"../../sbswt\"\n],function(langx,browser,eventer,noder,geom,velm,$,jstree,sbswt){\n\n\t\"use strict\";\n\n\tif($.jstree.plugins.contextmenu) { return; }\n\n\t/**\n\t * stores all defaults for the contextmenu plugin\n\t * @name $.jstree.defaults.contextmenu\n\t * @plugin contextmenu\n\t */\n\t$.jstree.defaults.contextmenu = {\n\t\t/**\n\t\t * a boolean indicating if the node should be selected when the context menu is invoked on it. Defaults to `true`.\n\t\t * @name $.jstree.defaults.contextmenu.select_node\n\t\t * @plugin contextmenu\n\t\t */\n\t\tselect_node : true,\n\t\t/**\n\t\t * a boolean indicating if the menu should be shown aligned with the node. Defaults to `true`, otherwise the mouse coordinates are used.\n\t\t * @name $.jstree.defaults.contextmenu.show_at_node\n\t\t * @plugin contextmenu\n\t\t */\n\t\tshow_at_node : true,\n\t\t/**\n\t\t * an object of actions, or a function that accepts a node and a callback function and calls the callback function with an object of actions available for that node (you can also return the items too).\n\t\t *\n\t\t * Each action consists of a key (a unique name) and a value which is an object with the following properties (only label and action are required). Once a menu item is activated the `action` function will be invoked with an object containing the following keys: item - the contextmenu item definition as seen below, reference - the DOM node that was used (the tree node), element - the contextmenu DOM element, position - an object with x/y properties indicating the position of the menu.\n\t\t *\n\t\t * * `separator_before` - a boolean indicating if there should be a separator before this item\n\t\t * * `separator_after` - a boolean indicating if there should be a separator after this item\n\t\t * * `_disabled` - a boolean indicating if this action should be disabled\n\t\t * * `label` - a string - the name of the action (could be a function returning a string)\n\t\t * * `title` - a string - an optional tooltip for the item\n\t\t * * `action` - a function to be executed if this item is chosen, the function will receive \n\t\t * * `icon` - a string, can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class\n\t\t * * `shortcut` - keyCode which will trigger the action if the menu is open (for example `113` for rename, which equals F2)\n\t\t * * `shortcut_label` - shortcut label (like for example `F2` for rename)\n\t\t * * `submenu` - an object with the same structure as $.jstree.defaults.contextmenu.items which can be used to create a submenu - each key will be rendered as a separate option in a submenu that will appear once the current item is hovered\n\t\t *\n\t\t * @name $.jstree.defaults.contextmenu.items\n\t\t * @plugin contextmenu\n\t\t */\n\t\titems : function (o, cb) { // Could be an object directly\n\t\t\treturn {\n\t\t\t\t\"create\" : {\n\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\"separator_after\"\t: true,\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"create_node\", data.reference, {}, \"last\")),\n\t\t\t\t\t\"label\"\t\t\t\t: \"Create\",\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\tinst.create_node(obj, {}, \"last\", function (new_node) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tinst.edit(new_node);\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\tsetTimeout(function () { inst.edit(new_node); },0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"rename\" : {\n\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"rename_node\", data.reference, this.get_parent(data.reference), \"\")),\n\t\t\t\t\t\"label\"\t\t\t\t: \"Rename\",\n\t\t\t\t\t/*!\n\t\t\t\t\t\"shortcut\"\t\t\t: 113,\n\t\t\t\t\t\"shortcut_label\"\t: 'F2',\n\t\t\t\t\t\"icon\"\t\t\t\t: \"glyphicon glyphicon-leaf\",\n\t\t\t\t\t*/\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\tinst.edit(obj);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"remove\" : {\n\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"delete_node\", data.reference, this.get_parent(data.reference), \"\")),\n\t\t\t\t\t\"label\"\t\t\t\t: \"Delete\",\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\tif(inst.is_selected(obj)) {\n\t\t\t\t\t\t\tinst.delete_node(inst.get_selected());\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tinst.delete_node(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"ccp\" : {\n\t\t\t\t\t\"separator_before\"\t: true,\n\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\"label\"\t\t\t\t: \"Edit\",\n\t\t\t\t\t\"action\"\t\t\t: false,\n\t\t\t\t\t\"submenu\" : {\n\t\t\t\t\t\t\"cut\" : {\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Cut\",\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\t\t\tif(inst.is_selected(obj)) {\n\t\t\t\t\t\t\t\t\tinst.cut(inst.get_top_selected());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tinst.cut(obj);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"copy\" : {\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Copy\",\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\t\t\tif(inst.is_selected(obj)) {\n\t\t\t\t\t\t\t\t\tinst.copy(inst.get_top_selected());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tinst.copy(obj);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"paste\" : {\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\t\t\"_disabled\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\treturn !$.jstree.reference(data.reference).can_paste();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Paste\",\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\t\t\tinst.paste(obj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\t$.jstree.plugins.contextmenu = function (options, parent) {\n\t\tthis.bind = function () {\n\t\t\tparent.bind.call(this);\n\n\t\t\tvar last_ts = 0, cto = null, ex, ey;\n\t\t\tthis.element\n\t\t\t\t.on(\"init.jstree loading.jstree ready.jstree\", $.proxy(function () {\n\t\t\t\t\t\tthis.get_container_ul().addClass('jstree-contextmenu');\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"contextmenu.jstree\", \".jstree-anchor\", $.proxy(function (e, data) {\n\t\t\t\t\t\tif (e.target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tlast_ts = e.ctrlKey ? +new Date() : 0;\n\t\t\t\t\t\tif(data || cto) {\n\t\t\t\t\t\t\tlast_ts = (+new Date()) + 10000;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cto) {\n\t\t\t\t\t\t\tclearTimeout(cto);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(!this.is_loading(e.currentTarget)) {\n\t\t\t\t\t\t\tthis.show_contextmenu(e.currentTarget, e.pageX, e.pageY, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"click.jstree\", \".jstree-anchor\", $.proxy(function (e) {\n\t\t\t\t\t\tif(this._data.contextmenu.visible && (!last_ts || (+new Date()) - last_ts > 250)) { // work around safari & macOS ctrl+click\n\t\t\t\t\t\t\t$.vakata.context.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlast_ts = 0;\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"touchstart.jstree\", \".jstree-anchor\", function (e) {\n\t\t\t\t\t\tif(!e.originalEvent || !e.originalEvent.changedTouches || !e.originalEvent.changedTouches[0]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tex = e.originalEvent.changedTouches[0].clientX;\n\t\t\t\t\t\tey = e.originalEvent.changedTouches[0].clientY;\n\t\t\t\t\t\tcto = setTimeout(function () {\n\t\t\t\t\t\t\t$(e.currentTarget).trigger('contextmenu', true);\n\t\t\t\t\t\t}, 750);\n\t\t\t\t\t})\n\t\t\t\t.on('touchmove.vakata.jstree', function (e) {\n\t\t\t\t\t\tif(cto && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0] && (Math.abs(ex - e.originalEvent.changedTouches[0].clientX) > 10 || Math.abs(ey - e.originalEvent.changedTouches[0].clientY) > 10)) {\n\t\t\t\t\t\t\tclearTimeout(cto);\n\t\t\t\t\t\t\t$.vakata.context.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t.on('touchend.vakata.jstree', function (e) {\n\t\t\t\t\t\tif(cto) {\n\t\t\t\t\t\t\tclearTimeout(cto);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t/*!\n\t\t\tif(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {\n\t\t\t\tvar el = null, tm = null;\n\t\t\t\tthis.element\n\t\t\t\t\t.on(\"touchstart\", \".jstree-anchor\", function (e) {\n\t\t\t\t\t\tel = e.currentTarget;\n\t\t\t\t\t\ttm = +new Date();\n\t\t\t\t\t\t$(document).one(\"touchend\", function (e) {\n\t\t\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);\n\t\t\t\t\t\t\te.currentTarget = e.target;\n\t\t\t\t\t\t\ttm = ((+(new Date())) - tm);\n\t\t\t\t\t\t\tif(e.target === el && tm > 600 && tm < 1000) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t$(el).trigger('contextmenu', e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tel = null;\n\t\t\t\t\t\t\ttm = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}\n\t\t\t*/\n\t\t\t$(document).on(\"context_hide.vakata.jstree\", $.proxy(function (e, data) {\n\t\t\t\tthis._data.contextmenu.visible = false;\n\t\t\t\t$(data.reference).removeClass('jstree-context');\n\t\t\t}, this));\n\t\t};\n\t\tthis.teardown = function () {\n\t\t\tif(this._data.contextmenu.visible) {\n\t\t\t\t$.vakata.context.hide();\n\t\t\t}\n\t\t\tparent.teardown.call(this);\n\t\t};\n\n\t\t/**\n\t\t * prepare and show the context menu for a node\n\t\t * @name show_contextmenu(obj [, x, y])\n\t\t * @param {mixed} obj the node\n\t\t * @param {Number} x the x-coordinate relative to the document to show the menu at\n\t\t * @param {Number} y the y-coordinate relative to the document to show the menu at\n\t\t * @param {Object} e the event if available that triggered the contextmenu\n\t\t * @plugin contextmenu\n\t\t * @trigger show_contextmenu.jstree\n\t\t */\n\t\tthis.show_contextmenu = function (obj, x, y, e) {\n\t\t\tobj = this.get_node(obj);\n\t\t\tif(!obj || obj.id === $.jstree.root) { return false; }\n\t\t\tvar s = this.settings.contextmenu,\n\t\t\t\td = this.get_node(obj, true),\n\t\t\t\ta = d.children(\".jstree-anchor\"),\n\t\t\t\to = false,\n\t\t\t\ti = false;\n\t\t\tif(s.show_at_node || x === undefined || y === undefined) {\n\t\t\t\to = a.offset();\n\t\t\t\tx = o.left;\n\t\t\t\ty = o.top + this._data.core.li_height;\n\t\t\t}\n\t\t\tif(this.settings.contextmenu.select_node && !this.is_selected(obj)) {\n\t\t\t\tthis.activate_node(obj, e);\n\t\t\t}\n\n\t\t\ti = s.items;\n\t\t\tif($.isFunction(i)) {\n\t\t\t\ti = i.call(this, obj, $.proxy(function (i) {\n\t\t\t\t\tthis._show_contextmenu(obj, x, y, i);\n\t\t\t\t}, this));\n\t\t\t}\n\t\t\tif($.isPlainObject(i)) {\n\t\t\t\tthis._show_contextmenu(obj, x, y, i);\n\t\t\t}\n\t\t};\n\t\t/**\n\t\t * show the prepared context menu for a node\n\t\t * @name _show_contextmenu(obj, x, y, i)\n\t\t * @param {mixed} obj the node\n\t\t * @param {Number} x the x-coordinate relative to the document to show the menu at\n\t\t * @param {Number} y the y-coordinate relative to the document to show the menu at\n\t\t * @param {Number} i the object of items to show\n\t\t * @plugin contextmenu\n\t\t * @trigger show_contextmenu.jstree\n\t\t * @private\n\t\t */\n\t\tthis._show_contextmenu = function (obj, x, y, i) {\n\t\t\tvar d = this.get_node(obj, true),\n\t\t\t\ta = d.children(\".jstree-anchor\");\n\t\t\t$(document).one(\"context_show.vakata.jstree\", $.proxy(function (e, data) {\n\t\t\t\tvar cls = 'jstree-contextmenu jstree-' + this.get_theme() + '-contextmenu';\n\t\t\t\t$(data.element).addClass(cls);\n\t\t\t\ta.addClass('jstree-context');\n\t\t\t}, this));\n\t\t\tthis._data.contextmenu.visible = true;\n\t\t\t$.vakata.context.show(a, { 'x' : x, 'y' : y }, i);\n\t\t\t/**\n\t\t\t * triggered when the contextmenu is shown for a node\n\t\t\t * @event\n\t\t\t * @name show_contextmenu.jstree\n\t\t\t * @param {Object} node the node\n\t\t\t * @param {Number} x the x-coordinate of the menu relative to the document\n\t\t\t * @param {Number} y the y-coordinate of the menu relative to the document\n\t\t\t * @plugin contextmenu\n\t\t\t */\n\t\t\tthis.trigger('show_contextmenu', { \"node\" : obj, \"x\" : x, \"y\" : y });\n\t\t};\n\t};\n\n\t// contextmenu helper\n\t(function ($) {\n\t\tvar right_to_left = false,\n\t\t\tvakata_context = {\n\t\t\t\telement\t\t: false,\n\t\t\t\treference\t: false,\n\t\t\t\tposition_x\t: 0,\n\t\t\t\tposition_y\t: 0,\n\t\t\t\titems\t\t: [],\n\t\t\t\thtml\t\t: \"\",\n\t\t\t\tis_visible\t: false\n\t\t\t};\n\n\t\t$.vakata.context = {\n\t\t\tsettings : {\n\t\t\t\thide_onmouseleave\t: 0,\n\t\t\t\ticons\t\t\t\t: true\n\t\t\t},\n\t\t\t_trigger : function (event_name) {\n\t\t\t\t$(document).trigger(\"context_\" + event_name + \".vakata\", {\n\t\t\t\t\t\"reference\"\t: vakata_context.reference,\n\t\t\t\t\t\"element\"\t: vakata_context.element,\n\t\t\t\t\t\"position\"\t: {\n\t\t\t\t\t\t\"x\" : vakata_context.position_x,\n\t\t\t\t\t\t\"y\" : vakata_context.position_y\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t_execute : function (i) {\n\t\t\t\ti = vakata_context.items[i];\n\t\t\t\treturn i && (!i._disabled || ($.isFunction(i._disabled) && !i._disabled({ \"item\" : i, \"reference\" : vakata_context.reference, \"element\" : vakata_context.element }))) && i.action ? i.action.call(null, {\n\t\t\t\t\t\t\t\"item\"\t\t: i,\n\t\t\t\t\t\t\t\"reference\"\t: vakata_context.reference,\n\t\t\t\t\t\t\t\"element\"\t: vakata_context.element,\n\t\t\t\t\t\t\t\"position\"\t: {\n\t\t\t\t\t\t\t\t\"x\" : vakata_context.position_x,\n\t\t\t\t\t\t\t\t\"y\" : vakata_context.position_y\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}) : false;\n\t\t\t},\n\t\t\t_parse : function (o, is_callback) {\n\t\t\t\tif(!o) { return false; }\n\t\t\t\tif(!is_callback) {\n\t\t\t\t\tvakata_context.html\t\t= \"\";\n\t\t\t\t\tvakata_context.items\t= [];\n\t\t\t\t}\n\t\t\t\tvar str = \"\",\n\t\t\t\t\tsep = false,\n\t\t\t\t\ttmp;\n\n\t\t\t\tif(is_callback) { str += \"<\"+\"ul>\"; }\n\t\t\t\t$.each(o, function (i, val) {\n\t\t\t\t\tif(!val) { return true; }\n\t\t\t\t\tvakata_context.items.push(val);\n\t\t\t\t\tif(!sep && val.separator_before) {\n\t\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + ($.vakata.context.settings.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\n\t\t\t\t\t}\n\t\t\t\t\tsep = false;\n\t\t\t\t\tstr += \"<\"+\"li class='\" + (val._class || \"\") + (val._disabled === true || ($.isFunction(val._disabled) && val._disabled({ \"item\" : val, \"reference\" : vakata_context.reference, \"element\" : vakata_context.element })) ? \" vakata-contextmenu-disabled \" : \"\") + \"' \"+(val.shortcut?\" data-shortcut='\"+val.shortcut+\"' \":'')+\">\";\n\t\t\t\t\tstr += \"<\"+\"a href='#' rel='\" + (vakata_context.items.length - 1) + \"' \" + (val.title ? \"title='\" + val.title + \"'\" : \"\") + \">\";\n\t\t\t\t\tif($.vakata.context.settings.icons) {\n\t\t\t\t\t\tstr += \"<\"+\"i \";\n\t\t\t\t\t\tif(val.icon) {\n\t\t\t\t\t\t\tif(val.icon.indexOf(\"/\") !== -1 || val.icon.indexOf(\".\") !== -1) { str += \" style='background:url(\\\"\" + val.icon + \"\\\") center center no-repeat' \"; }\n\t\t\t\t\t\t\telse { str += \" class='\" + val.icon + \"' \"; }\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstr += \"><\"+\"/i><\"+\"span class='vakata-contextmenu-sep'>&#160;<\"+\"/span>\";\n\t\t\t\t\t}\n\t\t\t\t\tstr += ($.isFunction(val.label) ? val.label({ \"item\" : i, \"reference\" : vakata_context.reference, \"element\" : vakata_context.element }) : val.label) + (val.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+val.shortcut+'\">'+ (val.shortcut_label || '') +'</span>':'') + \"<\"+\"/a>\";\n\t\t\t\t\tif(val.submenu) {\n\t\t\t\t\t\ttmp = $.vakata.context._parse(val.submenu, true);\n\t\t\t\t\t\tif(tmp) { str += tmp; }\n\t\t\t\t\t}\n\t\t\t\t\tstr += \"<\"+\"/li>\";\n\t\t\t\t\tif(val.separator_after) {\n\t\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + ($.vakata.context.settings.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\n\t\t\t\t\t\tsep = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tstr  = str.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\");\n\t\t\t\tif(is_callback) { str += \"</ul>\"; }\n\t\t\t\t/**\n\t\t\t\t * triggered on the document when the contextmenu is parsed (HTML is built)\n\t\t\t\t * @event\n\t\t\t\t * @plugin contextmenu\n\t\t\t\t * @name context_parse.vakata\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\n\t\t\t\t */\n\t\t\t\tif(!is_callback) { vakata_context.html = str; $.vakata.context._trigger(\"parse\"); }\n\t\t\t\treturn str.length > 10 ? str : false;\n\t\t\t},\n\t\t\t_show_submenu : function (o) {\n\t\t\t\to = $(o);\n\t\t\t\tif(!o.length || !o.children(\"ul\").length) { return; }\n\t\t\t\tvar e = o.children(\"ul\"),\n\t\t\t\t\txl = o.offset().left,\n\t\t\t\t\tx = xl + o.outerWidth(),\n\t\t\t\t\ty = o.offset().top,\n\t\t\t\t\tw = e.width(),\n\t\t\t\t\th = e.height(),\n\t\t\t\t\tdw = $(window).width() + $(window).scrollLeft(),\n\t\t\t\t\tdh = $(window).height() + $(window).scrollTop();\n\t\t\t\t// може да се спести е една проверка - дали няма някой от класовете вече нагоре\n\t\t\t\tif(right_to_left) {\n\t\t\t\t\to[x - (w + 10 + o.outerWidth()) < 0 ? \"addClass\" : \"removeClass\"](\"vakata-context-left\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\to[x + w > dw  && xl > dw - x ? \"addClass\" : \"removeClass\"](\"vakata-context-right\");\n\t\t\t\t}\n\t\t\t\tif(y + h + 10 > dh) {\n\t\t\t\t\te.css(\"bottom\",\"-1px\");\n\t\t\t\t}\n\n\t\t\t\t//if does not fit - stick it to the side\n\t\t\t\tif (o.hasClass('vakata-context-right')) {\n\t\t\t\t\tif (xl < w) {\n\t\t\t\t\t\te.css(\"margin-right\", xl - w);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (dw - x < w) {\n\t\t\t\t\t\te.css(\"margin-left\", dw - x - w);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\te.show();\n\t\t\t},\n\t\t\tshow : function (reference, position, data) {\n\t\t\t\tvar o, e, x, y, w, h, dw, dh, cond = true;\n\t\t\t\tif(vakata_context.element && vakata_context.element.length) {\n\t\t\t\t\tvakata_context.element.width('');\n\t\t\t\t}\n\t\t\t\tswitch(cond) {\n\t\t\t\t\tcase (!position && !reference):\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tcase (!!position && !!reference):\n\t\t\t\t\t\tvakata_context.reference\t= reference;\n\t\t\t\t\t\tvakata_context.position_x\t= position.x;\n\t\t\t\t\t\tvakata_context.position_y\t= position.y;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase (!position && !!reference):\n\t\t\t\t\t\tvakata_context.reference\t= reference;\n\t\t\t\t\t\to = reference.offset();\n\t\t\t\t\t\tvakata_context.position_x\t= o.left + reference.outerHeight();\n\t\t\t\t\t\tvakata_context.position_y\t= o.top;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase (!!position && !reference):\n\t\t\t\t\t\tvakata_context.position_x\t= position.x;\n\t\t\t\t\t\tvakata_context.position_y\t= position.y;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif(!!reference && !data && $(reference).data('vakata_contextmenu')) {\n\t\t\t\t\tdata = $(reference).data('vakata_contextmenu');\n\t\t\t\t}\n\t\t\t\tif($.vakata.context._parse(data)) {\n\t\t\t\t\tvakata_context.element.html(vakata_context.html);\n\t\t\t\t}\n\t\t\t\tif(vakata_context.items.length) {\n\t\t\t\t\tvakata_context.element.appendTo(document.body);\n\t\t\t\t\te = vakata_context.element;\n\t\t\t\t\tx = vakata_context.position_x;\n\t\t\t\t\ty = vakata_context.position_y;\n\t\t\t\t\tw = e.width();\n\t\t\t\t\th = e.height();\n\t\t\t\t\tdw = $(window).width() + $(window).scrollLeft();\n\t\t\t\t\tdh = $(window).height() + $(window).scrollTop();\n\t\t\t\t\tif(right_to_left) {\n\t\t\t\t\t\tx -= (e.outerWidth() - $(reference).outerWidth());\n\t\t\t\t\t\tif(x < $(window).scrollLeft() + 20) {\n\t\t\t\t\t\t\tx = $(window).scrollLeft() + 20;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(x + w + 20 > dw) {\n\t\t\t\t\t\tx = dw - (w + 20);\n\t\t\t\t\t}\n\t\t\t\t\tif(y + h + 20 > dh) {\n\t\t\t\t\t\ty = dh - (h + 20);\n\t\t\t\t\t}\n\n\t\t\t\t\tvakata_context.element\n\t\t\t\t\t\t.css({ \"left\" : x, \"top\" : y })\n\t\t\t\t\t\t.show()\n\t\t\t\t\t\t.find('a').first().focus().parent().addClass(\"vakata-context-hover\");\n\t\t\t\t\tvakata_context.is_visible = true;\n\t\t\t\t\t/**\n\t\t\t\t\t * triggered on the document when the contextmenu is shown\n\t\t\t\t\t * @event\n\t\t\t\t\t * @plugin contextmenu\n\t\t\t\t\t * @name context_show.vakata\n\t\t\t\t\t * @param {jQuery} reference the element that was right clicked\n\t\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\n\t\t\t\t\t * @param {Object} position the x & y coordinates of the menu\n\t\t\t\t\t */\n\t\t\t\t\t$.vakata.context._trigger(\"show\");\n\t\t\t\t}\n\t\t\t},\n\t\t\thide : function () {\n\t\t\t\tif(vakata_context.is_visible) {\n\t\t\t\t\tvakata_context.element.hide().find(\"ul\").hide().end().find(':focus').blur().end().detach();\n\t\t\t\t\tvakata_context.is_visible = false;\n\t\t\t\t\t/**\n\t\t\t\t\t * triggered on the document when the contextmenu is hidden\n\t\t\t\t\t * @event\n\t\t\t\t\t * @plugin contextmenu\n\t\t\t\t\t * @name context_hide.vakata\n\t\t\t\t\t * @param {jQuery} reference the element that was right clicked\n\t\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\n\t\t\t\t\t * @param {Object} position the x & y coordinates of the menu\n\t\t\t\t\t */\n\t\t\t\t\t$.vakata.context._trigger(\"hide\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t$(function () {\n\t\t\tright_to_left = $(document.body).css(\"direction\") === \"rtl\";\n\t\t\tvar to = false;\n\n\t\t\tvakata_context.element = $(\"<ul class='vakata-context'></ul>\");\n\t\t\tvakata_context.element\n\t\t\t\t.on(\"mouseenter\", \"li\", function (e) {\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) {\n\t\t\t\t\t\t// премахнато заради delegate mouseleave по-долу\n\t\t\t\t\t\t// $(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(to) { clearTimeout(to); }\n\t\t\t\t\tvakata_context.element.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end();\n\n\t\t\t\t\t$(this)\n\t\t\t\t\t\t.siblings().find(\"ul\").hide().end().end()\n\t\t\t\t\t\t.parentsUntil(\".vakata-context\", \"li\").addBack().addClass(\"vakata-context-hover\");\n\t\t\t\t\t$.vakata.context._show_submenu(this);\n\t\t\t\t})\n\t\t\t\t// тестово - дали не натоварва?\n\t\t\t\t.on(\"mouseleave\", \"li\", function (e) {\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) { return; }\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\");\n\t\t\t\t})\n\t\t\t\t.on(\"mouseleave\", function (e) {\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\n\t\t\t\t\tif($.vakata.context.settings.hide_onmouseleave) {\n\t\t\t\t\t\tto = setTimeout(\n\t\t\t\t\t\t\t(function (t) {\n\t\t\t\t\t\t\t\treturn function () { $.vakata.context.hide(); };\n\t\t\t\t\t\t\t}(this)), $.vakata.context.settings.hide_onmouseleave);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \"a\", function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t//})\n\t\t\t\t//.on(\"mouseup\", \"a\", function (e) {\n\t\t\t\t\tif(!$(this).blur().parent().hasClass(\"vakata-context-disabled\") && $.vakata.context._execute($(this).attr(\"rel\")) !== false) {\n\t\t\t\t\t\t$.vakata.context.hide();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on('keydown', 'a', function (e) {\n\t\t\t\t\t\tvar o = null;\n\t\t\t\t\t\tswitch(e.which) {\n\t\t\t\t\t\t\tcase 13:\n\t\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\t\te.type = \"click\";\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t$(e.currentTarget).trigger(e);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 37:\n\t\t\t\t\t\t\t\tif(vakata_context.is_visible) {\n\t\t\t\t\t\t\t\t\tvakata_context.element.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children('a').focus();\n\t\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 38:\n\t\t\t\t\t\t\t\tif(vakata_context.is_visible) {\n\t\t\t\t\t\t\t\t\to = vakata_context.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first();\n\t\t\t\t\t\t\t\t\tif(!o.length) { o = vakata_context.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last(); }\n\t\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\n\t\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 39:\n\t\t\t\t\t\t\t\tif(vakata_context.is_visible) {\n\t\t\t\t\t\t\t\t\tvakata_context.element.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children('a').focus();\n\t\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 40:\n\t\t\t\t\t\t\t\tif(vakata_context.is_visible) {\n\t\t\t\t\t\t\t\t\to = vakata_context.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first();\n\t\t\t\t\t\t\t\t\tif(!o.length) { o = vakata_context.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first(); }\n\t\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\n\t\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 27:\n\t\t\t\t\t\t\t\t$.vakata.context.hide();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t//console.log(e.which);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t.on('keydown', function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tvar a = vakata_context.element.find('.vakata-contextmenu-shortcut-' + e.which).parent();\n\t\t\t\t\tif(a.parent().not('.vakata-context-disabled')) {\n\t\t\t\t\t\ta.click();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t$(document)\n\t\t\t\t.on(\"mousedown.vakata.jstree\", function (e) {\n\t\t\t\t\tif(vakata_context.is_visible && vakata_context.element[0] !== e.target  && !noder.contains(vakata_context.element[0], e.target)) {\n\t\t\t\t\t\t$.vakata.context.hide();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"context_show.vakata.jstree\", function (e, data) {\n\t\t\t\t\tvakata_context.element.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\");\n\t\t\t\t\tif(right_to_left) {\n\t\t\t\t\t\tvakata_context.element.addClass(\"vakata-context-rtl\").css(\"direction\", \"rtl\");\n\t\t\t\t\t}\n\t\t\t\t\t// also apply a RTL class?\n\t\t\t\t\tvakata_context.element.find(\"ul\").hide().end();\n\t\t\t\t});\n\t\t});\n\t}($));\n\t// $.jstree.defaults.plugins.push(\"contextmenu\");\n\n\treturn $;\n\t\n});\n"]}