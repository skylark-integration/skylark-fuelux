{"version":3,"sources":["menu.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","sbswt","right_to_left","vakata_context","element","reference","position_x","position_y","items","html","is_visible","menu","settings","hide_onmouseleave","icons","_trigger","event_name","document","trigger","position","x","y","_execute","i","_disabled","isFunction","item","action","call","_parse","o","is_callback","tmp","str","sep","each","val","push","separator_before","_class","shortcut","length","title","icon","indexOf","label","shortcut_label","submenu","separator_after","replace","_show_submenu","children","e","xl","offset","left","outerWidth","top","w","width","h","height","dw","window","scrollLeft","dh","scrollTop","css","hasClass","show","data","cond","outerHeight","appendTo","body","find","first","focus","parent","addClass","this","hide","end","blur","detach","to","on","stopImmediatePropagation","contains","relatedTarget","clearTimeout","removeClass","siblings","parentsUntil","addBack","setTimeout","t","preventDefault","attr","which","type","currentTarget","last","closest","prevAll","nextAll","a","not","click","target"],"mappings":"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","file":"../menu.js","sourcesContent":["define([\r\n  \"skylark-utils/langx\",\r\n  \"skylark-utils/browser\",\r\n  \"skylark-utils/eventer\",\r\n  \"skylark-utils/noder\",\r\n  \"skylark-utils/geom\",\r\n  \"skylark-utils/velm\",\r\n  \"skylark-utils/query\",\r\n  \"./sbswt\"\r\n],function(langx,browser,eventer,noder,geom,velm,$,sbswt){\r\n\r\n\tvar right_to_left = false,\r\n\t\tvakata_context = {\r\n\t\t\telement\t\t: false,\r\n\t\t\treference\t: false,\r\n\t\t\tposition_x\t: 0,\r\n\t\t\tposition_y\t: 0,\r\n\t\t\titems\t\t: [],\r\n\t\t\thtml\t\t: \"\",\r\n\t\t\tis_visible\t: false\r\n\t\t};\r\n\r\n\tvar menu = {\r\n\t\tsettings : {\r\n\t\t\thide_onmouseleave\t: 0,\r\n\t\t\ticons\t\t\t\t: true\r\n\t\t},\r\n\t\t_trigger : function (event_name) {\r\n\t\t\t$(document).trigger(\"context_\" + event_name + \".vakata\", {\r\n\t\t\t\t\"reference\"\t: vakata_context.reference,\r\n\t\t\t\t\"element\"\t: vakata_context.element,\r\n\t\t\t\t\"position\"\t: {\r\n\t\t\t\t\t\"x\" : vakata_context.position_x,\r\n\t\t\t\t\t\"y\" : vakata_context.position_y\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t_execute : function (i) {\r\n\t\t\ti = vakata_context.items[i];\r\n\t\t\treturn i && (!i._disabled || ($.isFunction(i._disabled) && !i._disabled({ \"item\" : i, \"reference\" : vakata_context.reference, \"element\" : vakata_context.element }))) && i.action ? i.action.call(null, {\r\n\t\t\t\t\t\t\"item\"\t\t: i,\r\n\t\t\t\t\t\t\"reference\"\t: vakata_context.reference,\r\n\t\t\t\t\t\t\"element\"\t: vakata_context.element,\r\n\t\t\t\t\t\t\"position\"\t: {\r\n\t\t\t\t\t\t\t\"x\" : vakata_context.position_x,\r\n\t\t\t\t\t\t\t\"y\" : vakata_context.position_y\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}) : false;\r\n\t\t},\r\n\t\t_parse : function (o, is_callback) {\r\n\t\t\tif(!o) { return false; }\r\n\t\t\tif(!is_callback) {\r\n\t\t\t\tvakata_context.html\t\t= \"\";\r\n\t\t\t\tvakata_context.items\t= [];\r\n\t\t\t}\r\n\t\t\tvar str = \"\",\r\n\t\t\t\tsep = false,\r\n\t\t\t\ttmp;\r\n\r\n\t\t\tif(is_callback) { str += \"<\"+\"ul>\"; }\r\n\t\t\t$.each(o, function (i, val) {\r\n\t\t\t\tif(!val) { return true; }\r\n\t\t\t\tvakata_context.items.push(val);\r\n\t\t\t\tif(!sep && val.separator_before) {\r\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (menu.settings.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\r\n\t\t\t\t}\r\n\t\t\t\tsep = false;\r\n\t\t\t\tstr += \"<\"+\"li class='\" + (val._class || \"\") + (val._disabled === true || ($.isFunction(val._disabled) && val._disabled({ \"item\" : val, \"reference\" : vakata_context.reference, \"element\" : vakata_context.element })) ? \" vakata-contextmenu-disabled \" : \"\") + \"' \"+(val.shortcut?\" data-shortcut='\"+val.shortcut+\"' \":'')+\">\";\r\n\t\t\t\tstr += \"<\"+\"a href='#' rel='\" + (vakata_context.items.length - 1) + \"' \" + (val.title ? \"title='\" + val.title + \"'\" : \"\") + \">\";\r\n\t\t\t\tif(menu.settings.icons) {\r\n\t\t\t\t\tstr += \"<\"+\"i \";\r\n\t\t\t\t\tif(val.icon) {\r\n\t\t\t\t\t\tif(val.icon.indexOf(\"/\") !== -1 || val.icon.indexOf(\".\") !== -1) { str += \" style='background:url(\\\"\" + val.icon + \"\\\") center center no-repeat' \"; }\r\n\t\t\t\t\t\telse { str += \" class='\" + val.icon + \"' \"; }\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstr += \"><\"+\"/i><\"+\"span class='vakata-contextmenu-sep'>&#160;<\"+\"/span>\";\r\n\t\t\t\t}\r\n\t\t\t\tstr += ($.isFunction(val.label) ? val.label({ \"item\" : i, \"reference\" : vakata_context.reference, \"element\" : vakata_context.element }) : val.label) + (val.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+val.shortcut+'\">'+ (val.shortcut_label || '') +'</span>':'') + \"<\"+\"/a>\";\r\n\t\t\t\tif(val.submenu) {\r\n\t\t\t\t\ttmp = menu._parse(val.submenu, true);\r\n\t\t\t\t\tif(tmp) { str += tmp; }\r\n\t\t\t\t}\r\n\t\t\t\tstr += \"<\"+\"/li>\";\r\n\t\t\t\tif(val.separator_after) {\r\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (menu.settings.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\r\n\t\t\t\t\tsep = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tstr  = str.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\");\r\n\t\t\tif(is_callback) { str += \"</ul>\"; }\r\n\t\t\t/**\r\n\t\t\t * triggered on the document when the contextmenu is parsed (HTML is built)\r\n\t\t\t * @event\r\n\t\t\t * @plugin contextmenu\r\n\t\t\t * @name context_parse.vakata\r\n\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t */\r\n\t\t\tif(!is_callback) { vakata_context.html = str; menu._trigger(\"parse\"); }\r\n\t\t\treturn str.length > 10 ? str : false;\r\n\t\t},\r\n\t\t_show_submenu : function (o) {\r\n\t\t\to = $(o);\r\n\t\t\tif(!o.length || !o.children(\"ul\").length) { return; }\r\n\t\t\tvar e = o.children(\"ul\"),\r\n\t\t\t\txl = o.offset().left,\r\n\t\t\t\tx = xl + o.outerWidth(),\r\n\t\t\t\ty = o.offset().top,\r\n\t\t\t\tw = e.width(),\r\n\t\t\t\th = e.height(),\r\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft(),\r\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\r\n\t\t\t// може да се спести е една проверка - дали няма някой от класовете вече нагоре\r\n\t\t\tif(right_to_left) {\r\n\t\t\t\to[x - (w + 10 + o.outerWidth()) < 0 ? \"addClass\" : \"removeClass\"](\"vakata-context-left\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\to[x + w > dw  && xl > dw - x ? \"addClass\" : \"removeClass\"](\"vakata-context-right\");\r\n\t\t\t}\r\n\t\t\tif(y + h + 10 > dh) {\r\n\t\t\t\te.css(\"bottom\",\"-1px\");\r\n\t\t\t}\r\n\r\n\t\t\t//if does not fit - stick it to the side\r\n\t\t\tif (o.hasClass('vakata-context-right')) {\r\n\t\t\t\tif (xl < w) {\r\n\t\t\t\t\te.css(\"margin-right\", xl - w);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (dw - x < w) {\r\n\t\t\t\t\te.css(\"margin-left\", dw - x - w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.show();\r\n\t\t},\r\n\t\tshow : function (reference, position, data) {\r\n\t\t\tvar o, e, x, y, w, h, dw, dh, cond = true;\r\n\t\t\tif(vakata_context.element && vakata_context.element.length) {\r\n\t\t\t\tvakata_context.element.width('');\r\n\t\t\t}\r\n\t\t\tswitch(cond) {\r\n\t\t\t\tcase (!position && !reference):\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tcase (!!position && !!reference):\r\n\t\t\t\t\tvakata_context.reference\t= reference;\r\n\t\t\t\t\tvakata_context.position_x\t= position.x;\r\n\t\t\t\t\tvakata_context.position_y\t= position.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase (!position && !!reference):\r\n\t\t\t\t\tvakata_context.reference\t= reference;\r\n\t\t\t\t\to = reference.offset();\r\n\t\t\t\t\tvakata_context.position_x\t= o.left + reference.outerHeight();\r\n\t\t\t\t\tvakata_context.position_y\t= o.top;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase (!!position && !reference):\r\n\t\t\t\t\tvakata_context.position_x\t= position.x;\r\n\t\t\t\t\tvakata_context.position_y\t= position.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!!reference && !data && $(reference).data('vakata_contextmenu')) {\r\n\t\t\t\tdata = $(reference).data('vakata_contextmenu');\r\n\t\t\t}\r\n\t\t\tif(menu._parse(data)) {\r\n\t\t\t\tvakata_context.element.html(vakata_context.html);\r\n\t\t\t}\r\n\t\t\tif(vakata_context.items.length) {\r\n\t\t\t\tvakata_context.element.appendTo(document.body);\r\n\t\t\t\te = vakata_context.element;\r\n\t\t\t\tx = vakata_context.position_x;\r\n\t\t\t\ty = vakata_context.position_y;\r\n\t\t\t\tw = e.width();\r\n\t\t\t\th = e.height();\r\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft();\r\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\r\n\t\t\t\tif(right_to_left) {\r\n\t\t\t\t\tx -= (e.outerWidth() - $(reference).outerWidth());\r\n\t\t\t\t\tif(x < $(window).scrollLeft() + 20) {\r\n\t\t\t\t\t\tx = $(window).scrollLeft() + 20;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(x + w + 20 > dw) {\r\n\t\t\t\t\tx = dw - (w + 20);\r\n\t\t\t\t}\r\n\t\t\t\tif(y + h + 20 > dh) {\r\n\t\t\t\t\ty = dh - (h + 20);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvakata_context.element\r\n\t\t\t\t\t.css({ \"left\" : x, \"top\" : y })\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.find('a').first().focus().parent().addClass(\"vakata-context-hover\");\r\n\t\t\t\tvakata_context.is_visible = true;\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when the contextmenu is shown\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin contextmenu\r\n\t\t\t\t * @name context_show.vakata\r\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t\t */\r\n\t\t\t\tthis._trigger(\"show\");\r\n\t\t\t}\r\n\t\t},\r\n\t\thide : function () {\r\n\t\t\tif(vakata_context.is_visible) {\r\n\t\t\t\tvakata_context.element.hide().find(\"ul\").hide().end().find(':focus').blur().end().detach();\r\n\t\t\t\tvakata_context.is_visible = false;\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when the contextmenu is hidden\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin contextmenu\r\n\t\t\t\t * @name context_hide.vakata\r\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t\t */\r\n\t\t\t\tthis._trigger(\"hide\");\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t$(function () {\r\n\t\tright_to_left = $(document.body).css(\"direction\") === \"rtl\";\r\n\t\tvar to = false;\r\n\r\n\t\tvakata_context.element = $(\"<ul class='vakata-context'></ul>\");\r\n\t\tvakata_context.element\r\n\t\t\t.on(\"mouseenter\", \"li\", function (e) {\r\n\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\tif(noder.contains(this, e.relatedTarget)) {\r\n\t\t\t\t\t// премахнато заради delegate mouseleave по-долу\r\n\t\t\t\t\t// $(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(to) { clearTimeout(to); }\r\n\t\t\t\tvakata_context.element.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end();\r\n\r\n\t\t\t\t$(this)\r\n\t\t\t\t\t.siblings().find(\"ul\").hide().end().end()\r\n\t\t\t\t\t.parentsUntil(\".vakata-context\", \"li\").addBack().addClass(\"vakata-context-hover\");\r\n\t\t\t\tmenu._show_submenu(this);\r\n\t\t\t})\r\n\t\t\t// тестово - дали не натоварва?\r\n\t\t\t.on(\"mouseleave\", \"li\", function (e) {\r\n\t\t\t\tif(noder.contains(this, e.relatedTarget)) { return; }\r\n\t\t\t\t$(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\");\r\n\t\t\t})\r\n\t\t\t.on(\"mouseleave\", function (e) {\r\n\t\t\t\t$(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\r\n\t\t\t\tif(menu.settings.hide_onmouseleave) {\r\n\t\t\t\t\tto = setTimeout(\r\n\t\t\t\t\t\t(function (t) {\r\n\t\t\t\t\t\t\treturn function () { menu.hide(); };\r\n\t\t\t\t\t\t}(this)), menu.settings.hide_onmouseleave);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on(\"click\", \"a\", function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t//})\r\n\t\t\t//.on(\"mouseup\", \"a\", function (e) {\r\n\t\t\t\tif(!$(this).blur().parent().hasClass(\"vakata-context-disabled\") && menu._execute($(this).attr(\"rel\")) !== false) {\r\n\t\t\t\t\tmenu.hide();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on('keydown', 'a', function (e) {\r\n\t\t\t\t\tvar o = null;\r\n\t\t\t\t\tswitch(e.which) {\r\n\t\t\t\t\t\tcase 13:\r\n\t\t\t\t\t\tcase 32:\r\n\t\t\t\t\t\t\te.type = \"click\";\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t$(e.currentTarget).trigger(e);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 37:\r\n\t\t\t\t\t\t\tif(vakata_context.is_visible) {\r\n\t\t\t\t\t\t\t\tvakata_context.element.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 38:\r\n\t\t\t\t\t\t\tif(vakata_context.is_visible) {\r\n\t\t\t\t\t\t\t\to = vakata_context.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first();\r\n\t\t\t\t\t\t\t\tif(!o.length) { o = vakata_context.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last(); }\r\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 39:\r\n\t\t\t\t\t\t\tif(vakata_context.is_visible) {\r\n\t\t\t\t\t\t\t\tvakata_context.element.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 40:\r\n\t\t\t\t\t\t\tif(vakata_context.is_visible) {\r\n\t\t\t\t\t\t\t\to = vakata_context.element.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first();\r\n\t\t\t\t\t\t\t\tif(!o.length) { o = vakata_context.element.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first(); }\r\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 27:\r\n\t\t\t\t\t\t\tmenu.hide();\r\n\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t//console.log(e.which);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t.on('keydown', function (e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tvar a = vakata_context.element.find('.vakata-contextmenu-shortcut-' + e.which).parent();\r\n\t\t\t\tif(a.parent().not('.vakata-context-disabled')) {\r\n\t\t\t\t\ta.click();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t$(document)\r\n\t\t\t.on(\"mousedown.vakata.jstree\", function (e) {\r\n\t\t\t\tif(vakata_context.is_visible && vakata_context.element[0] !== e.target  && !noder.contains(vakata_context.element[0], e.target)) {\r\n\t\t\t\t\tmenu.hide();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on(\"context_show.vakata.jstree\", function (e, data) {\r\n\t\t\t\tvakata_context.element.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\");\r\n\t\t\t\tif(right_to_left) {\r\n\t\t\t\t\tvakata_context.element.addClass(\"vakata-context-rtl\").css(\"direction\", \"rtl\");\r\n\t\t\t\t}\r\n\t\t\t\t// also apply a RTL class?\r\n\t\t\t\tvakata_context.element.find(\"ul\").hide().end();\r\n\t\t\t});\r\n\t});\r\n\r\n\treturn menu;\r\n\r\n});\r\n"]}