{"version":3,"sources":["modal.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","sbswt","Plugin","option","_relatedTarget","this","each","$this","data","options","mixin","Modal","DEFAULTS","show","WidgetBase","inherit","klassName","init","element","$body","document","body","$element","$dialog","find","$backdrop","isShown","originalBodyPad","scrollbarWidth","ignoreBackdropClick","remote","load","proxy","trigger","toggle","hide","that","e","create","relatedTarget","isDefaultPrevented","checkScrollbar","setScrollbar","addClass","escape","resize","on","one","target","is","backdrop","transition","support","hasClass","parent","length","appendTo","scrollTop","adjustDialog","offsetWidth","enforceFocus","emulateTransitionEnd","TRANSITION_DURATION","preventDefault","off","removeClass","hideModal","has","keyboard","which","window","handleUpdate","resetAdjustments","resetScrollbar","removeBackdrop","remove","callback","animate","doAnimate","createElement","disableElClickHide","currentTarget","focus","BACKDROP_TRANSITION_DURATION","callbackRemove","modalIsOverflowing","scrollHeight","documentElement","clientHeight","css","paddingLeft","bodyIsOverflowing","paddingRight","fullWindowWidth","innerWidth","documentElementRect","getBoundingClientRect","right","Math","abs","left","clientWidth","measureScrollbar","bodyPad","parseInt","style","scrollDiv","className","append","removeChild","VERSION","old","fn","modal","Constructor","noConflict"],"mappings":"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","file":"../modal.js","sourcesContent":["define([\n    \"skylark-utils/langx\",\n    \"skylark-utils/browser\",\n    \"skylark-utils/eventer\",\n    \"skylark-utils/noder\",\n    \"skylark-utils/geom\",\n    \"skylark-utils/velm\",\n    \"skylark-utils/query\",\n    \"./sbswt\"\n], function(langx, browser, eventer, noder, geom, velm, $, sbswt) {\n\n    /* ========================================================================\n     * Bootstrap: modal.js v3.3.7\n     * http://getbootstrap.com/javascript/#modals\n     * ========================================================================\n     * Copyright 2011-2016 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n\n    'use strict';\n\n    // MODAL CLASS DEFINITION\n    // ======================\n\n    var Modal = sbswt.Modal = sbswt.WidgetBase.inherit({\n        klassName: \"Modal\",\n\n        init: function(element, options) {\n            this.options = options\n            this.$body = $(document.body)\n            this.$element = $(element)\n            this.$dialog = this.$element.find('.modal-dialog')\n            this.$backdrop = null\n            this.isShown = null\n            this.originalBodyPad = null\n            this.scrollbarWidth = 0\n            this.ignoreBackdropClick = false\n\n            if (this.options.remote) {\n                this.$element\n                    .find('.modal-content')\n                    .load(this.options.remote, langx.proxy(function() {\n                        this.$element.trigger('loaded.bs.modal')\n                    }, this))\n            }\n        },\n\n        toggle: function(_relatedTarget) {\n            return this.isShown ? this.hide() : this.show(_relatedTarget)\n        },\n\n        show: function(_relatedTarget) {\n            var that = this\n            var e = eventer.create('show.bs.modal', { relatedTarget: _relatedTarget })\n\n            this.$element.trigger(e)\n\n            if (this.isShown || e.isDefaultPrevented()) return\n\n            this.isShown = true\n\n            this.checkScrollbar()\n            this.setScrollbar()\n            this.$body.addClass('modal-open')\n\n            this.escape()\n            this.resize()\n\n            this.$element.on('click.dismiss.bs.modal', '[data-dismiss=\"modal\"]', langx.proxy(this.hide, this))\n\n            this.$dialog.on('mousedown.dismiss.bs.modal', function() {\n                that.$element.one('mouseup.dismiss.bs.modal', function(e) {\n                    if ($(e.target).is(that.$element)) that.ignoreBackdropClick = true\n                })\n            })\n\n            this.backdrop(function() {\n                var transition = browser.support.transition && that.$element.hasClass('fade')\n\n                if (!that.$element.parent().length) {\n                    that.$element.appendTo(that.$body) // don't move modals dom position\n                }\n\n                that.$element\n                    .show()\n                    .scrollTop(0)\n\n                that.adjustDialog()\n\n                if (transition) {\n                    that.$element[0].offsetWidth // force reflow\n                }\n\n                that.$element.addClass('in')\n\n                that.enforceFocus()\n\n                var e = eventer.create('shown.bs.modal', { relatedTarget: _relatedTarget })\n\n                transition ?\n                    that.$dialog // wait for modal to slide in\n                    .one('bsTransitionEnd', function() {\n                        that.$element.trigger('focus').trigger(e)\n                    })\n                    .emulateTransitionEnd(Modal.TRANSITION_DURATION) :\n                    that.$element.trigger('focus').trigger(e)\n            })\n        },\n\n        hide: function(e) {\n            if (e) e.preventDefault()\n\n            e = eventer.create('hide.bs.modal')\n\n            this.$element.trigger(e)\n\n            if (!this.isShown || e.isDefaultPrevented()) return\n\n            this.isShown = false\n\n            this.escape()\n            this.resize()\n\n            $(document).off('focusin.bs.modal')\n\n            this.$element\n                .removeClass('in')\n                .off('click.dismiss.bs.modal')\n                .off('mouseup.dismiss.bs.modal')\n\n            this.$dialog.off('mousedown.dismiss.bs.modal')\n\n            browser.support.transition && this.$element.hasClass('fade') ?\n                this.$element\n                .one('bsTransitionEnd', langx.proxy(this.hideModal, this))\n                .emulateTransitionEnd(Modal.TRANSITION_DURATION) :\n                this.hideModal()\n        },\n\n        enforceFocus: function() {\n            $(document)\n                .off('focusin.bs.modal') // guard against infinite focus loop\n                .on('focusin.bs.modal', langx.proxy(function(e) {\n                    if (document !== e.target &&\n                        this.$element[0] !== e.target &&\n                        !this.$element.has(e.target).length) {\n                        this.$element.trigger('focus')\n                    }\n                }, this))\n        },\n\n        escape: function() {\n            if (this.isShown && this.options.keyboard) {\n                this.$element.on('keydown.dismiss.bs.modal', langx.proxy(function(e) {\n                    e.which == 27 && this.hide()\n                }, this))\n            } else if (!this.isShown) {\n                this.$element.off('keydown.dismiss.bs.modal')\n            }\n        },\n\n        resize: function() {\n            if (this.isShown) {\n                $(window).on('resize.bs.modal', langx.proxy(this.handleUpdate, this))\n            } else {\n                $(window).off('resize.bs.modal')\n            }\n        },\n\n        hideModal: function() {\n            var that = this\n            this.$element.hide()\n            this.backdrop(function() {\n                that.$body.removeClass('modal-open')\n                that.resetAdjustments()\n                that.resetScrollbar()\n                that.$element.trigger('hidden.bs.modal')\n            })\n        },\n\n        removeBackdrop: function() {\n            this.$backdrop && this.$backdrop.remove()\n            this.$backdrop = null\n        },\n\n        backdrop: function(callback) {\n            var that = this\n            var animate = this.$element.hasClass('fade') ? 'fade' : ''\n\n            if (this.isShown && this.options.backdrop) {\n                var doAnimate = browser.support.transition && animate\n\n                this.$backdrop = $(document.createElement('div'))\n                    .addClass('modal-backdrop ' + animate)\n                    .appendTo(this.$body)\n\n                if (!this.options.disableElClickHide) this.$element.on('click.dismiss.bs.modal', langx.proxy(function(e) {\n                    if (this.ignoreBackdropClick) {\n                        this.ignoreBackdropClick = false\n                        return\n                    }\n                    if (e.target !== e.currentTarget) return\n                    this.options.backdrop == 'static' ?\n                        this.$element[0].focus() :\n                        this.hide()\n                }, this))\n\n                if (doAnimate) this.$backdrop[0].offsetWidth // force reflow\n\n                this.$backdrop.addClass('in')\n\n                if (!callback) return\n\n                doAnimate ?\n                    this.$backdrop\n                    .one('bsTransitionEnd', callback)\n                    .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\n                    callback()\n\n            } else if (!this.isShown && this.$backdrop) {\n                this.$backdrop.removeClass('in')\n\n                var callbackRemove = function() {\n                    that.removeBackdrop()\n                    callback && callback()\n                }\n                browser.support.transition && this.$element.hasClass('fade') ?\n                    this.$backdrop\n                    .one('bsTransitionEnd', callbackRemove)\n                    .emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION) :\n                    callbackRemove()\n\n            } else if (callback) {\n                callback()\n            }\n        },\n\n        // these following methods are used to handle overflowing modals\n\n        handleUpdate: function() {\n            this.adjustDialog()\n        },\n\n        adjustDialog: function() {\n            var modalIsOverflowing = this.$element[0].scrollHeight > document.documentElement.clientHeight\n\n            this.$element.css({\n                paddingLeft: !this.bodyIsOverflowing && modalIsOverflowing ? this.scrollbarWidth : '',\n                paddingRight: this.bodyIsOverflowing && !modalIsOverflowing ? this.scrollbarWidth : ''\n            })\n        },\n\n        resetAdjustments: function() {\n            this.$element.css({\n                paddingLeft: '',\n                paddingRight: ''\n            })\n        },\n\n        checkScrollbar: function() {\n            var fullWindowWidth = window.innerWidth\n            if (!fullWindowWidth) { // workaround for missing window.innerWidth in IE8\n                var documentElementRect = document.documentElement.getBoundingClientRect()\n                fullWindowWidth = documentElementRect.right - Math.abs(documentElementRect.left)\n            }\n            this.bodyIsOverflowing = document.body.clientWidth < fullWindowWidth\n            this.scrollbarWidth = this.measureScrollbar()\n        },\n\n        setScrollbar: function() {\n            var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)\n            this.originalBodyPad = document.body.style.paddingRight || ''\n            if (this.bodyIsOverflowing) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)\n        },\n\n        resetScrollbar: function() {\n            this.$body.css('padding-right', this.originalBodyPad)\n        },\n\n        measureScrollbar: function() { // thx walsh\n            var scrollDiv = document.createElement('div')\n            scrollDiv.className = 'modal-scrollbar-measure'\n            this.$body.append(scrollDiv)\n            var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth\n            this.$body[0].removeChild(scrollDiv)\n            return scrollbarWidth\n        }\n\n    });\n\n\n    Modal.VERSION = '3.3.7'\n\n    Modal.TRANSITION_DURATION = 300\n    Modal.BACKDROP_TRANSITION_DURATION = 150\n\n    Modal.DEFAULTS = {\n        backdrop: true,\n        keyboard: true,\n        show: true\n    }\n\n\n\n    // MODAL PLUGIN DEFINITION\n    // =======================\n\n    function Plugin(option, _relatedTarget) {\n        return this.each(function() {\n            var $this = $(this)\n            var data = $this.data('bs.modal')\n            var options = langx.mixin({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)\n\n            if (!data) $this.data('bs.modal', (data = new Modal(this, options)))\n            if (typeof option == 'string') data[option](_relatedTarget)\n            else if (options.show) data.show(_relatedTarget)\n        })\n    }\n\n    var old = $.fn.modal\n\n    $.fn.modal = Plugin;\n    $.fn.modal.Constructor = Modal;\n\n\n    // MODAL NO CONFLICT\n    // =================\n\n    $.fn.modal.noConflict = function() {\n        $.fn.modal = old\n        return this\n    }\n\n\n    // MODAL DATA-API\n    // ==============\n    /*\n    $(document).on('click.bs.modal.data-api', '[data-toggle=\"modal\"]', function (e) {\n      var $this   = $(this)\n      var href    = $this.attr('href')\n      var $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\\s]+$)/, ''))) // strip for ie7\n      var option  = $target.data('bs.modal') ? 'toggle' : langx.mixin({ remote: !/#/.test(href) && href }, $target.data(), $this.data())\n\n      if ($this.is('a')) e.preventDefault()\n\n      $target.one('show.bs.modal', function (showEvent) {\n        if (showEvent.isDefaultPrevented()) return // only register focus restorer if modal will actually get shown\n        $target.one('hidden.bs.modal', function () {\n          $this.is(':visible') && $this.trigger('focus')\n        })\n      })\n      Plugin.call($target, option, this)\n    })\n    */\n\n    return $.fn.modal;\n});"]}