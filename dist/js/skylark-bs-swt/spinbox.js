/**
 * skylark-bs-swt - The skylark bootstrap standard widget tookit
 * @author Hudaokeji, Inc.
 * @version v0.9.0-beta
 * @link https://github.com/skylarkui/skylark-bs-swt/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/query"],function(t,i,s,n,e,o){var p=o.fn.spinbox,a=function(i,s){this.$element=o(i),this.$element.find(".btn").on("click",function(t){t.preventDefault()}),this.options=t.mixin({},o.fn.spinbox.defaults,s),this.options.step=this.$element.data("step")||this.options.step,this.options.value<this.options.min?this.options.value=this.options.min:this.options.max<this.options.value&&(this.options.value=this.options.max),this.$input=this.$element.find(".spinbox-input"),this.$input.on("focusout.fu.spinbox",this.$input,o.proxy(this.change,this)),this.$element.on("keydown.fu.spinbox",this.$input,o.proxy(this.keydown,this)),this.$element.on("keyup.fu.spinbox",this.$input,o.proxy(this.keyup,this)),this.options.hold?(this.$element.on("mousedown.fu.spinbox",".spinbox-up",o.proxy(function(){this.startSpin(!0)},this)),this.$element.on("mouseup.fu.spinbox",".spinbox-up, .spinbox-down",o.proxy(this.stopSpin,this)),this.$element.on("mouseout.fu.spinbox",".spinbox-up, .spinbox-down",o.proxy(this.stopSpin,this)),this.$element.on("mousedown.fu.spinbox",".spinbox-down",o.proxy(function(){this.startSpin(!1)},this))):(this.$element.on("click.fu.spinbox",".spinbox-up",o.proxy(function(){this.step(!0)},this)),this.$element.on("click.fu.spinbox",".spinbox-down",o.proxy(function(){this.step(!1)},this))),this.switches={count:1,enabled:!0},"medium"===this.options.speed?this.switches.speed=300:"fast"===this.options.speed?this.switches.speed=100:this.switches.speed=500,this.options.defaultUnit=u(this.options.defaultUnit,this.options.units)?this.options.defaultUnit:"",this.unit=this.options.defaultUnit,this.lastValue=this.options.value,this.render(),this.options.disabled&&this.disable()},h=function(t,i){return Math.round(t/i)*i},u=function(t,i){var s=!1,n=t.toLowerCase();return o.each(i,function(t,i){if(i=i.toLowerCase(),n===i)return s=!0,!1}),s},l=function(t){return isNaN(parseFloat(t))?t:(t>this.options.max?t=this.options.cycle?this.options.min:this.options.max:t<this.options.min&&(t=this.options.cycle?this.options.max:this.options.min),this.options.limitToStep&&this.options.step&&(t=h(t,this.options.step),t>this.options.max?t-=this.options.step:t<this.options.min&&(t+=this.options.step)),t)};a.prototype={constructor:a,destroy:function(){return this.$element.remove(),this.$element.find("input").each(function(){o(this).attr("value",o(this).val())}),this.$element[0].outerHTML},render:function(){this._setValue(this.getDisplayValue())},change:function(){this._setValue(this.getDisplayValue()),this.triggerChangedEvent()},stopSpin:function(){void 0!==this.switches.timeout&&(clearTimeout(this.switches.timeout),this.switches.count=1,this.triggerChangedEvent())},triggerChangedEvent:function(){var t=this.getValue();t!==this.lastValue&&(this.lastValue=t,this.$element.trigger("changed.fu.spinbox",t))},startSpin:function(t){if(!this.options.disabled){var i=this.switches.count;1===i?(this.step(t),i=1):i=i<3?1.5:i<8?2.5:4,this.switches.timeout=setTimeout(o.proxy(function(){this.iterate(t)},this),this.switches.speed/i),this.switches.count++}},iterate:function(t){this.step(t),this.startSpin(t)},step:function(t){this._setValue(this.getDisplayValue());var i;i=t?this.options.value+this.options.step:this.options.value-this.options.step,i=i.toFixed(5),this._setValue(i+this.unit)},getDisplayValue:function(){var t=this.parseInput(this.$input.val()),i=t?t:this.options.value;return i},setDisplayValue:function(t){this.$input.val(t)},getValue:function(){var t=this.options.value;return"."!==this.options.decimalMark&&(t=(t+"").split(".").join(this.options.decimalMark)),t+this.unit},setValue:function(t){return this._setValue(t,!0)},_setValue:function(t,i){if("."!==this.options.decimalMark&&(t=this.parseInput(t)),"number"!=typeof t){var s=t.replace(/[0-9.-]/g,"");this.unit=u(s,this.options.units)?s:this.options.defaultUnit}var n=this.getIntValue(t);return isNaN(n)&&!isFinite(n)?this._setValue(this.options.value,i):(n=l.call(this,n),this.options.value=n,t=n+this.unit,"."!==this.options.decimalMark&&(t=(t+"").split(".").join(this.options.decimalMark)),this.setDisplayValue(t),i&&(this.lastValue=t),this)},value:function(t){return t||0===t?this.setValue(t):this.getValue()},parseInput:function(t){return t=(t+"").split(this.options.decimalMark).join(".")},getIntValue:function(t){if(t="undefined"==typeof t?this.getValue():t,"undefined"!=typeof t)return"string"==typeof t&&(t=this.parseInput(t)),t=parseFloat(t,10)},disable:function(){this.options.disabled=!0,this.$element.addClass("disabled"),this.$input.attr("disabled",""),this.$element.find("button").addClass("disabled")},enable:function(){this.options.disabled=!1,this.$element.removeClass("disabled"),this.$input.removeAttr("disabled"),this.$element.find("button").removeClass("disabled")},keydown:function(t){var i=t.keyCode;38===i?this.step(!0):40===i?this.step(!1):13===i&&this.change()},keyup:function(t){var i=t.keyCode;38!==i&&40!==i||this.triggerChangedEvent()}},o.fn.spinbox=function(t){var i,s=Array.prototype.slice.call(arguments,1),n=this.each(function(){var n=o(this),e=n.data("fu.spinbox"),p="object"==typeof t&&t;e||n.data("fu.spinbox",e=new a(this,p)),"string"==typeof t&&(i=e[t].apply(e,s))});return void 0===i?n:i},o.fn.spinbox.defaults={value:0,min:0,max:999,step:1,hold:!0,speed:"medium",disabled:!1,cycle:!1,units:[],decimalMark:".",defaultUnit:"",limitToStep:!1},o.fn.spinbox.Constructor=a,o.fn.spinbox.noConflict=function(){return o.fn.spinbox=p,this},o(document).on("mousedown.fu.spinbox.data-api","[data-initialize=spinbox]",function(t){var i=o(t.target).closest(".spinbox");i.data("fu.spinbox")||i.spinbox(i.data())}),o(function(){o("[data-initialize=spinbox]").each(function(){var t=o(this);t.data("fu.spinbox")||t.spinbox(t.data())})})});
//# sourceMappingURL=sourcemaps/spinbox.js.map
