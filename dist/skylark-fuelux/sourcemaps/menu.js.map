{"version":3,"sources":["menu.js"],"names":["define","langx","browser","eventer","noder","geom","$","fuelux","right_to_left","popup","Menu","WidgetBase","inherit","klassName","init","elm","options","$el","self","this","_options","mixin","hide_onmouseleave","icons","to","on","e","stopImmediatePropagation","contains","relatedTarget","clearTimeout","find","removeClass","end","siblings","hide","parentsUntil","addBack","addClass","_show_submenu","setTimeout","t","preventDefault","blur","parent","hasClass","_execute","attr","o","which","type","currentTarget","trigger","last","closest","first","children","focus","prevAll","length","show","nextAll","a","not","click","render","items","_parse","html","width","_trigger","event_name","document","reference","element","position","x","position_x","y","position_y","i","_disabled","isFunction","item","action","call","is_callback","tmp","str","sep","each","val","push","separator_before","_class","shortcut","title","icon","indexOf","label","shortcut_label","submenu","separator_after","replace","xl","offset","left","outerWidth","top","w","h","height","dw","window","scrollLeft","dh","scrollTop","css","data","cond","outerHeight","appendTo","body","is_visible","detach","target","m"],"mappings":"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","file":"../menu.js","sourcesContent":["define([\n  \"skylark-langx/langx\",\n  \"skylark-utils-dom/browser\",\n  \"skylark-utils-dom/eventer\",\n  \"skylark-utils-dom/noder\",\n  \"skylark-utils-dom/geom\",\n  \"skylark-utils-dom/query\",\n  \"./fuelux\"\n],function(langx,browser,eventer,noder,geom,$,fuelux){\n\n\tvar popup = null;\n\tvar right_to_left ;\n\n\tvar Menu = fuelux.Menu = fuelux.WidgetBase.inherit({\n        klassName: \"Menu\",\n\n        init : function(elm,options) {\n        \tif (!options) {\n        \t\toptions = elm;\n        \t\telm = null;\n        \t}\n\t\t\tvar self = this,$el;\n\n\t\t\tthis._options = langx.mixin({\n\t\t\t\t\thide_onmouseleave\t: 0,\n\t\t\t\t\ticons\t\t\t\t: true\n\n\t\t\t},options);\n\n\t\t\tif (!elm) {\n\t\t\t\t$el = this.$el = $(\"<ul class='vakata-context'></ul>\");\n\t\t\t} else {\n\t\t\t\t$el = this.$el = $(elm);\n\t\t\t}\n\n\t\t\tvar to = false;\n\t\t\t$el.on(\"mouseenter\", \"li\", function (e) {\n\t\t\t\t\te.stopImmediatePropagation();\n\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) {\n\t\t\t\t\t\t// премахнато заради delegate mouseleave по-долу\n\t\t\t\t\t\t// $(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif(to) { clearTimeout(to); }\n\t\t\t\t\t$el.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end();\n\n\t\t\t\t\t$(this)\n\t\t\t\t\t\t.siblings().find(\"ul\").hide().end().end()\n\t\t\t\t\t\t.parentsUntil(\".vakata-context\", \"li\").addBack().addClass(\"vakata-context-hover\");\n\t\t\t\t\tself._show_submenu(this);\n\t\t\t\t})\n\t\t\t\t// тестово - дали не натоварва?\n\t\t\t\t.on(\"mouseleave\", \"li\", function (e) {\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) { return; }\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\");\n\t\t\t\t})\n\t\t\t\t.on(\"mouseleave\", function (e) {\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\n\t\t\t\t\tif(self._options.hide_onmouseleave) {\n\t\t\t\t\t\tto = setTimeout(\n\t\t\t\t\t\t\t(function (t) {\n\t\t\t\t\t\t\t\treturn function () { self.hide(); };\n\t\t\t\t\t\t\t}(this)), self._options.hide_onmouseleave);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on(\"click\", \"a\", function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t//})\n\t\t\t\t//.on(\"mouseup\", \"a\", function (e) {\n\t\t\t\t\tif(!$(this).blur().parent().hasClass(\"vakata-context-disabled\") && self._execute($(this).attr(\"rel\")) !== false) {\n\t\t\t\t\t\tself.hide();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.on('keydown', 'a', function (e) {\n\t\t\t\t\t\tvar o = null;\n\t\t\t\t\t\tswitch(e.which) {\n\t\t\t\t\t\t\tcase 13:\n\t\t\t\t\t\t\tcase 32:\n\t\t\t\t\t\t\t\te.type = \"click\";\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t$(e.currentTarget).trigger(e);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 37:\n\t\t\t\t\t\t\t\tself.$el.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children('a').focus();\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 38:\n\t\t\t\t\t\t\t\to = self.$el.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first();\n\t\t\t\t\t\t\t\tif(!o.length) { o = self.$el.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last(); }\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 39:\n\t\t\t\t\t\t\t\tself.$el.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children('a').focus();\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 40:\n\t\t\t\t\t\t\t\to = self.$el.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first();\n\t\t\t\t\t\t\t\tif(!o.length) { o = self.$el.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first(); }\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 27:\n\t\t\t\t\t\t\t\tself.hide();\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t//console.log(e.which);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t.on('keydown', function (e) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tvar a = self.$el.find('.vakata-contextmenu-shortcut-' + e.which).parent();\n\t\t\t\t\tif(a.parent().not('.vakata-context-disabled')) {\n\t\t\t\t\t\ta.click();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tthis.render();\n        },\n\n        render : function() {\n        \tvar items = this._options.items;\n\t\t\tif(this._parse(items)) {\n\t\t\t\tthis.$el.html(this.html);\n\t\t\t}\n\t\t\tthis.$el.width('');\n        },\n\n\t\t_trigger : function (event_name) {\n\t\t\t$(document).trigger(\"context_\" + event_name + \".fuelux\", {\n\t\t\t\t\"reference\"\t: this.reference,\n\t\t\t\t\"element\"\t: this.$el,\n\t\t\t\t\"position\"\t: {\n\t\t\t\t\t\"x\" : this.position_x,\n\t\t\t\t\t\"y\" : this.position_y\n\t\t\t\t}\n\t\t\t});\n\t\t},        \n\n\t\t_execute : function (i) {\n\t\t\ti = this.items[i];\n\t\t\treturn i && (!i._disabled || (langx.isFunction(i._disabled) && !i._disabled({ \"item\" : i, \"reference\" : this.reference, \"element\" : this.$el }))) && i.action ? i.action.call(null, {\n\t\t\t\t\t\t\"item\"\t\t: i,\n\t\t\t\t\t\t\"reference\"\t: this.reference,\n\t\t\t\t\t\t\"element\"\t: this.$el,\n\t\t\t\t\t\t\"position\"\t: {\n\t\t\t\t\t\t\t\"x\" : this.position_x,\n\t\t\t\t\t\t\t\"y\" : this.position_y\n\t\t\t\t\t\t}\n\t\t\t\t\t}) : false;\n\t\t},\n\t\t_parse : function (o, is_callback) {\n\t\t\tvar self = this,\n\t\t\t\treference = self._options.reference;\n\n\t\t\tif(!o) { return false; }\n\t\t\tif(!is_callback) {\n\t\t\t\tself.html\t\t= \"\";\n\t\t\t\tself.items\t= [];\n\t\t\t}\n\t\t\tvar str = \"\",\n\t\t\t\tsep = false,\n\t\t\t\ttmp;\n\n\t\t\tif(is_callback) { str += \"<\"+\"ul>\"; }\n\t\t\tlangx.each(o, function (i, val) {\n\t\t\t\tif(!val) { return true; }\n\t\t\t\tself.items.push(val);\n\t\t\t\tif(!sep && val.separator_before) {\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (self._options.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\n\t\t\t\t}\n\t\t\t\tsep = false;\n\t\t\t\tstr += \"<\"+\"li class='\" + (val._class || \"\") + (val._disabled === true || (langx.isFunction(val._disabled) && val._disabled({ \"item\" : val, \"reference\" : reference, \"element\" : self.$el })) ? \" vakata-contextmenu-disabled \" : \"\") + \"' \"+(val.shortcut?\" data-shortcut='\"+val.shortcut+\"' \":'')+\">\";\n\t\t\t\tstr += \"<\"+\"a href='#' rel='\" + (self.items.length - 1) + \"' \" + (val.title ? \"title='\" + val.title + \"'\" : \"\") + \">\";\n\t\t\t\tif(self._options.icons) {\n\t\t\t\t\tstr += \"<\"+\"i \";\n\t\t\t\t\tif(val.icon) {\n\t\t\t\t\t\tif(val.icon.indexOf(\"/\") !== -1 || val.icon.indexOf(\".\") !== -1) { str += \" style='background:url(\\\"\" + val.icon + \"\\\") center center no-repeat' \"; }\n\t\t\t\t\t\telse { str += \" class='\" + val.icon + \"' \"; }\n\t\t\t\t\t}\n\t\t\t\t\tstr += \"><\"+\"/i><\"+\"span class='vakata-contextmenu-sep'>&#160;<\"+\"/span>\";\n\t\t\t\t}\n\t\t\t\tstr += (langx.isFunction(val.label) ? val.label({ \"item\" : i, \"reference\" : reference, \"element\" : self.$el }) : val.label) + (val.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+val.shortcut+'\">'+ (val.shortcut_label || '') +'</span>':'') + \"<\"+\"/a>\";\n\t\t\t\tif(val.submenu) {\n\t\t\t\t\ttmp = self._parse(val.submenu, true);\n\t\t\t\t\tif(tmp) { str += tmp; }\n\t\t\t\t}\n\t\t\t\tstr += \"<\"+\"/li>\";\n\t\t\t\tif(val.separator_after) {\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (self._options.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\n\t\t\t\t\tsep = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tstr  = str.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\");\n\t\t\tif(is_callback) { str += \"</ul>\"; }\n\t\t\t/**\n\t\t\t * triggered on the document when the contextmenu is parsed (HTML is built)\n\t\t\t * @event\n\t\t\t * @plugin contextmenu\n\t\t\t * @name context_parse.vakata\n\t\t\t * @param {jQuery} reference the element that was right clicked\n\t\t\t * @param {jQuery} element the DOM element of the menu itself\n\t\t\t * @param {Object} position the x & y coordinates of the menu\n\t\t\t */\n\t\t\tif(!is_callback) { self.html = str; self._trigger(\"parse\"); }\n\t\t\treturn str.length > 10 ? str : false;\n\t\t},\n\t\t_show_submenu : function (o) {\n\t\t\to = $(o);\n\t\t\tif(!o.length || !o.children(\"ul\").length) { return; }\n\t\t\tvar e = o.children(\"ul\"),\n\t\t\t\txl = o.offset().left,\n\t\t\t\tx = xl + o.outerWidth(),\n\t\t\t\ty = o.offset().top,\n\t\t\t\tw = e.width(),\n\t\t\t\th = e.height(),\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft(),\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\n\t\t\t// може да се спести е една проверка - дали няма някой от класовете вече нагоре\n\t\t\tif(right_to_left) {\n\t\t\t\to[x - (w + 10 + o.outerWidth()) < 0 ? \"addClass\" : \"removeClass\"](\"vakata-context-left\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\to[x + w > dw  && xl > dw - x ? \"addClass\" : \"removeClass\"](\"vakata-context-right\");\n\t\t\t}\n\t\t\tif(y + h + 10 > dh) {\n\t\t\t\te.css(\"bottom\",\"-1px\");\n\t\t\t}\n\n\t\t\t//if does not fit - stick it to the side\n\t\t\tif (o.hasClass('vakata-context-right')) {\n\t\t\t\tif (xl < w) {\n\t\t\t\t\te.css(\"margin-right\", xl - w);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (dw - x < w) {\n\t\t\t\t\te.css(\"margin-left\", dw - x - w);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\te.show();\n\t\t},\n\t\tshow : function (reference, position, data) {\n\t\t\tvar o, e, x, y, w, h, dw, dh, cond = true;\n\t\t\tswitch(cond) {\n\t\t\t\tcase (!position && !reference):\n\t\t\t\t\treturn false;\n\t\t\t\tcase (!!position && !!reference):\n\t\t\t\t\tthis.reference\t= reference;\n\t\t\t\t\tthis.position_x\t= position.x;\n\t\t\t\t\tthis.position_y\t= position.y;\n\t\t\t\t\tbreak;\n\t\t\t\tcase (!position && !!reference):\n\t\t\t\t\tthis.reference\t= reference;\n\t\t\t\t\to = reference.offset();\n\t\t\t\t\tthis.position_x\t= o.left + reference.outerHeight();\n\t\t\t\t\tthis.position_y\t= o.top;\n\t\t\t\t\tbreak;\n\t\t\t\tcase (!!position && !reference):\n\t\t\t\t\tthis.position_x\t= position.x;\n\t\t\t\t\tthis.position_y\t= position.y;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(!!reference && !data && $(reference).data('vakata_contextmenu')) {\n\t\t\t\tdata = $(reference).data('vakata_contextmenu');\n\t\t\t}\n\n\t\t\tif(this.items.length) {\n\t\t\t\tthis.$el.appendTo(document.body);\n\t\t\t\te = this.$el;\n\t\t\t\tx = this.position_x;\n\t\t\t\ty = this.position_y;\n\t\t\t\tw = e.width();\n\t\t\t\th = e.height();\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft();\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\n\t\t\t\tif(right_to_left) {\n\t\t\t\t\tx -= (e.outerWidth() - $(reference).outerWidth());\n\t\t\t\t\tif(x < $(window).scrollLeft() + 20) {\n\t\t\t\t\t\tx = $(window).scrollLeft() + 20;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(x + w + 20 > dw) {\n\t\t\t\t\tx = dw - (w + 20);\n\t\t\t\t}\n\t\t\t\tif(y + h + 20 > dh) {\n\t\t\t\t\ty = dh - (h + 20);\n\t\t\t\t}\n\n\t\t\t\tthis.$el\n\t\t\t\t\t.css({ \"left\" : x, \"top\" : y })\n\t\t\t\t\t.show()\n\t\t\t\t\t.find('a').first().focus().parent().addClass(\"vakata-context-hover\");\n\t\t\t\tthis.is_visible = true;\n\n\t\t\t\tpopup = this;\n\n\t\t\t\t/**\n\t\t\t\t * triggered on the document when the contextmenu is shown\n\t\t\t\t * @event\n\t\t\t\t * @plugin contextmenu\n\t\t\t\t * @name context_show.vakata\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\n\t\t\t\t */\n\t\t\t\tthis._trigger(\"show\");\n\t\t\t}\n\t\t},\n\t\thide : function () {\n\t\t\tif(this.is_visible) {\n\t\t\t\tthis.$el.hide().find(\"ul\").hide().end().find(':focus').blur().end().detach();\n\t\t\t\tthis.is_visible = false;\n\t\t\t\tpopup = null;\n\t\t\t\t/**\n\t\t\t\t * triggered on the document when the contextmenu is hidden\n\t\t\t\t * @event\n\t\t\t\t * @plugin contextmenu\n\t\t\t\t * @name context_hide.vakata\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\n\t\t\t\t */\n\t\t\t\tthis._trigger(\"hide\");\n\t\t\t}\n\t\t}\n\n    });\t\n\n\t$(function () {\n\t\tright_to_left = $(document.body).css(\"direction\") === \"rtl\";\n\n\t\t$(document)\n\t\t\t.on(\"mousedown.fuelux.popup\", function (e) {\n\t\t\t\tif(popup && popup.$el[0] !== e.target  && !noder.contains(popup.$el[0], e.target)) {\n\t\t\t\t\tpopup.hide();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.on(\"context_show.fuelux.popup\", function (e, data) {\n\t\t\t\tpopup.$el.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\");\n\t\t\t\tif(right_to_left) {\n\t\t\t\t\tpopup.$el.addClass(\"vakata-context-rtl\").css(\"direction\", \"rtl\");\n\t\t\t\t}\n\t\t\t\t// also apply a RTL class?\n\t\t\t\tpopup.$el.find(\"ul\").hide().end();\n\t\t\t});\n\t});\n\n\tMenu.popup = function (reference, position, data) {\n\t\tvar m = new Menu({\n\t\t\treference : reference,\n\t\t\titems : data\n\t\t});\n\t\tm.show(reference,position);\n\t};\n\n\tMenu.hide = function() {\n\t\tif (popup) {\n\t\t\tpopup.hide();\n\t\t}\n\t}\n\n\treturn Menu;\n\n});\n"]}