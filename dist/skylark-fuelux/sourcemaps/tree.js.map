{"version":3,"sources":["tree.js"],"names":["define","langx","browser","eventer","noder","geom","$","fuelux","old","fn","tree","Tree","WidgetBase","inherit","klassName","init","element","options","this","$element","mixin","defaults","attr","itemSelect","on","proxy","ev","selectItem","currentTarget","toggleFolder","populate","folderSelect","addClass","off","parent","selectFolder","$tree","focusIn","e","navigateTree","render","deselectAll","n","nodes","$selectedElements","find","each","index","ariaDeselect","styleNodeDeselected","destroy","remove","outerHTML","$el","ibp","self","isOverflow","hasClass","$parent","atRoot","treeData","data","overflow","isBackgroundProcess","replaceWith","$loader","removeClass","dataSource","items","i","treeNode","nodeType","type","$entity","clone","removeData","removeAttr","html","text","name","attrs","dataAttributes","setTo","append","trigger","selectTreeNode","clickedElement","clicked","selected","$elements","dataForEvent","closest","$icon","elementData","ariaSelect","multiSelect","push","eventType","styleNodeSelected","multiSelectSyncNodes","singleSelectSyncNodes","setFocus","target","item","discloseFolder","folder","$branch","$treeFolderContent","$treeFolderContentFirstChild","eq","disclosedCompleted","children","length","one","closeFolder","el","cacheItems","empty","selectedItems","$sel","value","collapse","reportedClosed","closedReported","event","closed","discloseVisible","$openableFolders","reportedOpened","openReported","opened","discloseAll","isExceededLimit","disclosuresUpperLimit","disclosures","refreshFolder","$treeFolder","$treeFolderChildren","prototype","closeAll","openFolder","getValue","$focusCandidate","fixFocusability","focus","isDefaultPrevented","isPropagationStopped","targetNode","originalEvent","$targetNode","isOpen","handled","fireDoneImmediately","done","which","foldersSelectable","isFolder","isItem","$prev","prevAll","not","click","$next","nextAll","parents","$prevChildren","preventDefault","stopPropagation","option","methodReturn","args","Array","slice","call","arguments","$set","$this","apply","undefined","staticData","openedParentData","callback","findChildData","targetParent","rootData","isEmptyObject","potentialMatch","id","foundChild","Constructor","noConflict"],"mappings":"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","file":"../tree.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx/browser\",\r\n  \"skylark-domx/eventer\",\r\n  \"skylark-domx/noder\",\r\n  \"skylark-domx/geom\",\r\n  \"skylark-domx/query\",\r\n  \"./fuelux\"\r\n],function(langx,browser,eventer,noder,geom,$,fuelux){\r\n\r\n\r\n\t/*\r\n\t * Fuel UX Checkbox\r\n\t * https://github.com/ExactTarget/fuelux\r\n\t *\r\n\t * Copyright (c) 2014 ExactTarget\r\n\t * Licensed under the BSD New license.\r\n\t */\r\n\r\n\tvar old = $.fn.tree;\r\n\r\n\t// TREE CONSTRUCTOR AND PROTOTYPE\r\n\r\n\tvar Tree = fuelux.Tree = fuelux.WidgetBase.inherit({\r\n\t\tklassName: \"Tree\",\r\n\r\n\t\tinit : function(element,options) {\r\n\t\t\tthis.$element = $(element);\r\n\t\t\tthis.options = langx.mixin({}, $.fn.tree.defaults, options);\r\n\r\n\t\t\tthis.$element.attr('tabindex', '0');\r\n\r\n\t\t\tif (this.options.itemSelect) {\r\n\t\t\t\tthis.$element.on('click.fu.tree', '.tree-item', langx.proxy(function callSelect (ev) {\r\n\t\t\t\t\tthis.selectItem(ev.currentTarget);\r\n\t\t\t\t}, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.$element.on('click.fu.tree', '.tree-branch-name', langx.proxy(function callToggle (ev) {\r\n\t\t\t\tthis.toggleFolder(ev.currentTarget);\r\n\t\t\t}, this));\r\n\r\n\t\t\tthis.$element.on('click.fu.tree', '.tree-overflow', langx.proxy(function callPopulate (ev) {\r\n\t\t\t\tthis.populate($(ev.currentTarget));\r\n\t\t\t}, this));\r\n\r\n\t\t\t// folderSelect default is true\r\n\t\t\tif (this.options.folderSelect) {\r\n\t\t\t\tthis.$element.addClass('tree-folder-select');\r\n\t\t\t\tthis.$element.off('click.fu.tree', '.tree-branch-name');\r\n\t\t\t\tthis.$element.on('click.fu.tree', '.icon-caret', langx.proxy(function callToggle (ev) {\r\n\t\t\t\t\tthis.toggleFolder($(ev.currentTarget).parent());\r\n\t\t\t\t}, this));\r\n\t\t\t\tthis.$element.on('click.fu.tree', '.tree-branch-name', langx.proxy(function callSelect (ev) {\r\n\t\t\t\t\tthis.selectFolder($(ev.currentTarget));\r\n\t\t\t\t}, this));\r\n\t\t\t}\r\n\r\n\t\t\tthis.$element.on('focus', function setFocusOnTab () {\r\n\t\t\t\tvar $tree = $(this);\r\n\t\t\t\tfocusIn($tree, $tree);\r\n\t\t\t});\r\n\r\n\t\t\tthis.$element.on('keydown', function processKeypress (e) {\r\n\t\t\t\treturn navigateTree($(this), e);\r\n\t\t\t});\r\n\r\n\t\t\tthis.render();\r\n\t\t},\r\n\t\tdeselectAll: function deselectAll(n) {\r\n\t\t\t// clear all child tree nodes and style as deselected\r\n\t\t\tvar nodes = n || this.$element;\r\n\t\t\tvar $selectedElements = $(nodes).find('.tree-selected');\r\n\t\t\t$selectedElements.each(function callStyleNodeDeselected (index, element) {\r\n\t\t\t\tvar $element = $(element);\r\n\t\t\t\tariaDeselect($element);\r\n\t\t\t\tstyleNodeDeselected( $element, $element.find( '.glyphicon' ) );\r\n\t\t\t});\r\n\t\t\treturn $selectedElements;\r\n\t\t},\r\n\r\n\t\tdestroy: function destroy() {\r\n\t\t\t// any external bindings [none]\r\n\t\t\t// empty elements to return to original markup\r\n\t\t\tthis.$element.find('li:not([data-template])').remove();\r\n\r\n\t\t\tthis.$element.remove();\r\n\t\t\t// returns string of markup\r\n\t\t\treturn this.$element[0].outerHTML;\r\n\t\t},\r\n\r\n\t\trender: function render() {\r\n\t\t\tthis.populate(this.$element);\r\n\t\t},\r\n\r\n\t\tpopulate: function populate($el, ibp) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// populate was initiated based on clicking overflow link\r\n\t\t\tvar isOverflow = $el.hasClass('tree-overflow');\r\n\r\n\t\t\tvar $parent = ($el.hasClass('tree')) ? $el : $el.parent();\r\n\t\t\tvar atRoot = $parent.hasClass('tree');\r\n\r\n\t\t\tif (isOverflow && !atRoot) {\r\n\t\t\t\t$parent = $parent.parent();\r\n\t\t\t}\r\n\r\n\t\t\tvar treeData = $parent.data();\r\n\t\t\t// expose overflow data to datasource so it can be responded to appropriately.\r\n\t\t\tif (isOverflow) {\r\n\t\t\t\ttreeData.overflow = $el.data();\r\n\t\t\t}\r\n\r\n\t\t\tvar isBackgroundProcess = ibp || false;\t// no user affordance needed (ex.- \"loading\")\r\n\r\n\t\t\tif (isOverflow) {\r\n\t\t\t\tif (atRoot) {\r\n\t\t\t\t\t// the loader at the root level needs to continually replace the overflow trigger\r\n\t\t\t\t\t// otherwise, when loader is shown below, it will be the loader for the last folder\r\n\t\t\t\t\t// in the tree, instead of the loader at the root level.\r\n\t\t\t\t\t$el.replaceWith($parent.find('> .tree-loader').remove());\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$el.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar $loader = $parent.find('.tree-loader:last');\r\n\r\n\t\t\tif (isBackgroundProcess === false) {\r\n\t\t\t\t$loader.removeClass('hide hidden'); // jQuery deprecated hide in 3.0. Use hidden instead. Leaving hide here to support previous markup\r\n\t\t\t}\r\n\r\n\t\t\tthis.options.dataSource(treeData ? treeData : {}, function populateNodes (items) {\r\n\t\t\t\tlangx.each(items.data, function buildNode (i, treeNode) {\r\n\t\t\t\t\tvar nodeType = treeNode.type;\r\n\r\n\t\t\t\t\t// 'item' and 'overflow' remain consistent, but 'folder' maps to 'branch'\r\n\t\t\t\t\tif (treeNode.type === 'folder') {\r\n\t\t\t\t\t\tnodeType = 'branch';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar $entity = self.$element\r\n\t\t\t\t\t\t.find('[data-template=tree' + nodeType + ']:eq(0)')\r\n\t\t\t\t\t\t.clone()\r\n\t\t\t\t\t\t.removeClass('hide hidden')// jQuery deprecated hide in 3.0. Use hidden instead. Leaving hide here to support previous markup\r\n\t\t\t\t\t\t.removeData('template')\r\n\t\t\t\t\t\t.removeAttr('data-template');\r\n\t\t\t\t\t$entity.find('.tree-' + nodeType + '-name > .tree-label').html(treeNode.text || treeNode.name);\r\n\t\t\t\t\t$entity.data(treeNode);\r\n\r\n\r\n\t\t\t\t\t// Decorate $entity with data or other attributes making the\r\n\t\t\t\t\t// element easily accessible with libraries like jQuery.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// Values are contained within the object returned\r\n\t\t\t\t\t// for folders and items as attr:\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// {\r\n\t\t\t\t\t//     text: \"An Item\",\r\n\t\t\t\t\t//     type: 'item',\r\n\t\t\t\t\t//     attr = {\r\n\t\t\t\t\t//         'classes': 'required-item red-text',\r\n\t\t\t\t\t//         'data-parent': parentId,\r\n\t\t\t\t\t//         'guid': guid,\r\n\t\t\t\t\t//         'id': guid\r\n\t\t\t\t\t//     }\r\n\t\t\t\t\t// };\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// the \"name\" attribute is also supported but is deprecated for \"text\".\r\n\r\n\t\t\t\t\t// add attributes to tree-branch or tree-item\r\n\t\t\t\t\tvar attrs = treeNode.attr || treeNode.dataAttributes || [];\r\n\t\t\t\t\tlangx.each(attrs, function setAttribute (attr, setTo) {\r\n\t\t\t\t\t\tswitch (attr) {\r\n\t\t\t\t\t\tcase 'cssClass':\r\n\t\t\t\t\t\tcase 'class':\r\n\t\t\t\t\t\tcase 'className':\r\n\t\t\t\t\t\t\t$entity.addClass(setTo);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t// allow custom icons\r\n\t\t\t\t\t\tcase 'data-icon':\r\n\t\t\t\t\t\t\t$entity.find('.icon-item').removeClass().addClass('icon-item ' + setTo);\r\n\t\t\t\t\t\t\t$entity.attr(attr, setTo);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t// ARIA support\r\n\t\t\t\t\t\tcase 'id':\r\n\t\t\t\t\t\t\t$entity.attr(attr, setTo);\r\n\t\t\t\t\t\t\t$entity.attr('aria-labelledby', setTo + '-label');\r\n\t\t\t\t\t\t\t$entity.find('.tree-branch-name > .tree-label').attr('id', setTo + '-label');\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t// style, data-*\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t$entity.attr(attr, setTo);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// add child node\r\n\t\t\t\t\tif (atRoot) {\r\n\t\t\t\t\t\t// For accessibility reasons, the root element is the only tab-able element (see https://github.com/ExactTarget/fuelux/issues/1964)\r\n\t\t\t\t\t\t$parent.append($entity);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$parent.find('.tree-branch-children:eq(0)').append($entity);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t$parent.find('.tree-loader').addClass('hidden');\r\n\t\t\t\t// return newly populated folder\r\n\t\t\t\tself.$element.trigger('loaded.fu.tree', $parent);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tselectTreeNode: function selectItem(clickedElement, nodeType) {\r\n\t\t\tvar clicked = {};\t// object for clicked element\r\n\t\t\tclicked.$element = $(clickedElement);\r\n\r\n\t\t\tvar selected = {}; // object for selected elements\r\n\t\t\tselected.$elements = this.$element.find('.tree-selected');\r\n\t\t\tselected.dataForEvent = [];\r\n\r\n\t\t\t// determine clicked element and it's icon\r\n\t\t\tif (nodeType === 'folder') {\r\n\t\t\t\t// make the clicked.$element the container branch\r\n\t\t\t\tclicked.$element = clicked.$element.closest('.tree-branch');\r\n\t\t\t\tclicked.$icon = clicked.$element.find('.icon-folder');\r\n\t\t\t} else {\r\n\t\t\t\tclicked.$icon = clicked.$element.find('.icon-item');\r\n\t\t\t}\r\n\t\t\tclicked.elementData = clicked.$element.data();\r\n\r\n\t\t\tariaSelect(clicked.$element);\r\n\r\n\t\t\t// the below functions pass objects by copy/reference and use modified object in this function\r\n\t\t\tif ( this.options.multiSelect ) {\r\n\t\t\t\tselected = multiSelectSyncNodes(this, clicked, selected);\r\n\t\t\t} else {\r\n\t\t\t\tselected = singleSelectSyncNodes(this, clicked, selected);\r\n\t\t\t}\r\n\r\n\t\t\tsetFocus(this.$element, clicked.$element);\r\n\r\n\t\t\t// all done with the DOM, now fire events\r\n\t\t\tthis.$element.trigger(selected.eventType + '.fu.tree', {\r\n\t\t\t\ttarget: clicked.elementData,\r\n\t\t\t\tselected: selected.dataForEvent\r\n\t\t\t});\r\n\r\n\t\t\tclicked.$element.trigger('updated.fu.tree', {\r\n\t\t\t\tselected: selected.dataForEvent,\r\n\t\t\t\titem: clicked.$element,\r\n\t\t\t\teventType: selected.eventType\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\tdiscloseFolder: function discloseFolder(folder) {\r\n\t\t\tvar $folder = $(folder);\r\n\r\n\t\t\tvar $branch = $folder.closest('.tree-branch');\r\n\t\t\tvar $treeFolderContent = $branch.find('.tree-branch-children');\r\n\t\t\tvar $treeFolderContentFirstChild = $treeFolderContent.eq(0);\r\n\r\n\t\t\t// take care of the styles\r\n\t\t\t$branch.addClass('tree-open');\r\n\t\t\t$branch.attr('aria-expanded', 'true');\r\n\t\t\t$treeFolderContentFirstChild.removeClass('hide hidden'); // jQuery deprecated hide in 3.0. Use hidden instead. Leaving hide here to support previous markup\r\n\t\t\t$branch.find('> .tree-branch-header .icon-folder').eq(0)\r\n\t\t\t\t.removeClass('glyphicon-folder-close')\r\n\t\t\t\t.addClass('glyphicon-folder-open');\r\n\r\n\t\t\tvar $tree = this.$element;\r\n\t\t\tvar disclosedCompleted = function disclosedCompleted () {\r\n\t\t\t\t$tree.trigger('disclosedFolder.fu.tree', $branch.data());\r\n\t\t\t};\r\n\r\n\t\t\t// add the children to the folder\r\n\t\t\tif (!$treeFolderContent.children().length) {\r\n\t\t\t\t$tree.one('loaded.fu.tree', disclosedCompleted);\r\n\t\t\t\tthis.populate($treeFolderContent);\r\n\t\t\t} else {\r\n\t\t\t\tdisclosedCompleted();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tcloseFolder: function closeFolder(el) {\r\n\t\t\tvar $el = $(el);\r\n\t\t\tvar $branch = $el.closest('.tree-branch');\r\n\t\t\tvar $treeFolderContent = $branch.find('.tree-branch-children');\r\n\t\t\tvar $treeFolderContentFirstChild = $treeFolderContent.eq(0);\r\n\r\n\t\t\t// take care of the styles\r\n\t\t\t$branch.removeClass('tree-open');\r\n\t\t\t$branch.attr('aria-expanded', 'false');\r\n\t\t\t$treeFolderContentFirstChild.addClass('hidden');\r\n\t\t\t$branch.find('> .tree-branch-header .icon-folder').eq(0)\r\n\t\t\t\t.removeClass('glyphicon-folder-open')\r\n\t\t\t\t.addClass('glyphicon-folder-close');\r\n\r\n\t\t\t// remove chidren if no cache\r\n\t\t\tif (!this.options.cacheItems) {\r\n\t\t\t\t$treeFolderContentFirstChild.empty();\r\n\t\t\t}\r\n\r\n\t\t\tthis.$element.trigger('closed.fu.tree', $branch.data());\r\n\t\t},\r\n\r\n\t\ttoggleFolder: function toggleFolder(el) {\r\n\t\t\tvar $el = $(el);\r\n\r\n\t\t\tif ($el.find('.glyphicon-folder-close').length) {\r\n\t\t\t\tthis.discloseFolder(el);\r\n\t\t\t} else if ($el.find('.glyphicon-folder-open').length) {\r\n\t\t\t\tthis.closeFolder(el);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectFolder: function selectFolder(el) {\r\n\t\t\tif (this.options.folderSelect) {\r\n\t\t\t\tthis.selectTreeNode(el, 'folder');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectItem: function selectItem(el) {\r\n\t\t\tif (this.options.itemSelect) {\r\n\t\t\t\tthis.selectTreeNode(el, 'item');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tselectedItems: function selectedItems() {\r\n\t\t\tvar $sel = this.$element.find('.tree-selected');\r\n\t\t\tvar selected = [];\r\n\r\n\t\t\tlangx.each($sel, function buildSelectedArray (i, value) {\r\n\t\t\t\tselected.push($(value).data());\r\n\t\t\t});\r\n\t\t\treturn selected;\r\n\t\t},\r\n\r\n\t\t// collapses open folders\r\n\t\tcollapse: function collapse() {\r\n\t\t\tvar self = this;\r\n\t\t\tvar reportedClosed = [];\r\n\r\n\t\t\tvar closedReported = function closedReported(event, closed) {\r\n\t\t\t\treportedClosed.push(closed);\r\n\r\n\t\t\t\t// jQuery deprecated hide in 3.0. Use hidden instead. Leaving hide here to support previous markup\r\n\t\t\t\tif (self.$element.find(\".tree-branch.tree-open:not('.hidden, .hide')\").length === 0) {\r\n\t\t\t\t\tself.$element.trigger('closedAll.fu.tree', {\r\n\t\t\t\t\t\ttree: self.$element,\r\n\t\t\t\t\t\treportedClosed: reportedClosed\r\n\t\t\t\t\t});\r\n\t\t\t\t\tself.$element.off('loaded.fu.tree', self.$element, closedReported);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// trigger callback when all folders have reported closed\r\n\t\t\tself.$element.on('closed.fu.tree', closedReported);\r\n\r\n\t\t\tself.$element.find(\".tree-branch.tree-open:not('.hidden, .hide')\").each(function closeFolder () {\r\n\t\t\t\tself.closeFolder(this);\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t// disclose visible will only disclose visible tree folders\r\n\t\tdiscloseVisible: function discloseVisible() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tvar $openableFolders = self.$element.find(\".tree-branch:not('.tree-open, .hidden, .hide')\");\r\n\t\t\tvar reportedOpened = [];\r\n\r\n\t\t\tvar openReported = function openReported(event, opened) {\r\n\t\t\t\treportedOpened.push(opened);\r\n\r\n\t\t\t\tif (reportedOpened.length === $openableFolders.length) {\r\n\t\t\t\t\tself.$element.trigger('disclosedVisible.fu.tree', {\r\n\t\t\t\t\t\ttree: self.$element,\r\n\t\t\t\t\t\treportedOpened: reportedOpened\r\n\t\t\t\t\t});\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t* Unbind the `openReported` event. `discloseAll` may be running and we want to reset this\r\n\t\t\t\t\t* method for the next iteration.\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tself.$element.off('loaded.fu.tree', self.$element, openReported);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\t// trigger callback when all folders have reported opened\r\n\t\t\tself.$element.on('loaded.fu.tree', openReported);\r\n\r\n\t\t\t// open all visible folders\r\n\t\t\tself.$element.find(\".tree-branch:not('.tree-open, .hidden, .hide')\").each(function triggerOpen() {\r\n\t\t\t\tself.discloseFolder($(this).find('.tree-branch-header'));\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t* Disclose all will keep listening for `loaded.fu.tree` and if `$(tree-el).data('ignore-disclosures-limit')`\r\n\t\t* is `true` (defaults to `true`) it will attempt to disclose any new closed folders than were\r\n\t\t* loaded in during the last disclosure.\r\n\t\t*/\r\n\t\tdiscloseAll: function discloseAll() {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t// first time\r\n\t\t\tif (typeof self.$element.data('disclosures') === 'undefined') {\r\n\t\t\t\tself.$element.data('disclosures', 0);\r\n\t\t\t}\r\n\r\n\t\t\tvar isExceededLimit = (self.options.disclosuresUpperLimit >= 1 && self.$element.data('disclosures') >= self.options.disclosuresUpperLimit);\r\n\t\t\tvar isAllDisclosed = self.$element.find(\".tree-branch:not('.tree-open, .hidden, .hide')\").length === 0;\r\n\r\n\r\n\t\t\tif (!isAllDisclosed) {\r\n\t\t\t\tif (isExceededLimit) {\r\n\t\t\t\t\tself.$element.trigger('exceededDisclosuresLimit.fu.tree', {\r\n\t\t\t\t\t\ttree: self.$element,\r\n\t\t\t\t\t\tdisclosures: self.$element.data('disclosures')\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t/*\r\n\t\t\t\t\t* If you've exceeded the limit, the loop will be killed unless you\r\n\t\t\t\t\t* explicitly ignore the limit and start the loop again:\r\n\t\t\t\t\t*\r\n\t\t\t\t\t*    $tree.one('exceededDisclosuresLimit.fu.tree', function () {\r\n\t\t\t\t\t*        $tree.data('ignore-disclosures-limit', true);\r\n\t\t\t\t\t*        $tree.tree('discloseAll');\r\n\t\t\t\t\t*    });\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tif (!self.$element.data('ignore-disclosures-limit')) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.$element.data('disclosures', self.$element.data('disclosures') + 1);\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t* A new branch that is closed might be loaded in, make sure those get handled too.\r\n\t\t\t\t* This attachment needs to occur before calling `discloseVisible` to make sure that\r\n\t\t\t\t* if the execution of `discloseVisible` happens _super fast_ (as it does in our QUnit tests\r\n\t\t\t\t* this will still be called. However, make sure this only gets called _once_, because\r\n\t\t\t\t* otherwise, every single time we go through this loop, _another_ event will be bound\r\n\t\t\t\t* and then when the trigger happens, this will fire N times, where N equals the number\r\n\t\t\t\t* of recursive `discloseAll` executions (instead of just one)\r\n\t\t\t\t*/\r\n\t\t\t\tself.$element.one('disclosedVisible.fu.tree', function callDiscloseAll () {\r\n\t\t\t\t\tself.discloseAll();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t* If the page is very fast, calling this first will cause `disclosedVisible.fu.tree` to not\r\n\t\t\t\t* be bound in time to be called, so, we need to call this last so that the things bound\r\n\t\t\t\t* and triggered above can have time to take place before the next execution of the\r\n\t\t\t\t* `discloseAll` method.\r\n\t\t\t\t*/\r\n\t\t\t\tself.discloseVisible();\r\n\t\t\t} else {\r\n\t\t\t\tself.$element.trigger('disclosedAll.fu.tree', {\r\n\t\t\t\t\ttree: self.$element,\r\n\t\t\t\t\tdisclosures: self.$element.data('disclosures')\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// if `cacheItems` is false, and they call closeAll, the data is trashed and therefore\r\n\t\t\t\t// disclosures needs to accurately reflect that\r\n\t\t\t\tif (!self.options.cacheItems) {\r\n\t\t\t\t\tself.$element.one('closeAll.fu.tree', function updateDisclosuresData () {\r\n\t\t\t\t\t\tself.$element.data('disclosures', 0);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// This refreshes the children of a folder. Please destroy and re-initilize for \"root level\" refresh.\r\n\t\t// The data of the refreshed folder is not updated. This control's architecture only allows updating of children.\r\n\t\t// Folder renames should probably be handled directly on the node.\r\n\t\trefreshFolder: function refreshFolder($el) {\r\n\t\t\tvar $treeFolder = $el.closest('.tree-branch');\r\n\t\t\tvar $treeFolderChildren = $treeFolder.find('.tree-branch-children');\r\n\t\t\t$treeFolderChildren.eq(0).empty();\r\n\r\n\t\t\tif ($treeFolder.hasClass('tree-open')) {\r\n\t\t\t\tthis.populate($treeFolderChildren, false);\r\n\t\t\t} else {\r\n\t\t\t\tthis.populate($treeFolderChildren, true);\r\n\t\t\t}\r\n\r\n\t\t\tthis.$element.trigger('refreshedFolder.fu.tree', $treeFolder.data());\r\n\t\t}\r\n\t});\r\n\r\n\t// ALIASES\r\n\r\n\t// alias for collapse for consistency. \"Collapse\" is an ambiguous term (collapse what? All? One specific branch?)\r\n\tTree.prototype.closeAll = Tree.prototype.collapse;\r\n\t// alias for backwards compatibility because there's no reason not to.\r\n\tTree.prototype.openFolder = Tree.prototype.discloseFolder;\r\n\t// For library consistency\r\n\tTree.prototype.getValue = Tree.prototype.selectedItems;\r\n\r\n\t// PRIVATE FUNCTIONS\r\n\r\n\tvar fixFocusability = function fixFocusability ($tree, $branch) {\r\n\t\t/*\r\n\t\tWhen tree initializes on page, the `<ul>` element should have tabindex=0 and all sub-elements should have\r\n\t\ttabindex=-1. When focus leaves the tree, whatever the last focused on element was will keep the tabindex=0. The\r\n\t\ttree itself will have a tabindex=-1. The reason for this is that if you are inside of the tree and press\r\n\t\tshift+tab, it will try and focus on the tree you are already in, which will cause focus to shift immediately\r\n\t\tback to the element you are already focused on. That will make it seem like the event is getting \"Swallowed up\"\r\n\t\tby an aggressive event listener trap.\r\n\r\n\t\tFor this reason, only one element in the entire tree, including the tree itself, should ever have tabindex=0.\r\n\t\tIf somewhere down the line problems are being caused by this, the only further potential improvement I can\r\n\t\tenvision at this time is listening for the tree to lose focus and reseting the tabindexes of all children to -1\r\n\t\tand setting the tabindex of the tree itself back to 0. This seems overly complicated with no benefit that I can\r\n\t\timagine at this time, so instead I am leaving the last focused element with the tabindex of 0, even upon blur of\r\n\t\tthe tree.\r\n\r\n\t\tOne benefit to leaving the last focused element in a tree with a tabindex=0 is that if you accidentally tab out\r\n\t\tof the tree and then want to tab back in, you will be placed exactly where you left off instead of at the\r\n\t\tbeginning of the tree.\r\n\t\t*/\r\n\t\t$tree.attr('tabindex', -1);\r\n\t\t$tree.find('li').attr('tabindex', -1);\r\n\t\tif ($branch && $branch.length > 0) {\r\n\t\t\t$branch.attr('tabindex', 0); // if tabindex is not set to 0 (or greater), node is not able to receive focus\r\n\t\t}\r\n\t};\r\n\r\n\t// focuses into (onto one of the children of) the provided branch\r\n\tvar focusIn = function focusIn ($tree, $branch) {\r\n\t\tvar $focusCandidate = $branch.find('.tree-selected:first');\r\n\r\n\t\t// if no node is selected, set focus to first visible node\r\n\t\tif ($focusCandidate.length <= 0) {\r\n\t\t\t$focusCandidate = $branch.find('li:not(\".hidden\"):first');\r\n\t\t}\r\n\r\n\t\tsetFocus($tree, $focusCandidate);\r\n\t};\r\n\r\n\t// focuses on provided branch\r\n\tvar setFocus = function setFocus ($tree, $branch) {\r\n\t\tfixFocusability($tree, $branch);\r\n\r\n\t\t$tree.attr('aria-activedescendant', $branch.attr('id'));\r\n\r\n\t\t$branch.focus();\r\n\r\n\t\t$tree.trigger('setFocus.fu.tree', $branch);\r\n\t};\r\n\r\n\tvar navigateTree = function navigateTree ($tree, e) {\r\n\t\tif (e.isDefaultPrevented() || e.isPropagationStopped()) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tvar targetNode = e.originalEvent.target;\r\n\t\tvar $targetNode = $(targetNode);\r\n\t\tvar isOpen = $targetNode.hasClass('tree-open');\r\n\t\tvar handled = false;\r\n\t\t// because es5 lacks promises and fuelux has no polyfil (and I'm not adding one just for this change)\r\n\t\t// I am faking up promises here through callbacks and listeners. Done will be fired immediately at the end of\r\n\t\t// the navigateTree method if there is no (fake) promise, but will be fired by an event listener that will\r\n\t\t// be triggered by another function if necessary. This way when done runs, and fires keyboardNavigated.fu.tree\r\n\t\t// anything listening for that event can be sure that everything tied to that event is actually completed.\r\n\t\tvar fireDoneImmediately = true;\r\n\t\tvar done = function done () {\r\n\t\t\t$tree.trigger('keyboardNavigated.fu.tree', e, $targetNode);\r\n\t\t};\r\n\r\n\t\tswitch (e.which) {\r\n\t\tcase 13: // enter\r\n\t\tcase 32: // space\r\n\t\t\t// activates a node, i.e., performs its default action.\r\n\t\t\t// For parent nodes, one possible default action is to open or close the node.\r\n\t\t\t// In single-select trees where selection does not follow focus, the default action is typically to select the focused node.\r\n\t\t\tvar foldersSelectable = $tree.hasClass('tree-folder-select');\r\n\t\t\tvar isFolder = $targetNode.hasClass('tree-branch');\r\n\t\t\tvar isItem = $targetNode.hasClass('tree-item');\r\n\t\t\t// var isOverflow = $targetNode.hasClass('tree-overflow');\r\n\r\n\t\t\tfireDoneImmediately = false;\r\n\t\t\tif (isFolder) {\r\n\t\t\t\tif (foldersSelectable) {\r\n\t\t\t\t\t$tree.one('selected.fu.tree deselected.fu.tree', done);\r\n\t\t\t\t\t$tree.tree('selectFolder', $targetNode.find('.tree-branch-header')[0]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t$tree.one('loaded.fu.tree closed.fu.tree', done);\r\n\t\t\t\t\t$tree.tree('toggleFolder', $targetNode.find('.tree-branch-header')[0]);\r\n\t\t\t\t}\r\n\t\t\t} else if (isItem) {\r\n\t\t\t\t$tree.one('selected.fu.tree', done);\r\n\t\t\t\t$tree.tree('selectItem', $targetNode);\r\n\t\t\t} else {\r\n\t\t\t\t// should be isOverflow... Try and click on it either way.\r\n\t\t\t\t$prev = $($targetNode.prevAll().not('.hidden')[0]);\r\n\t\t\t\t$targetNode.click();\r\n\r\n\t\t\t\t$tree.one('loaded.fu.tree', function selectFirstNewlyLoadedNode () {\r\n\t\t\t\t\t$next = $($prev.nextAll().not('.hidden')[0]);\r\n\r\n\t\t\t\t\tsetFocus($tree, $next);\r\n\t\t\t\t\tdone();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\t\tcase 35: // end\r\n\t\t\t// Set focus to the last node in the tree that is focusable without opening a node.\r\n\t\t\tsetFocus($tree, $tree.find('li:not(\".hidden\"):last'));\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\t\tcase 36: // home\r\n\t\t\t// set focus to the first node in the tree without opening or closing a node.\r\n\t\t\tsetFocus($tree, $tree.find('li:not(\".hidden\"):first'));\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\t\tcase 37: // left\r\n\t\t\tif (isOpen) {\r\n\t\t\t\tfireDoneImmediately = false;\r\n\t\t\t\t$tree.one('closed.fu.tree', done);\r\n\t\t\t\t$tree.tree('closeFolder', targetNode);\r\n\t\t\t} else {\r\n\t\t\t\tsetFocus($tree, $($targetNode.parents('li')[0]));\r\n\t\t\t}\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 38: // up\r\n\t\t\t// move focus to previous sibling\r\n\t\t\tvar $prev = [];\r\n\t\t\t// move to previous li not hidden\r\n\t\t\t$prev = $($targetNode.prevAll().not('.hidden')[0]);\r\n\r\n\t\t\t// if the previous li is open, and has children, move selection to its last child so selection\r\n\t\t\t// appears to move to the next \"thing\" up\r\n\t\t\tif ($prev.hasClass('tree-open')) {\r\n\t\t\t\tvar $prevChildren = $prev.find('li:not(\".hidden\"):last');\r\n\t\t\t\tif ($prevChildren.length > 0) {\r\n\t\t\t\t\t$prev = $($prevChildren[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// if nothing has been selected, we are presumably at the top of an open li, select the immediate parent\r\n\t\t\tif ($prev.length < 1) {\r\n\t\t\t\t$prev = $($targetNode.parents('li')[0]);\r\n\t\t\t}\r\n\t\t\tsetFocus($tree, $prev);\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 39: // right\r\n\t\t\tif (isOpen) {\r\n\t\t\t\tfocusIn($tree, $targetNode);\r\n\t\t\t} else {\r\n\t\t\t\tfireDoneImmediately = false;\r\n\t\t\t\t$tree.one('disclosed.fu.tree', done);\r\n\t\t\t\t$tree.tree('discloseFolder', targetNode);\r\n\t\t\t}\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 40: // down\r\n\t\t\t// move focus to next selectable tree node\r\n\t\t\tvar $next = $($targetNode.find('li:not(\".hidden\"):first')[0]);\r\n\t\t\tif (!isOpen || $next.length <= 0) {\r\n\t\t\t\t$next = $($targetNode.nextAll().not('.hidden')[0]);\r\n\t\t\t}\r\n\r\n\t\t\tif ($next.length < 1) {\r\n\t\t\t\t$next = $($($targetNode.parents('li')[0]).nextAll().not('.hidden')[0]);\r\n\t\t\t}\r\n\t\t\tsetFocus($tree, $next);\r\n\r\n\t\t\thandled = true;\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\t// console.log(e.which);\r\n\t\t\treturn true; // exit this handler for other keys\r\n\t\t}\r\n\r\n\t\t// if we didn't handle the event, allow propagation to continue so something else might.\r\n\t\tif (handled) {\r\n\t\t\te.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tif (fireDoneImmediately) {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\tvar ariaSelect = function ariaSelect ($element) {\r\n\t\t$element.attr('aria-selected', true);\r\n\t};\r\n\r\n\tvar ariaDeselect = function ariaDeselect ($element) {\r\n\t\t$element.attr('aria-selected', false);\r\n\t};\r\n\r\n\tfunction styleNodeSelected ($element, $icon) {\r\n\t\t$element.addClass('tree-selected');\r\n\t\tif ( $element.data('type') === 'item' && $icon.hasClass('fueluxicon-bullet') ) {\r\n\t\t\t$icon.removeClass('fueluxicon-bullet').addClass('glyphicon-ok'); // make checkmark\r\n\t\t}\r\n\t}\r\n\r\n\tfunction styleNodeDeselected ($element, $icon) {\r\n\t\t$element.removeClass('tree-selected');\r\n\t\tif ( $element.data('type') === 'item' && $icon.hasClass('glyphicon-ok') ) {\r\n\t\t\t$icon.removeClass('glyphicon-ok').addClass('fueluxicon-bullet'); // make bullet\r\n\t\t}\r\n\t}\r\n\r\n\tfunction multiSelectSyncNodes (self, clicked, selected) {\r\n\t\t// search for currently selected and add to selected data list if needed\r\n\t\tlangx.each(selected.$elements, function findCurrentlySelected (index, element) {\r\n\t\t\tvar $element = $(element);\r\n\r\n\t\t\tif ($element[0] !== clicked.$element[0]) {\r\n\t\t\t\tselected.dataForEvent.push( $($element).data() );\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (clicked.$element.hasClass('tree-selected')) {\r\n\t\t\tstyleNodeDeselected(clicked.$element, clicked.$icon);\r\n\t\t\t// set event data\r\n\t\t\tselected.eventType = 'deselected';\r\n\t\t} else {\r\n\t\t\tstyleNodeSelected(clicked.$element, clicked.$icon);\r\n\t\t\t// set event data\r\n\t\t\tselected.eventType = 'selected';\r\n\t\t\tselected.dataForEvent.push(clicked.elementData);\r\n\t\t}\r\n\r\n\t\treturn selected;\r\n\t}\r\n\r\n\tfunction singleSelectSyncNodes(self, clicked, selected) {\r\n\t\t// element is not currently selected\r\n\t\tif (selected.$elements[0] !== clicked.$element[0]) {\r\n\t\t\tself.deselectAll(self.$element);\r\n\t\t\tstyleNodeSelected(clicked.$element, clicked.$icon);\r\n\t\t\t// set event data\r\n\t\t\tselected.eventType = 'selected';\r\n\t\t\tselected.dataForEvent = [clicked.elementData];\r\n\t\t} else {\r\n\t\t\tstyleNodeDeselected(clicked.$element, clicked.$icon);\r\n\t\t\t// set event data\r\n\t\t\tselected.eventType = 'deselected';\r\n\t\t\tselected.dataForEvent = [];\r\n\t\t}\r\n\r\n\t\treturn selected;\r\n\t}\r\n\r\n\t// TREE PLUGIN DEFINITION\r\n\r\n\t$.fn.tree = function fntree (option) {\r\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\r\n\t\tvar methodReturn;\r\n\r\n\t\tvar $set = this.each(function eachThis () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar data = $this.data('fu.tree');\r\n\t\t\tvar options = typeof option === 'object' && option;\r\n\r\n\t\t\tif (!data) {\r\n\t\t\t\t$this.data('fu.tree', (data = new Tree(this, options)));\r\n\t\t\t\t$this.trigger('initialized.fu.tree');\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof option === 'string') {\r\n\t\t\t\tmethodReturn = data[option].apply(data, args);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn (methodReturn === undefined) ? $set : methodReturn;\r\n\t};\r\n\r\n\t/*\r\n\t * Private method used only by the default dataSource for the tree, which is used to consume static\r\n\t * tree data.\r\n\t *\r\n\t * Find children of supplied parent in rootData. You can pass in an entire deeply nested tree\r\n\t * and this will look through it recursively until it finds the child data you are looking for.\r\n\t *\r\n\t * For extremely large trees, this could cause the browser to crash, as there is no protection\r\n\t * or limit on the amount of branches that will be searched through.\r\n\t */\r\n\tvar findChildData = function findChildData (targetParent, rootData) {\r\n\t\tvar isRootOfTree = $.isEmptyObject(targetParent);\r\n\t\tif (isRootOfTree) {\r\n\t\t\treturn rootData;\r\n\t\t}\r\n\r\n\t\tif (rootData === undefined) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < rootData.length; i++) {\r\n\t\t\tvar potentialMatch = rootData[i];\r\n\r\n\t\t\tif (potentialMatch.attr && targetParent.attr && potentialMatch.attr.id === targetParent.attr.id) {\r\n\t\t\t\treturn potentialMatch.children;\r\n\t\t\t} else if (potentialMatch.children) {\r\n\t\t\t\tvar foundChild = findChildData(targetParent, potentialMatch.children);\r\n\t\t\t\tif (foundChild) {\r\n\t\t\t\t\treturn foundChild;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t};\r\n\r\n\t$.fn.tree.defaults = {\r\n\t\t/*\r\n\t\t * A static data representation of your full tree data. If you do not override the tree's\r\n\t\t * default dataSource method, this will just make the tree work out of the box without\r\n\t\t * you having to bring your own dataSource.\r\n\t\t *\r\n\t\t * Array of Objects representing tree branches (folder) and leaves (item):\r\n\t\t\t[\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\ttype: 'folder',\r\n\t\t\t\t\tattr: {\r\n\t\t\t\t\t\tid: ''\r\n\t\t\t\t\t},\r\n\t\t\t\t\tchildren: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: '',\r\n\t\t\t\t\t\t\ttype: 'item',\r\n\t\t\t\t\t\t\tattr: {\r\n\t\t\t\t\t\t\t\tid: '',\r\n\t\t\t\t\t\t\t\t'data-icon': 'glyphicon glyphicon-file'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\ttype: 'item',\r\n\t\t\t\t\tattr: {\r\n\t\t\t\t\t\tid: '',\r\n\t\t\t\t\t\t'data-icon': 'glyphicon glyphicon-file'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t];\r\n\t\t */\r\n\t\tstaticData: [],\r\n\t\t/*\r\n\t\t * If you set the full tree data on options.staticData, you can use this default dataSource\r\n\t\t * to consume that data. This allows you to just pass in a JSON array representation\r\n\t\t * of your full tree data and the tree will just work out of the box.\r\n\t\t */\r\n\t\tdataSource: function staticDataSourceConsumer (openedParentData, callback) {\r\n\t\t\tif (this.staticData.length > 0) {\r\n\t\t\t\tvar childData = findChildData(openedParentData, this.staticData);\r\n\r\n\t\t\t\tcallback({\r\n\t\t\t\t\tdata: childData\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tmultiSelect: false,\r\n\t\tcacheItems: true,\r\n\t\tfolderSelect: true,\r\n\t\titemSelect: true,\r\n\t\t/*\r\n\t\t* How many times `discloseAll` should be called before a stopping and firing\r\n\t\t* an `exceededDisclosuresLimit` event. You can force it to continue by\r\n\t\t* listening for this event, setting `ignore-disclosures-limit` to `true` and\r\n\t\t* starting `discloseAll` back up again. This lets you make more decisions\r\n\t\t* about if/when/how/why/how many times `discloseAll` will be started back\r\n\t\t* up after it exceeds the limit.\r\n\t\t*\r\n\t\t*    $tree.one('exceededDisclosuresLimit.fu.tree', function () {\r\n\t\t*        $tree.data('ignore-disclosures-limit', true);\r\n\t\t*        $tree.tree('discloseAll');\r\n\t\t*    });\r\n\t\t*\r\n\t\t* `disclusuresUpperLimit` defaults to `0`, so by default this trigger\r\n\t\t* will never fire. The true hard the upper limit is the browser's\r\n\t\t* ability to load new items (i.e. it will keep loading until the browser\r\n\t\t* falls over and dies). On the Fuel UX `index.html` page, the point at\r\n\t\t* which the page became super slow (enough to seem almost unresponsive)\r\n\t\t* was `4`, meaning 256 folders had been opened, and 1024 were attempting to open.\r\n\t\t*/\r\n\t\tdisclosuresUpperLimit: 0\r\n\t};\r\n\r\n\t$.fn.tree.Constructor = Tree;\r\n\r\n\t$.fn.tree.noConflict = function noConflict () {\r\n\t\t$.fn.tree = old;\r\n\t\treturn this;\r\n\t};\r\n\r\n\treturn $.fn.tree;\r\n});"]}