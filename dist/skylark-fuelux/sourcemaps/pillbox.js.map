{"version":3,"sources":["pillbox.js"],"names":["define","langx","browser","eventer","noder","geom","$","fuelux","old","fn","pillbox","CONST","COMMA_KEYCODE","ENTER_KEYCODE","isBackspaceKey","isDeleteKey","isTabKey","isUpArrow","isDownArrow","cleanInput","isShiftHeld","Pillbox","WidgetBase","inherit","klassName","init","element","options","this","$element","$moreCount","find","$pillGroup","$addItem","$addItemWrap","parent","$suggest","$pillHTML","mixin","defaults","readonly","undefined","attr","acceptKeyCodes","_generateObject","on","proxy","itemClicked","inputFocus","inputEvent","onKeyDown","suggestionClick","edit","addClass","cancelEdit","destroy","remove","outerHTML","items","self","children","map","getItemData","get","e","$item","$target","target","preventDefault","stopPropagation","_closeSuggestions","hasClass","onRemove","el","_removeElement","length","openEdit","trigger","enable","removeAttr","truncate","currentTarget","item","text","html","value","data","val","JSON","parse","addItems","itemCount","index","isInternal","isFinite","String","arguments","Array","slice","call","each","i","currentEdit","wrap","pop","onAdd","saveEdit","placeItems","removeItems","howMany","itemsToRemove","$currentItem","_removePillTrigger","method","$neighbor","newItems","key","push","eq","before","last","after","prepend","isFocusOutEvent","type","blurredAfterInput","keyCode","_isSuggestionsOpen","$selection","replace","match","allowEmptyPills","hide","setTimeout","show","size","focus","$lastItem","width","removeClass","_keySuggestions","callbackId","timeStamp","event","_openSuggestions","targetChildIndex","detach","select","append","removeBySelector","selectors","sel","removedSelectors","removeByValue","values","removedValues","removeByText","matchingText","removedText","availableWidth","containerFull","processedPills","totalPills","widthUsed","pill","outerWidth","removedBy","obj","$suggestionList","$suggestion","stringify","document","$first","dir","$next","prev","next","prototype","getValue","option","methodReturn","args","$set","$this","apply","Constructor","noConflict"],"mappings":"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","file":"../pillbox.js","sourcesContent":["define([\n  \"skylark-langx/langx\",\n  \"skylark-domx/browser\",\n  \"skylark-domx/eventer\",\n  \"skylark-domx/noder\",\n  \"skylark-domx/geom\",\n  \"skylark-domx/query\",\n  \"./fuelux\",\n  \"./dropdown-autoflip\"\n],function(langx,browser,eventer,noder,geom,$,fuelux){\n\n\t/*\n\t * Fuel UX Pillbox\n\t * https://github.com/ExactTarget/fuelux\n\t *\n\t * Copyright (c) 2014 ExactTarget\n\t * Licensed under the BSD New license.\n\t */\n\n\t// -- END UMD WRAPPER PREFACE --\n\n\t// -- BEGIN MODULE CODE HERE --\n\n\tvar old = $.fn.pillbox;\n\n\tvar CONST = fuelux.CONST;\n\tvar COMMA_KEYCODE = CONST.COMMA_KEYCODE;\n\tvar ENTER_KEYCODE = CONST.ENTER_KEYCODE;\n\tvar isBackspaceKey = fuelux.isBackspaceKey;\n\tvar isDeleteKey = fuelux.isDeleteKey;\n\tvar isTabKey = fuelux.isTabKey;\n\tvar isUpArrow = fuelux.isUpArrow;\n\tvar isDownArrow = fuelux.isDownArrow;\n\tvar cleanInput = fuelux.cleanInput;\n\tvar isShiftHeld = fuelux.isShiftHeld;\n\n\t// PILLBOX CONSTRUCTOR AND PROTOTYPE\n\n\tvar Pillbox = fuelux.Pillbox = fuelux.WidgetBase.inherit({\n\t\tklassName: \"Pillbox\",\n\n\t\tinit : function(element,options) {\n\t\t\tthis.$element = $(element);\n\t\t\tthis.$moreCount = this.$element.find('.pillbox-more-count');\n\t\t\tthis.$pillGroup = this.$element.find('.pill-group');\n\t\t\tthis.$addItem = this.$element.find('.pillbox-add-item');\n\t\t\tthis.$addItemWrap = this.$addItem.parent();\n\t\t\tthis.$suggest = this.$element.find('.suggest');\n\t\t\tthis.$pillHTML = '<li class=\"btn btn-default pill\">' +\n\t\t\t'\t<span></span>' +\n\t\t\t'\t<span class=\"glyphicon glyphicon-close\">' +\n\t\t\t'\t\t<span class=\"sr-only\">Remove</span>' +\n\t\t\t'\t</span>' +\n\t\t\t'</li>';\n\n\t\t\tthis.options = langx.mixin({}, $.fn.pillbox.defaults, options);\n\n\t\t\tif (this.options.readonly === -1) {\n\t\t\t\tif (this.$element.attr('data-readonly') !== undefined) {\n\t\t\t\t\tthis.readonly(true);\n\t\t\t\t}\n\t\t\t} else if (this.options.readonly) {\n\t\t\t\tthis.readonly(true);\n\t\t\t}\n\n\t\t\t// EVENTS\n\t\t\tthis.acceptKeyCodes = this._generateObject(this.options.acceptKeyCodes);\n\t\t\t// Create an object out of the key code array, so we don't have to loop through it on every key stroke\n\n\t\t\tthis.$element.on('click.fu.pillbox', '.pill-group > .pill', langx.proxy(this.itemClicked, this));\n\t\t\tthis.$element.on('click.fu.pillbox', langx.proxy(this.inputFocus, this));\n\t\t\tthis.$element.on('keydown.fu.pillbox', '.pillbox-add-item', langx.proxy(this.inputEvent, this));\n\t\t\tif (this.options.onKeyDown) {\n\t\t\t\tthis.$element.on('mousedown.fu.pillbox', '.suggest > li', langx.proxy(this.suggestionClick, this));\n\t\t\t}\n\n\t\t\tif (this.options.edit) {\n\t\t\t\tthis.$element.addClass('pills-editable');\n\t\t\t\tthis.$element.on('blur.fu.pillbox', '.pillbox-add-item', langx.proxy(this.cancelEdit, this));\n\t\t\t}\n\t\t\tthis.$element.on('blur.fu.pillbox', '.pillbox-add-item', langx.proxy(this.inputEvent, this));\n\t\t},\n\n\t\tdestroy: function destroy () {\n\t\t\tthis.$element.remove();\n\t\t\t// any external bindings\n\t\t\t// [none]\n\t\t\t// empty elements to return to original markup\n\t\t\t// [none]\n\t\t\t// returns string of markup\n\t\t\treturn this.$element[0].outerHTML;\n\t\t},\n\n\t\titems: function items () {\n\t\t\tvar self = this;\n\n\t\t\treturn this.$pillGroup.children('.pill').map(function getItemsData () {\n\t\t\t\treturn self.getItemData($(this));\n\t\t\t}).get();\n\t\t},\n\n\t\titemClicked: function itemClicked (e) {\n\t\t\tvar $target = $(e.target);\n\t\t\tvar $item;\n\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tthis._closeSuggestions();\n\n\t\t\tif (!$target.hasClass('pill')) {\n\t\t\t\t$item = $target.parent();\n\t\t\t\tif (this.$element.attr('data-readonly') === undefined) {\n\t\t\t\t\tif ($target.hasClass('glyphicon-close')) {\n\t\t\t\t\t\tif (this.options.onRemove) {\n\t\t\t\t\t\t\tthis.options.onRemove(this.getItemData($item, {\n\t\t\t\t\t\t\t\tel: $item\n\t\t\t\t\t\t\t}), langx.proxy(this._removeElement, this));\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._removeElement(this.getItemData($item, {\n\t\t\t\t\t\t\t\tel: $item\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t} else if (this.options.edit) {\n\t\t\t\t\t\tif ($item.find('.pillbox-list-edit').length) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.openEdit($item);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t$item = $target;\n\t\t\t}\n\n\t\t\tthis.$element.trigger('clicked.fu.pillbox', this.getItemData($item));\n\n\t\t\treturn true;\n\t\t},\n\n\t\treadonly: function readonly (enable) {\n\t\t\tif (enable) {\n\t\t\t\tthis.$element.attr('data-readonly', 'readonly');\n\t\t\t} else {\n\t\t\t\tthis.$element.removeAttr('data-readonly');\n\t\t\t}\n\n\t\t\tif (this.options.truncate) {\n\t\t\t\tthis.truncate(enable);\n\t\t\t}\n\t\t},\n\n\t\tsuggestionClick: function suggestionClick (e) {\n\t\t\tvar $item = $(e.currentTarget);\n\t\t\tvar item = {\n\t\t\t\ttext: $item.html(),\n\t\t\t\tvalue: $item.data('value')\n\t\t\t};\n\n\t\t\te.preventDefault();\n\t\t\tthis.$addItem.val('');\n\n\t\t\tif ($item.data('attr')) {\n\t\t\t\titem.attr = JSON.parse($item.data('attr'));\n\t\t\t}\n\n\t\t\titem.data = $item.data('data');\n\n\t\t\tthis.addItems(item, true);\n\n\t\t\t// needs to be after addItems for IE\n\t\t\tthis._closeSuggestions();\n\t\t},\n\n\t\titemCount: function itemCount () {\n\t\t\treturn this.$pillGroup.children('.pill').length;\n\t\t},\n\n\t\t// First parameter is 1 based index (optional, if index is not passed all new items will be appended)\n\t\t// Second parameter can be array of objects [{ ... }, { ... }] or you can pass n additional objects as args\n\t\t// object structure is as follows (attr and value are optional): { text: '', value: '', attr: {}, data: {} }\n\t\taddItems: function addItems () {\n\t\t\tvar self = this;\n\t\t\tvar items;\n\t\t\tvar index;\n\t\t\tvar isInternal;\n\n\t\t\tif (isFinite(String(arguments[0])) && !(arguments[0] instanceof Array)) {\n\t\t\t\titems = [].slice.call(arguments).slice(1);\n\t\t\t\tindex = arguments[0];\n\t\t\t} else {\n\t\t\t\titems = [].slice.call(arguments).slice(0);\n\t\t\t\tisInternal = items[1] && !items[1].text;\n\t\t\t}\n\n\t\t\t// If first argument is an array, use that, otherwise they probably passed each thing through as a separate arg, so use items as-is\n\t\t\tif (items[0] instanceof Array) {\n\t\t\t\titems = items[0];\n\t\t\t}\n\n\t\t\tif (items.length) {\n\t\t\t\tlangx.each(items, function normalizeItemsObject (i, value) {\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\ttext: value.text,\n\t\t\t\t\t\tvalue: (value.value ? value.value : value.text),\n\t\t\t\t\t\tel: self.$pillHTML\n\t\t\t\t\t};\n\n\t\t\t\t\tif (value.attr) {\n\t\t\t\t\t\tdata.attr = value.attr;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value.data) {\n\t\t\t\t\t\tdata.data = value.data;\n\t\t\t\t\t}\n\n\t\t\t\t\titems[i] = data;\n\t\t\t\t});\n\n\t\t\t\tif (this.options.edit && this.currentEdit) {\n\t\t\t\t\titems[0].el = this.currentEdit.wrap('<div></div>').parent().html();\n\t\t\t\t}\n\n\t\t\t\tif (isInternal) {\n\t\t\t\t\titems.pop(1);\n\t\t\t\t}\n\n\t\t\t\tif (self.options.onAdd && isInternal) {\n\t\t\t\t\tif (this.options.edit && this.currentEdit) {\n\t\t\t\t\t\tself.options.onAdd(items[0], langx.proxy(self.saveEdit, this));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tself.options.onAdd(items[0], langx.proxy(self.placeItems, this));\n\t\t\t\t\t}\n\t\t\t\t} else if (this.options.edit && this.currentEdit) {\n\t\t\t\t\tself.saveEdit(items);\n\t\t\t\t} else if (index) {\n\t\t\t\t\tself.placeItems(index, items);\n\t\t\t\t} else {\n\t\t\t\t\tself.placeItems(items, isInternal);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// First parameter is the index (1 based) to start removing items\n\t\t// Second parameter is the number of items to be removed\n\t\tremoveItems: function removeItems (index, howMany) {\n\t\t\tvar self = this;\n\n\t\t\tif (!index) {\n\t\t\t\tthis.$pillGroup.find('.pill').remove();\n\t\t\t\tthis._removePillTrigger({\n\t\t\t\t\tmethod: 'removeAll'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tvar itemsToRemove = howMany ? howMany : 1;\n\n\t\t\t\tfor (var item = 0; item < itemsToRemove; item++) {\n\t\t\t\t\tvar $currentItem = self.$pillGroup.find('> .pill:nth-child(' + index + ')');\n\n\t\t\t\t\tif ($currentItem) {\n\t\t\t\t\t\t$currentItem.remove();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// First parameter is index (optional)\n\t\t// Second parameter is new arguments\n\t\tplaceItems: function placeItems () {\n\t\t\tvar items;\n\t\t\tvar index;\n\t\t\tvar $neighbor;\n\t\t\tvar isInternal;\n\n\t\t\tif (isFinite(String(arguments[0])) && !(arguments[0] instanceof Array)) {\n\t\t\t\titems = [].slice.call(arguments).slice(1);\n\t\t\t\tindex = arguments[0];\n\t\t\t} else {\n\t\t\t\titems = [].slice.call(arguments).slice(0);\n\t\t\t\tisInternal = items[1] && !items[1].text;\n\t\t\t}\n\n\t\t\tif (items[0] instanceof Array) {\n\t\t\t\titems = items[0];\n\t\t\t}\n\n\t\t\tif (items.length) {\n\t\t\t\tvar newItems = [];\n\t\t\t\tlangx.each(items, function prepareItemForAdd (i, item) {\n\t\t\t\t\tvar $item = $(item.el);\n\n\t\t\t\t\t$item.attr('data-value', item.value);\n\t\t\t\t\t$item.find('span:first').html(item.text);\n\n\t\t\t\t\t// DOM attributes\n\t\t\t\t\tif (item.attr) {\n\t\t\t\t\t\tlangx.each(item.attr, function handleDOMAttributes (key, value) {\n\t\t\t\t\t\t\tif (key === 'cssClass' || key === 'class') {\n\t\t\t\t\t\t\t\t$item.addClass(value);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$item.attr(key, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (item.data) {\n\t\t\t\t\t\t$item.data('data', item.data);\n\t\t\t\t\t}\n\n\t\t\t\t\tnewItems.push($item);\n\t\t\t\t});\n\n\t\t\t\tif (this.$pillGroup.children('.pill').length > 0) {\n\t\t\t\t\tif (index) {\n\t\t\t\t\t\t$neighbor = this.$pillGroup.find('.pill').eq(index);\n\n\t\t\t\t\t\tif ($neighbor.length) {\n\t\t\t\t\t\t\t$neighbor.before(newItems);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.$pillGroup.children('.pill').last().after(newItems);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.$pillGroup.children('.pill').last().after(newItems);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.$pillGroup.prepend(newItems);\n\t\t\t\t}\n\n\t\t\t\tif (isInternal) {\n\t\t\t\t\tthis.$element.trigger('added.fu.pillbox', {\n\t\t\t\t\t\ttext: items[0].text,\n\t\t\t\t\t\tvalue: items[0].value\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tinputEvent: function inputEvent (e) {\n\t\t\tvar self = this;\n\t\t\tvar text = self.options.cleanInput(this.$addItem.val());\n\t\t\tvar isFocusOutEvent = e.type === 'focusout';\n\t\t\tvar blurredAfterInput = (isFocusOutEvent && text.length > 0);\n\t\t\t// If we test for keycode only, it will match for `<` & `,` instead of just `,`\n\t\t\t// This way users can type `<3` and `1 < 3`, etc...\n\t\t\tvar acceptKeyPressed = (this.acceptKeyCodes[e.keyCode] && !isShiftHeld(e));\n\n\t\t\tif (acceptKeyPressed || blurredAfterInput) {\n\t\t\t\tvar attr;\n\t\t\t\tvar value;\n\n\t\t\t\tif (this.options.onKeyDown && this._isSuggestionsOpen()) {\n\t\t\t\t\tvar $selection = this.$suggest.find('.pillbox-suggest-sel');\n\n\t\t\t\t\tif ($selection.length) {\n\t\t\t\t\t\ttext = self.options.cleanInput($selection.html());\n\t\t\t\t\t\tvalue = self.options.cleanInput($selection.data('value'));\n\t\t\t\t\t\tattr = $selection.data('attr');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// ignore comma and make sure text that has been entered (protects against \" ,\". https://github.com/ExactTarget/fuelux/issues/593), unless allowEmptyPills is true.\n\t\t\t\tif (text.replace(/[ ]*\\,[ ]*/, '').match(/\\S/) || (this.options.allowEmptyPills && text.length)) {\n\t\t\t\t\tthis._closeSuggestions();\n\t\t\t\t\tthis.$addItem.val('').hide();\n\n\t\t\t\t\tif (attr) {\n\t\t\t\t\t\tthis.addItems({\n\t\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tattr: JSON.parse(attr)\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.addItems({\n\t\t\t\t\t\t\ttext: text,\n\t\t\t\t\t\t\tvalue: value\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout(function clearAddItemInput () {\n\t\t\t\t\t\tself.$addItem.show().attr({\n\t\t\t\t\t\t\tsize: 10\n\t\t\t\t\t\t}).focus();\n\t\t\t\t\t}, 0);\n\t\t\t\t}\n\n\t\t\t\te.preventDefault();\n\t\t\t\treturn true;\n\t\t\t} else if (isBackspaceKey(e) || isDeleteKey(e)) {\n\t\t\t\tif (!text.length) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (this.options.edit && this.currentEdit) {\n\t\t\t\t\t\tthis.cancelEdit();\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._closeSuggestions();\n\t\t\t\t\tvar $lastItem = this.$pillGroup.children('.pill:last');\n\n\t\t\t\t\tif ($lastItem.hasClass('pillbox-highlight')) {\n\t\t\t\t\t\tthis._removeElement(this.getItemData($lastItem, {\n\t\t\t\t\t\t\tel: $lastItem\n\t\t\t\t\t\t}));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$lastItem.addClass('pillbox-highlight');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} else if (text.length > 10) {\n\t\t\t\tif (this.$addItem.width() < (this.$pillGroup.width() - 6)) {\n\t\t\t\t\tthis.$addItem.attr({\n\t\t\t\t\t\tsize: text.length + 3\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.$pillGroup.find('.pill').removeClass('pillbox-highlight');\n\n\t\t\tif (this.options.onKeyDown && !isFocusOutEvent) {\n\t\t\t\tif (\n\t\t\t\t\tisTabKey(e) ||\n\t\t\t\t\tisUpArrow(e) ||\n\t\t\t\t\tisDownArrow(e)\n\t\t\t\t) {\n\t\t\t\t\tif (this._isSuggestionsOpen()) {\n\t\t\t\t\t\tthis._keySuggestions(e);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// only allowing most recent event callback to register\n\t\t\t\tthis.callbackId = e.timeStamp;\n\t\t\t\tthis.options.onKeyDown({\n\t\t\t\t\tevent: e,\n\t\t\t\t\tvalue: text\n\t\t\t\t}, function callOpenSuggestions (data) {\n\t\t\t\t\tself._openSuggestions(e, data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\topenEdit: function openEdit (el) {\n\t\t\tvar targetChildIndex = el.index() + 1;\n\t\t\tvar $addItemWrap = this.$addItemWrap.detach().hide();\n\n\t\t\tthis.$pillGroup.find('.pill:nth-child(' + targetChildIndex + ')').before($addItemWrap);\n\t\t\tthis.currentEdit = el.detach();\n\n\t\t\t$addItemWrap.addClass('editing');\n\t\t\tthis.$addItem.val(el.find('span:first').html());\n\t\t\t$addItemWrap.show();\n\t\t\tthis.$addItem.focus().select();\n\t\t},\n\n\t\tcancelEdit: function cancelEdit (e) {\n\t\t\tvar $addItemWrap;\n\t\t\tif (!this.currentEdit) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis._closeSuggestions();\n\t\t\tif (e) {\n\t\t\t\tthis.$addItemWrap.before(this.currentEdit);\n\t\t\t}\n\n\t\t\tthis.currentEdit = false;\n\n\t\t\t$addItemWrap = this.$addItemWrap.detach();\n\t\t\t$addItemWrap.removeClass('editing');\n\t\t\tthis.$addItem.val('');\n\t\t\tthis.$pillGroup.append($addItemWrap);\n\n\t\t\treturn true;\n\t\t},\n\n\t\t// Must match syntax of placeItem so addItem callback is called when an item is edited\n\t\t// expecting to receive an array back from the callback containing edited items\n\t\tsaveEdit: function saveEdit () {\n\t\t\tvar item = arguments[0][0] ? arguments[0][0] : arguments[0];\n\n\t\t\tthis.currentEdit = $(item.el);\n\t\t\tthis.currentEdit.data('value', item.value);\n\t\t\tthis.currentEdit.find('span:first').html(item.text);\n\n\t\t\tthis.$addItemWrap.hide();\n\t\t\tthis.$addItemWrap.before(this.currentEdit);\n\t\t\tthis.currentEdit = false;\n\n\t\t\tthis.$addItem.val('');\n\t\t\tthis.$addItemWrap.removeClass('editing');\n\t\t\tthis.$pillGroup.append(this.$addItemWrap.detach().show());\n\t\t\tthis.$element.trigger('edited.fu.pillbox', {\n\t\t\t\tvalue: item.value,\n\t\t\t\ttext: item.text\n\t\t\t});\n\t\t},\n\n\t\tremoveBySelector: function removeBySelector () {\n\t\t\tvar selectors = [].slice.call(arguments).slice(0);\n\t\t\tvar self = this;\n\n\t\t\tlangx.each(selectors, function doRemove (i, sel) {\n\t\t\t\tself.$pillGroup.find(sel).remove();\n\t\t\t});\n\n\t\t\tthis._removePillTrigger({\n\t\t\t\tmethod: 'removeBySelector',\n\t\t\t\tremovedSelectors: selectors\n\t\t\t});\n\t\t},\n\n\t\tremoveByValue: function removeByValue () {\n\t\t\tvar values = [].slice.call(arguments).slice(0);\n\t\t\tvar self = this;\n\n\t\t\tlangx.each(values, function doRemove (i, val) {\n\t\t\t\tself.$pillGroup.find('> .pill[data-value=\"' + val + '\"]').remove();\n\t\t\t});\n\n\t\t\tthis._removePillTrigger({\n\t\t\t\tmethod: 'removeByValue',\n\t\t\t\tremovedValues: values\n\t\t\t});\n\t\t},\n\n\t\tremoveByText: function removeByText () {\n\t\t\tvar text = [].slice.call(arguments).slice(0);\n\t\t\tvar self = this;\n\n\t\t\tlangx.each(text, function doRemove (i, matchingText) {\n\t\t\t\tself.$pillGroup.find('> .pill:contains(\"' + matchingText + '\")').remove();\n\t\t\t});\n\n\t\t\tthis._removePillTrigger({\n\t\t\t\tmethod: 'removeByText',\n\t\t\t\tremovedText: text\n\t\t\t});\n\t\t},\n\n\t\ttruncate: function truncate (enable) {\n\t\t\tvar self = this;\n\n\t\t\tthis.$element.removeClass('truncate');\n\t\t\tthis.$addItemWrap.removeClass('truncated');\n\t\t\tthis.$pillGroup.find('.pill').removeClass('truncated');\n\n\t\t\tif (enable) {\n\t\t\t\tthis.$element.addClass('truncate');\n\n\t\t\t\tvar availableWidth = this.$element.width();\n\t\t\t\tvar containerFull = false;\n\t\t\t\tvar processedPills = 0;\n\t\t\t\tvar totalPills = this.$pillGroup.find('.pill').length;\n\t\t\t\tvar widthUsed = 0;\n\n\t\t\t\tthis.$pillGroup.find('.pill').each(function processPills () {\n\t\t\t\t\tvar pill = $(this);\n\t\t\t\t\tif (!containerFull) {\n\t\t\t\t\t\tprocessedPills++;\n\t\t\t\t\t\tself.$moreCount.text(totalPills - processedPills);\n\t\t\t\t\t\tif ((widthUsed + pill.outerWidth(true) + self.$addItemWrap.outerWidth(true)) <= availableWidth) {\n\t\t\t\t\t\t\twidthUsed += pill.outerWidth(true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.$moreCount.text((totalPills - processedPills) + 1);\n\t\t\t\t\t\t\tpill.addClass('truncated');\n\t\t\t\t\t\t\tcontainerFull = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpill.addClass('truncated');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (processedPills === totalPills) {\n\t\t\t\t\tthis.$addItemWrap.addClass('truncated');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tinputFocus: function inputFocus () {\n\t\t\tthis.$element.find('.pillbox-add-item').focus();\n\t\t},\n\n\t\tgetItemData: function getItemData (el, data) {\n\t\t\treturn langx.mixin({\n\t\t\t\ttext: el.find('span:first').html()\n\t\t\t}, el.data(), data);\n\t\t},\n\n\t\t_removeElement: function _removeElement (data) {\n\t\t\tdata.el.remove();\n\t\t\tdelete data.el;\n\t\t\tthis.$element.trigger('removed.fu.pillbox', data);\n\t\t},\n\n\t\t_removePillTrigger: function _removePillTrigger (removedBy) {\n\t\t\tthis.$element.trigger('removed.fu.pillbox', removedBy);\n\t\t},\n\n\t\t_generateObject: function _generateObject (data) {\n\t\t\tvar obj = {};\n\n\t\t\tlangx.each(data, function setObjectValue (index, value) {\n\t\t\t\tobj[value] = true;\n\t\t\t});\n\n\t\t\treturn obj;\n\t\t},\n\n\t\t_openSuggestions: function _openSuggestions (e, data) {\n\t\t\tvar $suggestionList = $('<ul>');\n\n\t\t\tif (this.callbackId !== e.timeStamp) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (data.data && data.data.length) {\n\t\t\t\tlangx.each(data.data, function appendSuggestions (index, value) {\n\t\t\t\t\tvar val = value.value ? value.value : value.text;\n\n\t\t\t\t\t// markup concatentation is 10x faster, but does not allow data store\n\t\t\t\t\tvar $suggestion = $('<li data-value=\"' + val + '\">' + value.text + '</li>');\n\n\t\t\t\t\tif (value.attr) {\n\t\t\t\t\t\t$suggestion.data('attr', JSON.stringify(value.attr));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (value.data) {\n\t\t\t\t\t\t$suggestion.data('data', value.data);\n\t\t\t\t\t}\n\n\t\t\t\t\t$suggestionList.append($suggestion);\n\t\t\t\t});\n\n\t\t\t\t// suggestion dropdown\n\t\t\t\tthis.$suggest.html('').append($suggestionList.children());\n\t\t\t\t$(document).trigger('suggested.fu.pillbox', this.$suggest);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t_closeSuggestions: function _closeSuggestions () {\n\t\t\tthis.$suggest.html('').parent().removeClass('open');\n\t\t},\n\n\t\t_isSuggestionsOpen: function _isSuggestionsOpen () {\n\t\t\treturn this.$suggest.parent().hasClass('open');\n\t\t},\n\n\t\t_keySuggestions: function _keySuggestions (e) {\n\t\t\tvar $first = this.$suggest.find('li.pillbox-suggest-sel');\n\t\t\tvar dir = isUpArrow(e);\n\n\t\t\te.preventDefault();\n\n\t\t\tif (!$first.length) {\n\t\t\t\t$first = this.$suggest.find('li:first');\n\t\t\t\t$first.addClass('pillbox-suggest-sel');\n\t\t\t} else {\n\t\t\t\tvar $next = dir ? $first.prev() : $first.next();\n\n\t\t\t\tif (!$next.length) {\n\t\t\t\t\t$next = dir ? this.$suggest.find('li:last') : this.$suggest.find('li:first');\n\t\t\t\t}\n\n\t\t\t\tif ($next) {\n\t\t\t\t\t$next.addClass('pillbox-suggest-sel');\n\t\t\t\t\t$first.removeClass('pillbox-suggest-sel');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\n\tPillbox.prototype.getValue = Pillbox.prototype.items;\n\n\t// PILLBOX PLUGIN DEFINITION\n\n\t$.fn.pillbox = function pillbox (option) {\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tvar methodReturn;\n\n\t\tvar $set = this.each(function set () {\n\t\t\tvar $this = $(this);\n\t\t\tvar data = $this.data('fu.pillbox');\n\t\t\tvar options = typeof option === 'object' && option;\n\n\t\t\tif (!data) {\n\t\t\t\t$this.data('fu.pillbox', (data = new Pillbox(this, options)));\n\t\t\t}\n\n\t\t\tif (typeof option === 'string') {\n\t\t\t\tmethodReturn = data[option].apply(data, args);\n\t\t\t}\n\t\t});\n\n\t\treturn (methodReturn === undefined) ? $set : methodReturn;\n\t};\n\n\t$.fn.pillbox.defaults = {\n\t\tedit: false,\n\t\treadonly: -1, // can be true or false. -1 means it will check for data-readonly=\"readonly\"\n\t\ttruncate: false,\n\t\tacceptKeyCodes: [\n\t\t\tENTER_KEYCODE,\n\t\t\tCOMMA_KEYCODE\n\t\t],\n\t\tallowEmptyPills: false,\n\t\tcleanInput: cleanInput\n\n\t\t// example on remove\n\t\t/* onRemove: function(data,callback){\n\t\t\tconsole.log('onRemove');\n\t\t\tcallback(data);\n\t\t} */\n\n\t\t// example on key down\n\t\t/* onKeyDown: function(event, data, callback ){\n\t\t\tcallback({data:[\n\t\t\t\t{text: Math.random(),value:'sdfsdfsdf'},\n\t\t\t\t{text: Math.random(),value:'sdfsdfsdf'}\n\t\t\t]});\n\t\t}\n\t\t*/\n\t\t// example onAdd\n\t\t/* onAdd: function( data, callback ){\n\t\t\tconsole.log(data, callback);\n\t\t\tcallback(data);\n\t\t} */\n\t};\n\n\t$.fn.pillbox.Constructor = Pillbox;\n\n\t$.fn.pillbox.noConflict = function noConflict () {\n\t\t$.fn.pillbox = old;\n\t\treturn this;\n\t};\n\n\n\t// DATA-API\n\n\t/*\n\t$(document).on('mousedown.fu.pillbox.data-api', '[data-initialize=pillbox]', function dataAPI (e) {\n\t\tvar $control = $(e.target).closest('.pillbox');\n\t\tif (!$control.data('fu.pillbox')) {\n\t\t\t$control.pillbox($control.data());\n\t\t}\n\t});\n\n\t// Must be domReady for AMD compatibility\n\t$(function DOMReady () {\n\t\t$('[data-initialize=pillbox]').each(function init () {\n\t\t\tvar $this = $(this);\n\t\t\tif ($this.data('fu.pillbox')) return;\n\t\t\t$this.pillbox($this.data());\n\t\t});\n\t});\n\t*/\n\n\treturn $.fn.pillbox;\n});\n"]}